<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- For Mobile Devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8">
  <meta name="generator" content="Doxygen 1.8.13">
  <title>SPDK: Logical Volumes</title>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,900" type="text/css">
  <link href="../css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="tabs.css" type="text/css">
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div class="container-fluid">
  <div id="top">  <!-- do not remove this div, it is closed by doxygen! -->
    <div class="row no-gutters">
      <div class="col-sm-12">
        <section id="nav">
          <div class="navbar navbar-default navbar-static-top banner-tabs">
            <ul class="nav navbar-nav">
              <li role="presentation">
                <a href="http://www.spdk.io/">
                  <i class="glyphicon glyphicon-home"></i>
                  <span class="box-name">home</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/releases/">
                  <i class="glyphicon glyphicon-download-alt"></i>
                  <span class="box-name">download</span>
                </a>
              </li>
              <li class="active" role="presentation">
                <a href="index.html">
                  <i class="glyphicon glyphicon-book"></i>
                  <span class="box-name">documentation</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/development/">
                  <i class="glyphicon glyphicon-wrench"></i>
                  <span class="box-name">development</span>
                </a>
              </li>
              <li role="presentation">
                <a href="https://ci.spdk.io/">
                  <i class="glyphicon glyphicon-ok"></i>
                  <span class="box-name">CI status</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/community/">
                  <i class="glyphicon glyphicon-envelope"></i>
                  <span class="box-name">community</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/blog/">
                  <i class="glyphicon glyphicon-comment"></i>
                  <span class="box-name">Blog</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/roadmap/">
                  <i class="glyphicon glyphicon-map-marker"></i>
                  <span class="box-name">Roadmap</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/news/">
                  <i class="glyphicon glyphicon-bullhorn"></i>
                  <span class="box-name">News</span>
                </a>
              </li>
            </ul>
          </div>
        </section>
      </div>
    </div>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('logical_volumes.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Logical Volumes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Logical Volumes library is a flexible storage space management system. It provides creating and managing virtual block devices with variable size. The SPDK Logical Volume library is built on top of <a class="el" href="blob.html">Blobstore Programmer's Guide</a>.</p>
<h1><a class="anchor" id="lvol_terminology"></a>
Terminology</h1>
<h2><a class="anchor" id="lvs"></a>
Logical volume store</h2>
<ul>
<li>Shorthand: lvolstore, lvs</li>
<li>Type name: struct spdk_lvol_store</li>
</ul>
<p>A logical volume store uses the super blob feature of blobstore to hold uuid (and in future other metadata). Blobstore types are implemented in blobstore itself, and saved on disk. An lvolstore will generate a UUID on creation, so that it can be uniquely identified from other lvolstores.</p>
<h2><a class="anchor" id="lvol"></a>
Logical volume</h2>
<ul>
<li>Shorthand: lvol</li>
<li>Type name: struct spdk_lvol</li>
</ul>
<p>A logical volume is implemented as an SPDK blob created from an lvolstore. An lvol is uniquely identified by its UUID. Lvol additional can have alias name.</p>
<h2><a class="anchor" id="lvol_bdev"></a>
Logical volume block device</h2>
<ul>
<li>Shorthand: lvol_bdev</li>
<li>Type name: struct spdk_lvol_bdev</li>
</ul>
<p>Representation of an SPDK block device (<a class="el" href="structspdk__bdev.html">spdk_bdev</a>) with an lvol implementation. A logical volume block device translates generic SPDK block device I/O (<a class="el" href="structspdk__bdev__io.html">spdk_bdev_io</a>) operations into the equivalent SPDK blob operations. Combination of lvol name and lvolstore name gives lvol_bdev alias name in a form "lvs_name/lvol_name". block_size of the created bdev is always 4096, due to blobstore page size. Cluster_size is configurable by parameter. Size of the new bdev will be rounded up to nearest multiple of cluster_size. By default lvol bdevs claim part of lvol store equal to their set size. When thin provision option is enabled, no space is taken from lvol store until data is written to lvol bdev.</p>
<h2><a class="anchor" id="lvol_snapshots"></a>
Snapshots and clone</h2>
<p>Logical volumes support snapshots and clones functionality. User may at any given time create snapshot of existing logical volume to save a backup of current volume state. When creating snapshot original volume becomes thin provisioned and saves only incremental differences from its underlying snapshot. This means that every read from unallocated cluster is actually a read from the snapshot and every write to unallocated cluster triggers new cluster allocation and data copy from corresponding cluster in snapshot to the new cluster in logical volume before the actual write occurs.</p>
<p>The read operation is performed as shown in the diagram below: </p><div class="image">
<object type="image/svg+xml" data="lvol_clone_snapshot_read.svg">lvol_clone_snapshot_read.svg</object>
<div class="caption">
Reading cluster from clone</div></div>
<p> The write operation is performed as shown in the diagram below: </p><div class="image">
<object type="image/svg+xml" data="lvol_clone_snapshot_write.svg">lvol_clone_snapshot_write.svg</object>
<div class="caption">
Writing cluster to the clone</div></div>
<p> User may also create clone of existing snapshot that will be thin provisioned and it will behave in the same way as logical volume from which snapshot is created. There is no limit of clones and snapshots that may be created as long as there is enough space on logical volume store. Snapshots are read only. Clones may be created only from snapshots.</p>
<h1>Configuring Logical Volumes</h1>
<p>There is no static configuration available for logical volumes. All configuration is done trough RPC. Information about logical volumes is kept on block devices.</p>
<h1><a class="anchor" id="lvol_rpc"></a>
RPC overview</h1>
<p>RPC regarding lvolstore:</p>
<div class="fragment"><div class="line">construct_lvol_store [-h] [-c CLUSTER_SZ] bdev_name lvs_name</div><div class="line">    Constructs lvolstore on specified bdev with specified name. During</div><div class="line">    construction bdev is unmapped at initialization and all data is</div><div class="line">    erased. Then original bdev is claimed by</div><div class="line">    SPDK, but no additional spdk bdevs are created.</div><div class="line">    Returns uuid of created lvolstore.</div><div class="line">    Optional paramters:</div><div class="line">    -h  show help</div><div class="line">    -c  CLUSTER_SZ Specifies the size of cluster. By default its 4MiB.</div><div class="line">destroy_lvol_store [-h] [-u UUID] [-l LVS_NAME]</div><div class="line">    Destroy lvolstore on specified bdev. Removes lvolstore along with lvols on</div><div class="line">    it. User can identify lvol store by UUID or its name. Note that destroying</div><div class="line">    lvolstore requires using this call, while deleting single lvol requires</div><div class="line">    using destroy_lvol_bdev rpc call.</div><div class="line">    optional arguments:</div><div class="line">    -h, --help  show help</div><div class="line">get_lvol_stores [-h] [-u UUID] [-l LVS_NAME]</div><div class="line">    Display current logical volume store list</div><div class="line">    optional arguments:</div><div class="line">    -h, --help  show help</div><div class="line">    -u UUID, --uuid UUID  show details of specified lvol store</div><div class="line">    -l LVS_NAME, --lvs_name LVS_NAME  show details of specified lvol store</div><div class="line">rename_lvol_store [-h] old_name new_name</div><div class="line">    Change logical volume store name</div><div class="line">    optional arguments:</div><div class="line">    -h, --help  show this help message and exit</div></div><!-- fragment --><p>RPC regarding lvol and spdk bdev:</p>
<div class="fragment"><div class="line">construct_lvol_bdev [-h] [-u UUID] [-l LVS_NAME] [-t] lvol_name size</div><div class="line">    Creates lvol with specified size and name on lvolstore specified by its uuid</div><div class="line">    or name. Then constructs spdk bdev on top of that lvol and presents it as spdk bdev.</div><div class="line">    User may use -t switch to create thin provisioned lvol.</div><div class="line">    Returns the name of new spdk bdev</div><div class="line">    optional arguments:</div><div class="line">    -h, --help  show help</div><div class="line">get_bdevs [-h] [-b NAME]</div><div class="line">    User can view created bdevs using this call including those created on top of lvols.</div><div class="line">    optional arguments:</div><div class="line">    -h, --help  show help</div><div class="line">    -b NAME, --name NAME  Name of the block device. Example: Nvme0n1</div><div class="line">destroy_lvol_bdev [-h] bdev_name</div><div class="line">    Deletes a logical volume previously created by construct_lvol_bdev.</div><div class="line">    optional arguments:</div><div class="line">    -h, --help  show help</div><div class="line">snapshot_lvol_bdev [-h] lvol_name snapshot_name</div><div class="line">    Create a snapshot with snapshot_name of a given lvol bdev.</div><div class="line">    optional arguments:</div><div class="line">    -h, --help  show help</div><div class="line">clone_lvol_bdev [-h] snapshot_name clone_name</div><div class="line">    Create a clone with clone_name of a given lvol snapshot.</div><div class="line">    optional arguments:</div><div class="line">    -h, --help  show help</div><div class="line">rename_lvol_bdev [-h] old_name new_name</div><div class="line">    Change lvol bdev name</div><div class="line">    optional arguments:</div><div class="line">    -h, --help  show help</div><div class="line">resize_lvol_bdev [-h] name size</div><div class="line">    Resize existing lvol bdev</div><div class="line">    optional arguments:</div><div class="line">    -h, --help  show help</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
</div>
