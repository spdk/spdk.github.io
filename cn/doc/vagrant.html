<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- For Mobile Devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8">
  <meta name="generator" content="Doxygen 1.8.13">
  <title>SPDK: Vagrant Development Environment</title>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,900" type="text/css">
  <link href="../css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="tabs.css" type="text/css">
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div class="container-fluid">
  <div id="top">  <!-- do not remove this div, it is closed by doxygen! -->
    <div class="row no-gutters">
      <div class="col-sm-12">
        <section id="nav">
          <div class="navbar navbar-default navbar-static-top banner-tabs">
            <ul class="nav navbar-nav">
              <li role="presentation">
                <a href="http://www.spdk.io/">
                  <i class="glyphicon glyphicon-home"></i>
                  <span class="box-name">home</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/releases/">
                  <i class="glyphicon glyphicon-download-alt"></i>
                  <span class="box-name">download</span>
                </a>
              </li>
              <li class="active" role="presentation">
                <a href="index.html">
                  <i class="glyphicon glyphicon-book"></i>
                  <span class="box-name">documentation</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/development/">
                  <i class="glyphicon glyphicon-wrench"></i>
                  <span class="box-name">development</span>
                </a>
              </li>
              <li role="presentation">
                <a href="https://ci.spdk.io/">
                  <i class="glyphicon glyphicon-ok"></i>
                  <span class="box-name">CI status</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/community/">
                  <i class="glyphicon glyphicon-envelope"></i>
                  <span class="box-name">community</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/blog/">
                  <i class="glyphicon glyphicon-comment"></i>
                  <span class="box-name">Blog</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/roadmap/">
                  <i class="glyphicon glyphicon-map-marker"></i>
                  <span class="box-name">Roadmap</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/news/">
                  <i class="glyphicon glyphicon-bullhorn"></i>
                  <span class="box-name">News</span>
                </a>
              </li>
            </ul>
          </div>
        </section>
      </div>
    </div>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('vagrant.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Vagrant Development Environment </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="vagrant_intro"></a>
Introduction</h1>
<p><a href="https://www.vagrantup.com/">Vagrant</a> provides a quick way to get a basic NVMe enabled virtual machine sandbox running without the need for any special hardware. The Vagrant environment for SPDK has support for Ubuntu 16.04 and CentOS 7.2. This environment requires Vagrant 1.9.4 or newer and VirtualBox 5.1 or newer with the matching VirtualBox extension pack.</p>
<p>The VM builds SPDK and DPDK from source which are located at <code>/spdk</code>.</p>
<p>Note: If you are behind a corporate firewall, set <code>http_proxy</code> and <code>https_proxy</code> in your environment before trying to start up the VM. Also make sure that you have installed the optional vagrant module <code>vagrant-proxyconf</code>:</p>
<div class="fragment"><div class="line">export http_proxy=...</div><div class="line">export https_proxy=...</div><div class="line">vagrant plugin install vagrant-proxyconf</div></div><!-- fragment --><p>In case you want use kvm/libvirt you should also install <code>vagrant-libvirt</code></p>
<h1><a class="anchor" id="vagrant_config"></a>
VM Configuration</h1>
<p>This vagrant environment creates a VM based on environment variables found in <code>env.sh</code>. To use, edit <code>env.sh</code>, then:</p>
<div class="fragment"><div class="line">cd scripts/vagrant</div><div class="line">source ./env.sh</div><div class="line">vagrant up</div></div><!-- fragment --><p>At this point you can use <code>vagrant ssh</code> to ssh into the VM. The <code>/spdk</code> directory is sync'd from the host system and the build is automatically done. Other notable files:</p>
<ul>
<li><code>build.sh</code>: executed on the VM automatically when provisioned</li>
<li><code>Vagrantfile</code>: startup parameters/commands for the VM</li>
</ul>
<p>The few commands we mention here are enough to get you up and running; for additional support, use the Vagrant help function to learn how to destroy, restart, etc. Further below is sample output from a successful VM launch and execution of the NVMe hello world example application.</p>
<div class="fragment"><div class="line">vagrant --help</div></div><!-- fragment --><p>By default, the VM created is configured with:</p><ul>
<li>Ubuntu 16.04</li>
<li>2 vCPUs</li>
<li>4G of RAM</li>
<li>2 NICs (1 x NAT - host access, 1 x private network)</li>
</ul>
<h1><a class="anchor" id="vagrant_providers"></a>
Providers</h1>
<p>Currently VirtualBox &amp; libvirt provider are supported.</p>
<p>For libvirt currently there is only centos 7 image avaiable.</p>
<p>To run with libvirt:</p>
<div class="fragment"><div class="line">./create_nvme_img.sh</div><div class="line">vagrant up --provider=libvirt</div></div><!-- fragment --><h1><a class="anchor" id="vagrant_example"></a>
Running An Example</h1>
<p>The following shows sample output from starting up a VM and running the NVMe sample application <code>hello_world</code>. If you don't see the NVMe device as seen below in both the <code>lspci</code> output as well as the application output, you likely have a VirtualBox and/or Vagrant versioning issue.</p>
<div class="fragment"><div class="line">user@dev-system:~$ cd spdk</div><div class="line">user@dev-system:~/spdk$ cd scripts/</div><div class="line">user@dev-system:~/spdk/scripts$ cd vagrant/</div><div class="line">user@dev-system:~/spdk/scripts/vagrant$ vagrant up</div><div class="line">Bringing machine &#39;default&#39; up with &#39;virtualbox&#39; provider...</div><div class="line">==&gt; default: Clearing any previously set forwarded ports...</div><div class="line">==&gt; default: Clearing any previously set network interfaces...</div><div class="line">==&gt; default: Preparing network interfaces based on configuration...</div><div class="line">    default: Adapter 1: nat</div><div class="line">    default: Adapter 2: hostonly</div><div class="line">==&gt; default: Forwarding ports...</div><div class="line">    default: 22 (guest) =&gt; 2222 (host) (adapter 1)</div><div class="line">==&gt; default: Running &#39;pre-boot&#39; VM customizations...</div><div class="line">==&gt; default: Booting VM...</div><div class="line">==&gt; default: Waiting for machine to boot. This may take a few minutes...</div><div class="line">    default: SSH address: 127.0.0.1:2222</div><div class="line">    default: SSH username: vagrant</div><div class="line">    default: SSH auth method: private key</div><div class="line">    default:</div><div class="line">    default: Vagrant insecure key detected. Vagrant will automatically replace</div><div class="line">    default: this with a newly generated keypair for better security.</div><div class="line">    default:</div><div class="line">    default: Inserting generated public key within guest...</div><div class="line">    default: Removing insecure key from the guest if it&#39;s present...</div><div class="line">    default: Key inserted! Disconnecting and reconnecting using new SSH key...</div><div class="line">==&gt; default: Machine booted and ready!</div><div class="line">==&gt; default: Checking for guest additions in VM...</div><div class="line">    default: Guest Additions Version: 5.1</div><div class="line">    default: VirtualBox Version: 5.1</div><div class="line">==&gt; default: Configuring and enabling network interfaces...</div><div class="line">==&gt; default: Rsyncing folder: /home/peluse/spdk/ =&gt; /spdk</div><div class="line">==&gt; default: Mounting shared folders...</div><div class="line">    default: /vagrant =&gt; /home/peluse/spdk/scripts/vagrant</div><div class="line">==&gt; default: Running provisioner: shell...</div><div class="line">    default: Running: /tmp/vagrant-shell20170524-2405-3cam94.sh</div><div class="line">==&gt; default: vm.nr_hugepages = 1024</div><div class="line">==&gt; default: Hit:1 http://us.archive.ubuntu.com/ubuntu xenial InRelease</div><div class="line">&lt;&lt; some output trimmed &gt;&gt;</div><div class="line">==&gt; default: Fetched 2,329 kB in 3s (588 kB/s)</div><div class="line">==&gt; default: Reading package lists...</div><div class="line">==&gt; default: Building dependency tree...</div><div class="line">==&gt; default: Reading state information...</div><div class="line">==&gt; default: Calculating upgrade...</div><div class="line">==&gt; default: The following packages have been kept back:</div><div class="line">==&gt; default:   linux-generic linux-headers-generic linux-image-generic</div><div class="line">==&gt; default: The following packages will be upgraded:</div><div class="line">==&gt; default:   accountsservice apparmor apt apt-transport-https apt-utils base-files bash</div><div class="line">&lt;&lt; some output trimmed &gt;&gt;</div><div class="line">==&gt; default: 167 upgraded, 0 newly installed, 0 to remove and 3 not upgraded.</div><div class="line">==&gt; default: Need to get 124 MB of archives.</div><div class="line">==&gt; default: After this operation, 39.5 MB of additional disk space will be used.</div><div class="line">==&gt; default: Get:1 http://us.archive.ubuntu.com/ubuntu xenial-updates/main amd64 base-files amd64 9.4ubuntu4.4 [60.                 2 kB]</div><div class="line">&lt;&lt; some output trimmed &gt;&gt;</div><div class="line">==&gt; default: Preconfiguring packages ...</div><div class="line">==&gt; default: Fetched 11.8 MB in 17s (669 kB/s)</div><div class="line">==&gt; default: Setting up libc6:amd64 (2.23-0ubuntu7) ...</div><div class="line">==&gt; default: Processing triggers for libc-bin (2.23-0ubuntu3) ...</div><div class="line">&lt;&lt; some output trimmed &gt;&gt;</div><div class="line">==&gt; default: Running provisioner: shell...</div><div class="line">    default: Running: /tmp/vagrant-shell20170524-2405-1wt8p3c.sh</div><div class="line">==&gt; default: 0:/tmp/vagrant-shell</div><div class="line">==&gt; default: SUDOCMD: sudo -H -u vagrant</div><div class="line">==&gt; default: KERNEL_OS: GNU/Linux</div><div class="line">==&gt; default: KERNEL_MACHINE: x86_64</div><div class="line">==&gt; default: KERNEL_RELEASE: 4.4.0-21-generic</div><div class="line">==&gt; default: KERNEL_VERSION: #37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016</div><div class="line">==&gt; default: DISTRIB_ID: Ubuntu</div><div class="line">==&gt; default: DISTRIB_RELEASE: 16.04</div><div class="line">==&gt; default: DISTRIB_CODENAME: xenial</div><div class="line">==&gt; default: DISTRIB_DESCRIPTION: Ubuntu 16.04 LTS</div><div class="line">==&gt; default: Reading package lists...</div><div class="line">==&gt; default: Building dependency tree...</div><div class="line">&lt;&lt; some output trimmed &gt;&gt;</div><div class="line">==&gt; default: Processing triggers for libc-bin (2.23-0ubuntu3) ...</div><div class="line">==&gt; default: Creating CONFIG.local...</div><div class="line">==&gt; default: done.</div><div class="line">==&gt; default: Type &#39;make&#39; to build.</div><div class="line">==&gt; default: Configuration done</div><div class="line">==&gt; default: make[3]: Entering directory &#39;/spdk/dpdk&#39;</div><div class="line">==&gt; default: == Build lib</div><div class="line">==&gt; default: == Build lib/librte_compat</div><div class="line">==&gt; default: == Build lib/librte_eal</div><div class="line">==&gt; default: == Build lib/librte_eal/common</div><div class="line">==&gt; default:   SYMLINK-FILE include/rte_compat.h</div><div class="line">&lt;&lt; some output trimmed &gt;&gt;</div><div class="line">==&gt; default: Build complete [x86_64-native-linuxapp-gcc]</div><div class="line">==&gt; default: make[3]: Leaving directory &#39;/spdk/dpdk&#39;</div><div class="line">==&gt; default:   CC lib/blob/blobstore.o</div><div class="line">==&gt; default:   CC lib/bdev/bdev.o</div><div class="line">&lt;&lt; some output trimmed &gt;&gt;</div><div class="line">==&gt; default:   LINK test/nvme/e2edp/nvme_dp</div><div class="line">==&gt; default: Running provisioner: shell...</div><div class="line">    default: Running: inline script</div><div class="line">==&gt; default: 0000:00:0e.0 (80ee 4e56): nvme -&gt; uio_pci_generic</div><div class="line"></div><div class="line">user@dev-system:~/spdk/scripts/vagrant$ vagrant ssh</div><div class="line">Welcome to Ubuntu 16.04 LTS (GNU/Linux 4.4.0-21-generic x86_64)</div><div class="line"></div><div class="line"> * Documentation:  https://help.ubuntu.com/</div><div class="line">vagrant@localhost:~$ lspci | grep &quot;Non-Volatile&quot;</div><div class="line">00:0e.0 Non-Volatile memory controller: InnoTek Systemberatung GmbH Device 4e56</div><div class="line"></div><div class="line">vagrant@localhost:~$ sudo /spdk/examples/nvme/hello_world/hello_world</div><div class="line">Starting DPDK 17.02.0 initialization...</div><div class="line">[ DPDK EAL parameters: hello_world -c 0x1 --file-prefix=spdk_pid17681 ]</div><div class="line">EAL: Detected 2 lcore(s)</div><div class="line">EAL: Probing VFIO support...</div><div class="line">Initializing NVMe Controllers</div><div class="line">EAL: PCI device 0000:00:0e.0 on NUMA socket 0</div><div class="line">EAL:   probe driver: 80ee:4e56 spdk_nvme</div><div class="line">Attaching to 0000:00:0e.0</div><div class="line">Attached to 0000:00:0e.0</div><div class="line">Using controller ORCL-VBOX-NVME-VER12 (VB1234-56789        ) with 1 namespaces.</div><div class="line">  Namespace ID: 1 size: 1GB</div><div class="line">Initialization complete.</div><div class="line">Hello world!</div><div class="line">vagrant@localhost:~$</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
</div>
