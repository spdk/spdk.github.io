<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- For Mobile Devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8">
  <meta name="generator" content="Doxygen 1.8.13">
  <title>SPDK: BlobFS (Blobstore Filesystem)</title>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,900" type="text/css">
  <link href="../css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="tabs.css" type="text/css">
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div class="container-fluid">
  <div id="top">  <!-- do not remove this div, it is closed by doxygen! -->
    <div class="row no-gutters">
      <div class="col-sm-12">
        <section id="nav">
          <div class="navbar navbar-default navbar-static-top banner-tabs">
            <ul class="nav navbar-nav">
              <li role="presentation">
                <a href="http://www.spdk.io/">
                  <i class="glyphicon glyphicon-home"></i>
                  <span class="box-name">home</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/releases/">
                  <i class="glyphicon glyphicon-download-alt"></i>
                  <span class="box-name">download</span>
                </a>
              </li>
              <li class="active" role="presentation">
                <a href="index.html">
                  <i class="glyphicon glyphicon-book"></i>
                  <span class="box-name">documentation</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/development/">
                  <i class="glyphicon glyphicon-wrench"></i>
                  <span class="box-name">development</span>
                </a>
              </li>
              <li role="presentation">
                <a href="https://ci.spdk.io/status/">
                  <i class="glyphicon glyphicon-ok"></i>
                  <span class="box-name">CI status</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/community/">
                  <i class="glyphicon glyphicon-envelope"></i>
                  <span class="box-name">community</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/blog/">
                  <i class="glyphicon glyphicon-comment"></i>
                  <span class="box-name">Blog</span>
                </a>
              </li>
              <li role="presentation">
                <a href="https://github.com/spdk/spdk/wiki/Roadmap">
                  <i class="glyphicon glyphicon-map-marker"></i>
                  <span class="box-name">Roadmap</span>
                </a>
              </li>
              <li role="presentation">
                <a href="https://github.com/spdk/spdk/wiki/News">
                  <i class="glyphicon glyphicon-bullhorn"></i>
                  <span class="box-name">News</span>
                </a>
              </li>
            </ul>
          </div>
        </section>
      </div>
    </div>
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">BlobFS (Blobstore Filesystem) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="blobfs_getting_started"></a>
BlobFS Getting Started Guide</h1>
<h1><a class="anchor" id="blobfs_rocksdb"></a>
RocksDB Integration</h1>
<ol type="1">
<li><p class="startli">Clone and build the SPDK repository as per <a href="https://github.com/spdk/spdk">https://github.com/spdk/spdk</a></p>
<p class="startli">git clone <a href="https://github.com/spdk/spdk.git">https://github.com/spdk/spdk.git</a> cd spdk ./configure make</p>
</li>
<li><p class="startli">Into a separate directory, clone the RocksDB git repo from the SPDK GitHub fork. Make sure you check out the spdk branch.</p>
<p class="startli">cd .. git clone -b spdk-v5.6.1 <a href="https://github.com/spdk/rocksdb.git">https://github.com/spdk/rocksdb.git</a></p>
</li>
<li><p class="startli">Build RocksDB. Only the db_bench benchmarking tool is integrated with BlobFS. (Note: add "DEBUG_LEVEL=0" for a release build.)</p>
<p class="startli">cd rocksdb make db_bench SPDK_DIR=path/to/spdk</p>
</li>
<li><p class="startli">Copy etc/spdk/rocksdb.conf.in from the spdk repository to /usr/local/etc/spdk/rocksdb.conf.</p>
<p class="startli">cd ../spdk cp etc/spdk/rocksdb.conf.in /usr/local/etc/spdk/rocksdb.conf</p>
</li>
<li><p class="startli">Append an NVMe section to the configuration file using SPDK's gen_nvme.sh script.</p>
<p class="startli">scripts/gen_nvme.sh &gt;&gt; /usr/local/etc/spdk/rocksdb.conf</p>
</li>
<li>Verify the configuration file has specified the correct NVMe SSD. If there are any NVMe SSDs you do not wish to use for RocksDB/SPDK testing, remove them from the configuration file.</li>
<li><p class="startli">Make sure you have at least 5GB of memory allocated for huge pages. By default the SPDK setup.sh script only allocates 2GB (1024 huge pages). The following will allocate 5GB worth of 2MB huge pages (in addition to binding the NVMe devices to uio/vfio). If using 1GB huge pages, adjust the NRHUGE value accordingly.</p>
<p class="startli">NRHUGE=2560 scripts/setup.sh</p>
</li>
<li><p class="startli">Create an empty SPDK blobfs for testing.</p>
<p class="startli">test/lib/blobfs/mkfs/mkfs /usr/local/etc/spdk/rocksdb.conf Nvme0n1</p>
</li>
</ol>
<p>At this point, RocksDB is ready for testing with SPDK. Three db_bench parameters are used to configure SPDK:</p>
<ol type="1">
<li>spdk - Defines the name of the SPDK configuration file. If omitted, RocksDB will use the default PosixEnv implementation instead of SpdkEnv. (Required)</li>
<li>spdk_bdev - Defines the name of the SPDK block device which contains the BlobFS to be used for testing. (Required)</li>
<li>spdk_cache_size - Defines the amount of userspace cache memory used by SPDK. Specified in terms of megabytes (MB). Default is 4096 (4GB). (Optional)</li>
</ol>
<p>SPDK has a set of scripts which will run db_bench against a variety of workloads and capture performance and profiling data. The primary script is <code>test/blobfs/rocksdb/run_tests.sh</code>.</p>
<h1>FUSE</h1>
<p>BlobFS provides a FUSE plug-in to mount an SPDK BlobFS as a kernel filesystem for inspection or debug purposes. The FUSE plug-in requires fuse3 and will be built automatically when fuse3 is detected on the system.</p>
<p>test/lib/blobfs/fuse/fuse /usr/local/etc/spdk/rocksdb.conf Nvme0n1 /mnt/fuse</p>
<p>Note that the FUSE plug-in has some limitations - see the list below.</p>
<h1>Limitations</h1>
<ul>
<li>BlobFS has primarily been tested with RocksDB so far, so any use cases different from how RocksDB uses a filesystem may run into issues. BlobFS will be tested in a broader range of use cases after this initial release.</li>
<li>Only a synchronous API is currently supported. An asynchronous API has been developed but not thoroughly tested yet so is not part of the public interface yet. This will be added in a future release.</li>
<li>File renames are not atomic. This will be fixed in a future release.</li>
<li>BlobFS currently supports only a flat namespace for files with no directory support. Filenames are currently stored as xattrs in each blob. This means that filename lookup is an O(n) operation. An SPDK btree implementation is underway which will be the underpinning for BlobFS directory support in a future release.</li>
<li>Writes to a file must always append to the end of the file. Support for writes to any location within the file will be added in a future release. </li>
</ul>
</div></div><!-- contents -->
</div>
