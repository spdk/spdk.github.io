<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="generator" content="Doxygen 1.9.1" />
  <title>SPDK: Vagrant Development Environment</title>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <script type="text/javascript" src="../js/doxyboot.js"></script>
  <script type="text/javascript" src="./navtree.js"></script>
  <link href="../css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="../css/spdk.css" rel="stylesheet" type="text/css">
</head>
<body>
  <nav class="navbar navbar-expand-md navbar-dark bg-dark px-2">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/" aria-label="SPDK">
      <img src="/img/spdk.svg"  width="36" height="36" alt="Storage Performance Development Kit" />
    </a>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <div class="navbar-nav mr-auto">
        <a class="nav-link header-link active" href="../doc/">Documentation</a>
        <a class="nav-link header-link" href="../development/">Development</a>
        <a class="nav-link header-link" href="../community/">Community</a>
        <a class="nav-link header-link" href="../blog/">Blog</a>
      </div>
      <div class="navbar-nav ml-auto mr-3">
        <a class="nav-link header-link" href="https://github.com/spdk/spdk">
          <svg xmlns="http://www.w3.org/2000/svg" class="navbar-nav-svg"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
        </a>
      </div>
    </div>
  </nav>
  <div class="container-fluid doc">
      <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('vagrant.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Vagrant Development Environment </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_vagrant"></a> </p>
<h1><a class="anchor" id="vagrant_intro"></a>
Introduction</h1>
<p><a href="https://www.vagrantup.com/">Vagrant</a> provides a quick way to get a basic NVMe enabled virtual machine sandbox running without the need for any special hardware. The Vagrant environment for SPDK has support for a variety of Linux distributions as well as FreeBSD. Run scripts/vagrant/create_vbox.sh -h to see the complete list. This environment requires Vagrant 1.9.4 or newer and VirtualBox 5.1 or newer with the matching VirtualBox extension pack.</p>
<p>Note: If you are behind a corporate firewall, set <code>http_proxy</code> and <code>https_proxy</code> in your environment before trying to start up the VM. Also make sure that you have installed the optional vagrant module <code>vagrant-proxyconf</code>:</p>
<div class="fragment"><div class="line">export http_proxy=...</div>
<div class="line">export https_proxy=...</div>
<div class="line">vagrant plugin install vagrant-proxyconf</div>
</div><!-- fragment --><p>In case you want use kvm/libvirt you should also install <code>vagrant-libvirt</code></p>
<h1><a class="anchor" id="vagrant_config"></a>
VM Configuration</h1>
<p>To create a configured VM with vagrant you need to run <code>create_vbox.sh</code> script.</p>
<p>Basically, the script will create a new sub-directory based on distribution you choose, copy the vagrant configuration file (a.k.a. <code>Vagrantfile</code>) to it, and run <code>vagrant up</code> with some settings defined by the script arguments.</p>
<p>By default, the VM created is configured with:</p>
<ul>
<li>2 vCPUs</li>
<li>4G of RAM</li>
<li>2 NICs (1 x NAT - host access, 1 x private network)</li>
</ul>
<p>In order to modify some advanced settings like provisioning and rsyncing, you may want to change Vagrantfile source.</p>
<p>For additional support, use the Vagrant help function to learn how to destroy, restart, etc. Further below is sample output from a successful VM launch and execution of the NVMe hello world example application.</p>
<div class="fragment"><div class="line">vagrant --help</div>
</div><!-- fragment --><h1><a class="anchor" id="vagrant_example"></a>
Running An Example</h1>
<p>The following shows sample output from starting up a Ubuntu18 VM, compiling SPDK on it and running the NVMe sample application <code>hello_world</code>. If you don't see the NVMe device as seen below in both the <code>lspci</code> output as well as the application output, you likely have a VirtualBox and/or Vagrant versioning issue.</p>
<div class="fragment"><div class="line">user@dev-system:~$ cd spdk/scripts/vagrant</div>
<div class="line">user@dev-system:~/spdk/scripts/vagrant$ ./create_vbox.sh ubuntu18</div>
<div class="line">mkdir: created directory &#39;/home/user/spdk/scripts/vagrant/ubuntu18&#39;</div>
<div class="line">~/spdk/scripts/vagrant/ubuntu18 ~/spdk/scripts/vagrant</div>
<div class="line">vagrant-proxyconf already installed... skipping</div>
<div class="line">Bringing machine &#39;default&#39; up with &#39;virtualbox&#39; provider...</div>
<div class="line">==&gt; default: Box &#39;bento/ubuntu-18.04&#39; could not be found. Attempting to find and install...</div>
<div class="line">    default: Box Provider: virtualbox</div>
<div class="line">    default: Box Version: 201803.24.0</div>
<div class="line">==&gt; default: Loading metadata for box &#39;bento/ubuntu-18.04&#39;</div>
<div class="line">    default: URL: https://vagrantcloud.com/bento/ubuntu-18.04</div>
<div class="line">==&gt; default: Adding box &#39;bento/ubuntu-18.04&#39; (v201803.24.0) for provider: virtualbox</div>
<div class="line">    default: Downloading: https://vagrantcloud.com/bento/boxes/ubuntu-18.04/versions/201803.24.0/providers/virtualbox.box</div>
<div class="line">==&gt; default: Box download is resuming from prior download progress</div>
<div class="line">==&gt; default: Successfully added box &#39;bento/ubuntu-18.04&#39; (v201803.24.0) for &#39;virtualbox&#39;!</div>
<div class="line">==&gt; default: Importing base box &#39;bento/ubuntu-18.04&#39;...</div>
<div class="line">==&gt; default: Matching MAC address for NAT networking...</div>
<div class="line">==&gt; default: Setting the name of the VM: ubuntu18_default_1237088131451_82174</div>
<div class="line">==&gt; default: Fixed port collision for 22 =&gt; 2222. Now on port 2202.</div>
<div class="line">==&gt; default: Clearing any previously set network interfaces...</div>
<div class="line">==&gt; default: Preparing network interfaces based on configuration...</div>
<div class="line">    default: Adapter 1: nat</div>
<div class="line">    default: Adapter 2: hostonly</div>
<div class="line">==&gt; default: Forwarding ports...</div>
<div class="line">    default: 22 (guest) =&gt; 2202 (host) (adapter 1)</div>
<div class="line">==&gt; default: Running &#39;pre-boot&#39; VM customizations...</div>
<div class="line">==&gt; default: Booting VM...</div>
<div class="line">==&gt; default: Waiting for machine to boot. This may take a few minutes...</div>
<div class="line">    default: SSH address: 127.0.0.1:2202</div>
<div class="line">    default: SSH username: vagrant</div>
<div class="line">    default: SSH auth method: private key</div>
<div class="line">    default: Warning: Remote connection disconnect. Retrying...</div>
<div class="line">    default: Warning: Connection reset. Retrying...</div>
<div class="line">&lt;&lt;some output trimmed&gt;&gt;</div>
<div class="line">    default: Warning: Connection reset. Retrying...</div>
<div class="line">    default: Warning: Remote connection disconnect. Retrying...</div>
<div class="line">    default:</div>
<div class="line">    default: Vagrant insecure key detected. Vagrant will automatically replace</div>
<div class="line">    default: this with a newly generated keypair for better security.</div>
<div class="line">    default:</div>
<div class="line">    default: Inserting generated public key within guest...</div>
<div class="line">    default: Removing insecure key from the guest if it&#39;s present...</div>
<div class="line">    default: Key inserted! Disconnecting and reconnecting using new SSH key...</div>
<div class="line">==&gt; default: Machine booted and ready!</div>
<div class="line">==&gt; default: Checking for guest additions in VM...</div>
<div class="line">==&gt; default: Configuring and enabling network interfaces...</div>
<div class="line">==&gt; default: Configuring proxy for Apt...</div>
<div class="line">==&gt; default: Configuring proxy environment variables...</div>
<div class="line">==&gt; default: Rsyncing folder: /home/user/spdk/ =&gt; /home/vagrant/spdk_repo/spdk</div>
<div class="line">==&gt; default: Mounting shared folders...</div>
<div class="line">    default: /vagrant =&gt; /home/user/spdk/scripts/vagrant/ubuntu18</div>
<div class="line">==&gt; default: Running provisioner: file...</div>
<div class="line"> </div>
<div class="line">  SUCCESS!</div>
<div class="line"> </div>
<div class="line">  cd to ubuntu18 and type &quot;vagrant ssh&quot; to use.</div>
<div class="line">  Use vagrant &quot;suspend&quot; and vagrant &quot;resume&quot; to stop and start.</div>
<div class="line">  Use vagrant &quot;destroy&quot; followed by &quot;rm -rf ubuntu18&quot; to destroy all trace of vm.</div>
</div><!-- fragment --><p>Check the environment.</p>
<div class="fragment"><div class="line">user@dev-system:~/spdk/scripts/vagrant$ cd ubuntu18</div>
<div class="line">user@dev-system:~/spdk/scripts/vagrant/ubuntu18$ vagrant ssh</div>
<div class="line">Welcome to Ubuntu Bionic Beaver (development branch) (GNU/Linux 4.15.0-12-generic x86_64)</div>
<div class="line">&lt;&lt;some output trimmed&gt;&gt;</div>
<div class="line">vagrant@vagrant:~$ lspci | grep &quot;Non-Volatile&quot;</div>
<div class="line">00:0e.0 Non-Volatile memory controller: InnoTek Systemberatung GmbH Device 4e56</div>
<div class="line">vagrant@vagrant:~$ ls</div>
<div class="line">spdk_repo</div>
</div><!-- fragment --><p>Compiling SPDK and running an example.</p>
<div class="fragment"><div class="line">vagrant@vagrant:~/spdk_repo/spdk$ sudo apt update</div>
<div class="line">&lt;&lt;output trimmed&gt;&gt;</div>
<div class="line">vagrant@vagrant:~/spdk_repo/spdk$ sudo scripts/pkgdep.sh</div>
<div class="line">&lt;&lt;output trimmed&gt;&gt;</div>
<div class="line"> </div>
<div class="line">vagrant@vagrant:~/spdk_repo/spdk$ ./configure</div>
<div class="line">Creating mk/config.mk...done.</div>
<div class="line">Type &#39;make&#39; to build.</div>
<div class="line"> </div>
<div class="line">vagrant@vagrant:~/spdk_repo/spdk$ make</div>
<div class="line">&lt;&lt;output trimmed&gt;&gt;</div>
<div class="line"> </div>
<div class="line">vagrant@vagrant:~/spdk_repo/spdk$ sudo ./scripts/setup.sh</div>
<div class="line">0000:00:0e.0 (80ee 4e56): nvme -&gt; uio_pci_generic</div>
<div class="line"> </div>
<div class="line">vagrant@vagrant:~/spdk_repo/spdk$ sudo build/examples/hello_world</div>
<div class="line">Starting SPDK v18.10-pre / DPDK 18.05.0 initialization...</div>
<div class="line">[ DPDK EAL parameters: hello_world -c 0x1 --legacy-mem --file-prefix=spdk0 --base-virtaddr=0x200000000000 --proc-type=auto ]</div>
<div class="line">EAL: Detected 4 lcore(s)</div>
<div class="line">EAL: Detected 1 NUMA nodes</div>
<div class="line">EAL: Auto-detected process type: PRIMARY</div>
<div class="line">EAL: Multi-process socket /var/run/dpdk/spdk0/mp_socket</div>
<div class="line">EAL: Probing VFIO support...</div>
<div class="line">Initializing NVMe Controllers</div>
<div class="line">EAL: PCI device 0000:00:0e.0 on NUMA socket 0</div>
<div class="line">EAL:   probe driver: 80ee:4e56 spdk_nvme</div>
<div class="line">Attaching to 0000:00:0e.0</div>
<div class="line">Attached to 0000:00:0e.0</div>
<div class="line">Using controller ORCL-VBOX-NVME-VER12 (VB1234-56789        ) with 1 namespaces.</div>
<div class="line">  Namespace ID: 1 size: 1GB</div>
<div class="line">Initialization complete.</div>
<div class="line">INFO: using host memory buffer for IO</div>
<div class="line">Hello world!</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
<ul>
        <li class="footer">Generated by
        <a href="http://www.doxygen.org/index.html">doxygen</a> 1.9.1 </li>
</ul>
</div>
</div>
</body>
</html>
