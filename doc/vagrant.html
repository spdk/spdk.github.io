<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- For Mobile Devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8">
  <meta name="generator" content="Doxygen 1.8.11">
  <title>SPDK: Vagrant Development Environment</title>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,900" type="text/css">
  <link href="../css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="tabs.css" type="text/css">
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div class="container-fluid">
  <div id="top">  <!-- do not remove this div, it is closed by doxygen! -->
    <div class="row no-gutters">
      <div class="col-sm-12">
        <section id="nav">
          <div class="navbar navbar-default navbar-static-top banner-tabs">
            <ul class="nav navbar-nav">
              <li role="presentation">
                <a href="http://www.spdk.io/">
                  <i class="glyphicon glyphicon-home"></i>
                  <span class="box-name">home</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/releases/">
                  <i class="glyphicon glyphicon-download-alt"></i>
                  <span class="box-name">download</span>
                </a>
              </li>
              <li class="active" role="presentation">
                <a href="index.html">
                  <i class="glyphicon glyphicon-book"></i>
                  <span class="box-name">documentation</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/development/">
                  <i class="glyphicon glyphicon-wrench"></i>
                  <span class="box-name">development</span>
                </a>
              </li>
              <li role="presentation">
                <a href="https://ci.spdk.io/">
                  <i class="glyphicon glyphicon-ok"></i>
                  <span class="box-name">CI status</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/community/">
                  <i class="glyphicon glyphicon-envelope"></i>
                  <span class="box-name">community</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/blog/">
                  <i class="glyphicon glyphicon-comment"></i>
                  <span class="box-name">Blog</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/roadmap/">
                  <i class="glyphicon glyphicon-map-marker"></i>
                  <span class="box-name">Roadmap</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/news/">
                  <i class="glyphicon glyphicon-bullhorn"></i>
                  <span class="box-name">News</span>
                </a>
              </li>
            </ul>
          </div>
        </section>
      </div>
    </div>
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('vagrant.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Vagrant Development Environment </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="vagrant_intro"></a>
Introduction</h1>
<p><a href="https://www.vagrantup.com/">Vagrant</a> provides a quick way to get a basic NVMe enabled virtual machine sandbox running without the need for any special hardware. The Vagrant environment for SPDK has support for Ubuntu 16.04 and CentOS 7.2. This environment requires Vagrant 1.9.4 or newer and VirtualBox 5.1 or newer with the matching VirtualBox extension pack.</p>
<p>The VM builds SPDK and DPDK from source which are located at <code>/spdk</code>.</p>
<p>Note: If you are behind a corporate firewall, set <code>http_proxy</code> and <code>https_proxy</code> in your environment before trying to start up the VM. Also make sure that you have installed the optional vagrant module <code>vagrant-proxyconf</code>:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;export http_proxy=...</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;export https_proxy=...</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;vagrant plugin install vagrant-proxyconf</div></div><!-- fragment --><h1><a class="anchor" id="vagrant_config"></a>
VM Configuration</h1>
<p>This vagrant environment creates a VM based on environment variables found in <code>env.sh</code>. To use, edit <code>env.sh</code>, then:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cd scripts/vagrant</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;source ./env.sh</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;vagrant up</div></div><!-- fragment --><p>At this point you can use <code>vagrant ssh</code> to ssh into the VM. The <code>/spdk</code> directory is sync'd from the host system and the build is automatically done. Other notable files:</p>
<ul>
<li><code>build.sh</code>: executed on the VM automatically when provisioned</li>
<li><code>Vagrantfile</code>: startup parameters/commands for the VM</li>
</ul>
<p>The few commands we mention here are enough to get you up and running; for additional support, use the Vagrant help function to learn how to destroy, restart, etc. Further below is sample output from a successful VM launch and execution of the NVMe hello world example application.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;vagrant --help</div></div><!-- fragment --><p>By default, the VM created is configured with:</p><ul>
<li>Ubuntu 16.04</li>
<li>2 vCPUs</li>
<li>4G of RAM</li>
<li>2 NICs (1 x NAT - host access, 1 x private network)</li>
</ul>
<h1><a class="anchor" id="vagrant_providers"></a>
Providers</h1>
<p>Currently only the VirtualBox provider is supported.</p>
<h1><a class="anchor" id="vagrant_example"></a>
Running An Example</h1>
<p>The following shows sample output from starting up a VM and running the NVMe sample application <code>hello_world</code>. If you don't see the NVMe device as seen below in both the <code>lspci</code> output as well as the application output, you likely have a VirtualBox and/or Vagrant versioning issue.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;user@dev-system:~$ cd spdk</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;user@dev-system:~/spdk$ cd scripts/</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;user@dev-system:~/spdk/scripts$ cd vagrant/</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;user@dev-system:~/spdk/scripts/vagrant$ vagrant up</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Bringing machine &#39;default&#39; up with &#39;virtualbox&#39; provider...</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;==&gt; default: Clearing any previously set forwarded ports...</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;==&gt; default: Clearing any previously set network interfaces...</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;==&gt; default: Preparing network interfaces based on configuration...</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    default: Adapter 1: nat</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    default: Adapter 2: hostonly</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;==&gt; default: Forwarding ports...</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    default: 22 (guest) =&gt; 2222 (host) (adapter 1)</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;==&gt; default: Running &#39;pre-boot&#39; VM customizations...</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;==&gt; default: Booting VM...</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;==&gt; default: Waiting for machine to boot. This may take a few minutes...</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    default: SSH address: 127.0.0.1:2222</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    default: SSH username: vagrant</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    default: SSH auth method: private key</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    default:</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    default: Vagrant insecure key detected. Vagrant will automatically replace</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    default: this with a newly generated keypair for better security.</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    default:</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    default: Inserting generated public key within guest...</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    default: Removing insecure key from the guest if it&#39;s present...</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    default: Key inserted! Disconnecting and reconnecting using new SSH key...</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;==&gt; default: Machine booted and ready!</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;==&gt; default: Checking for guest additions in VM...</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    default: Guest Additions Version: 5.1</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    default: VirtualBox Version: 5.1</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;==&gt; default: Configuring and enabling network interfaces...</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;==&gt; default: Rsyncing folder: /home/peluse/spdk/ =&gt; /spdk</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;==&gt; default: Mounting shared folders...</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    default: /vagrant =&gt; /home/peluse/spdk/scripts/vagrant</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;==&gt; default: Running provisioner: shell...</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    default: Running: /tmp/vagrant-shell20170524-2405-3cam94.sh</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;==&gt; default: vm.nr_hugepages = 1024</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;==&gt; default: Hit:1 http://us.archive.ubuntu.com/ubuntu xenial InRelease</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;&lt;&lt; some output trimmed &gt;&gt;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;==&gt; default: Fetched 2,329 kB in 3s (588 kB/s)</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;==&gt; default: Reading package lists...</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;==&gt; default: Building dependency tree...</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;==&gt; default: Reading state information...</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;==&gt; default: Calculating upgrade...</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;==&gt; default: The following packages have been kept back:</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;==&gt; default:   linux-generic linux-headers-generic linux-image-generic</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;==&gt; default: The following packages will be upgraded:</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;==&gt; default:   accountsservice apparmor apt apt-transport-https apt-utils base-files bash</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;&lt;&lt; some output trimmed &gt;&gt;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;==&gt; default: 167 upgraded, 0 newly installed, 0 to remove and 3 not upgraded.</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;==&gt; default: Need to get 124 MB of archives.</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;==&gt; default: After this operation, 39.5 MB of additional disk space will be used.</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;==&gt; default: Get:1 http://us.archive.ubuntu.com/ubuntu xenial-updates/main amd64 base-files amd64 9.4ubuntu4.4 [60.                 2 kB]</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;&lt;&lt; some output trimmed &gt;&gt;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;==&gt; default: Preconfiguring packages ...</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;==&gt; default: Fetched 11.8 MB in 17s (669 kB/s)</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;==&gt; default: Setting up libc6:amd64 (2.23-0ubuntu7) ...</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;==&gt; default: Processing triggers for libc-bin (2.23-0ubuntu3) ...</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;&lt;&lt; some output trimmed &gt;&gt;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;==&gt; default: Running provisioner: shell...</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    default: Running: /tmp/vagrant-shell20170524-2405-1wt8p3c.sh</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;==&gt; default: 0:/tmp/vagrant-shell</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;==&gt; default: SUDOCMD: sudo -H -u vagrant</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;==&gt; default: KERNEL_OS: GNU/Linux</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;==&gt; default: KERNEL_MACHINE: x86_64</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;==&gt; default: KERNEL_RELEASE: 4.4.0-21-generic</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;==&gt; default: KERNEL_VERSION: #37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;==&gt; default: DISTRIB_ID: Ubuntu</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;==&gt; default: DISTRIB_RELEASE: 16.04</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;==&gt; default: DISTRIB_CODENAME: xenial</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;==&gt; default: DISTRIB_DESCRIPTION: Ubuntu 16.04 LTS</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;==&gt; default: Reading package lists...</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;==&gt; default: Building dependency tree...</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;&lt;&lt; some output trimmed &gt;&gt;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;==&gt; default: Processing triggers for libc-bin (2.23-0ubuntu3) ...</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;==&gt; default: Creating CONFIG.local...</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;==&gt; default: done.</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;==&gt; default: Type &#39;make&#39; to build.</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;==&gt; default: Configuration done</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;==&gt; default: make[3]: Entering directory &#39;/spdk/dpdk&#39;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;==&gt; default: == Build lib</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;==&gt; default: == Build lib/librte_compat</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;==&gt; default: == Build lib/librte_eal</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;==&gt; default: == Build lib/librte_eal/common</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;==&gt; default:   SYMLINK-FILE include/rte_compat.h</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;&lt;&lt; some output trimmed &gt;&gt;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;==&gt; default: Build complete [x86_64-native-linuxapp-gcc]</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;==&gt; default: make[3]: Leaving directory &#39;/spdk/dpdk&#39;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;==&gt; default:   CC lib/blob/blobstore.o</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;==&gt; default:   CC lib/bdev/bdev.o</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;&lt;&lt; some output trimmed &gt;&gt;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;==&gt; default:   LINK test/lib/nvme/e2edp/nvme_dp</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;==&gt; default: Running provisioner: shell...</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    default: Running: inline script</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;==&gt; default: 0000:00:0e.0 (80ee 4e56): nvme -&gt; uio_pci_generic</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;user@dev-system:~/spdk/scripts/vagrant$ vagrant ssh</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;Welcome to Ubuntu 16.04 LTS (GNU/Linux 4.4.0-21-generic x86_64)</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; * Documentation:  https://help.ubuntu.com/</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;vagrant@localhost:~$ lspci | grep &quot;Non-Volatile&quot;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;00:0e.0 Non-Volatile memory controller: InnoTek Systemberatung GmbH Device 4e56</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;vagrant@localhost:~$ sudo /spdk/examples/nvme/hello_world/hello_world</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;Starting DPDK 17.02.0 initialization...</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;[ DPDK EAL parameters: hello_world -c 0x1 --file-prefix=spdk_pid17681 ]</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;EAL: Detected 2 lcore(s)</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;EAL: Probing VFIO support...</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;Initializing NVMe Controllers</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;EAL: PCI device 0000:00:0e.0 on NUMA socket 0</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;EAL:   probe driver: 80ee:4e56 spdk_nvme</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;Attaching to 0000:00:0e.0</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;Attached to 0000:00:0e.0</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;Using controller ORCL-VBOX-NVME-VER12 (VB1234-56789        ) with 1 namespaces.</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  Namespace ID: 1 size: 1GB</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;Initialization complete.</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;Hello world!</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;vagrant@localhost:~$</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
</div>
