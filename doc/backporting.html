<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="generator" content="Doxygen 1.10.0" />
  <title>SPDK: Backporting</title>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <script type="text/javascript" src="../js/doxyboot.js"></script>
  <script type="text/javascript" src="./navtree.js"></script>
  <link href="../css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="../css/spdk.css" rel="stylesheet" type="text/css">
</head>
<body>
  <nav class="navbar navbar-expand-md navbar-dark bg-dark px-2">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/" aria-label="SPDK">
      <img src="/img/spdk.svg"  width="36" height="36" alt="Storage Performance Development Kit" />
    </a>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <div class="navbar-nav me-auto">
        <a class="nav-link header-link active" href="../doc/">Documentation</a>
        <a class="nav-link header-link" href="../development/">Development</a>
        <a class="nav-link header-link" href="../community/">Community</a>
        <a class="nav-link header-link" href="../blog/">Blog</a>
      </div>
      <div class="navbar-nav ms-auto me-3">
        <a class="nav-link header-link" href="https://github.com/spdk/spdk">
          <svg xmlns="http://www.w3.org/2000/svg" class="navbar-nav-svg"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
        </a>
      </div>
    </div>
  </nav>
  <div class="container-fluid doc">
      <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('backporting.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Backporting</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_backporting"></a> In SPDK updating supported versions, other than the latest <code>master</code>, is carried out through a process called "backporting", which is owned by core maintainers and backporters (currently only Krzysztof Kara≈õ). For such purposes, fixes to known issues or improvements to user experience, without introducing new functionality, are usually chosen.</p>
<h1><a class="anchor" id="backporting_other_branches"></a>
How to backport to other SPDK maintained branches</h1>
<p>Backporting process consists of two phases:</p>
<h2>Selection</h2>
<p><code>selection</code> may be done by anyone who knows about a patch that should be introduced to an older branch. A patch can be selected by adding a hashtag with desired destination release. This requires rights to change <code>Hashtags</code> field on a Gerrit patch, so its owner, core maintainers or somebody with Gerrit role <code>backporter</code> (currently only Krzysztof Karas <code>krzysztof.karas@intel.com</code>) will be able to add necessary tag. Patch <a href="https://review.spdk.io/gerrit/c/spdk/spdk/+/17093">a4a0462</a> is a good example: <code>23.01</code> and <code>23.05</code> were added in the <code>Hashtags</code> field of this patch, indicating that it should be pushed to the corresponding branches <code>v23.01.x</code> and <code>v23.05.x</code>.</p>
<h2>Preparation</h2>
<p><code>preparation</code> may require some changes to the original code introduced by the patch, as it is taken from a newer version of the repository and uploaded on top of an older one. Patch <a href="https://review.spdk.io/gerrit/c/spdk/spdk/+/17093">a4a0462</a> and its backport <a href="https://review.spdk.io/gerrit/c/spdk/spdk/+/18981">62b467b</a> are a good example, because the code that they add is slightly different. Additionally, during <code>preparation</code> commit message must be changed:</p>
<ul>
<li>footer should be stripped off of lines containing <code>Reviewed-by</code> and <code>Tested-by</code>,</li>
<li><code>Reviewed-on</code> line should contain, in parentheses, name of the branch it was pulled from,</li>
<li>a line containing <code>(cherry picked from commit&lt;original_commit_hash&gt;)</code> should be added,</li>
<li>if the code was modified heavily, then the body of the message should match that.</li>
</ul>
<p>What should remain unchanged in commit message:</p>
<ul>
<li>title of the patch,</li>
<li><code>Change-Id</code>,</li>
<li>Signed-off-by of the original patch author.</li>
</ul>
<h2><a class="anchor" id="backporting_script"></a>
Backporting script</h2>
<p>In SPDK there is a script automating above process to some degree. It is located in <code>scripts/backport.sh</code> and it requires users to have Gerrit username and SSH configuration, as it pulls lists of existing commits to compare states of <code>master</code> and target branch, to which backporting should be performed. The script will carry out most of commit message changes and try to apply code as is. If it ever encounters a merge conflict, it will stop and save backporting progress to a checkpoint file, from which user might resume after they are done fixing merge conflicts.</p>
<h1><a class="anchor" id="updating_submodules"></a>
Updating submodules</h1>
<p>SPDK uses forks of other repositories as submodules. This is done for two reasons:</p>
<ul>
<li>to disable components that are unnecessary for SPDK to work,</li>
<li>to introduce bug fixes and resolve compatibility issues.</li>
</ul>
<p>The following example shows instructions on how DPDK would be updated from version 23.03 to 23.07, but updating other submodules should be done by analogy.</p>
<h2>1. Enter SPDK directory and update master branch</h2>
<div class="fragment"><div class="line">cd &lt;path_to_spdk&gt;; git checkout master; git pull</div>
</div><!-- fragment --><h2>2. Enter DPDK submodule directory and update it</h2>
<div class="fragment"><div class="line">cd &lt;path_to_spdk&gt;/dpdk; git checkout master; git pull</div>
</div><!-- fragment --><h2>3. Copy and checkout the latest fork</h2>
<div class="fragment"><div class="line">git branch -c spdk-23.07 spdk-23.07-copy; git checkout spdk-23.07-copy</div>
</div><!-- fragment --><p>Modifying a copy of the fork, instead of working directly on it, will make it easier to go back in the future, if changes to the code are required later in the process. Otherwise, the branch would need to be reset and local progress would be lost.</p>
<p>Notice that branches in submodules are named differently than SPDK branches. They usually consist of <code>spdk-</code> prefix followed by the version of submodule it corresponds to. In this case, for DPDK 23.07 the branch is named <code>spdk-23.07</code>.</p>
<h2>4. Cherry-pick patches from previous submodule fork and verify them</h2>
<p>This requires browsing through <a href="https://review.spdk.io/gerrit/q/project:spdk/dpdk">DPDK submodule repository</a> and verifying whether all patches from previous fork are necessary and if further changes should be introduced to ensure compatibility. In this case, patches from DPDK submodule branch <code>spdk-23.03</code> should be pulled and applied to <code>spdk-23.07</code>. At this point three scenarios are possible:</p>
<ul>
<li>All patches are necessary and sufficient to make new version of the submodule compatible with SPDK.</li>
<li>Some patches are unnecessary, because DPDK code has been changed and it matches SPDK needs, so they can be skipped.</li>
<li>Patches from previous submodule fork are insufficient and further changes to the DPDK code are required. That means either modifications to existing, pulled patches or creating new changes. The latter might require debugging or manually checking dependencies.</li>
</ul>
<p>Patches for submodules should be pushed to appropriate branch:</p>
<div class="fragment"><div class="line">git push https://review.spdk.io/gerrit/spdk/dpdk HEAD:refs/for/spdk-23.07</div>
</div><!-- fragment --><p>Patches uploaded to Gerrit need to go through usual testing and review process before they are merged. Only after that the submodule update may be continued. Then, after the fork is ready, the submodule update may be carried out:</p>
<div class="fragment"><div class="line">cd &lt;path_to_spdk&gt;; git checkout master; git pull</div>
<div class="line">cd &lt;path_to_spdk&gt;/dpdk; git checkout spdk-23.07; git pull</div>
<div class="line">cd ..; git add dpdk; git commit --signoff</div>
<div class="line">git push https://review.spdk.io/gerrit/spdk/spdk HEAD:refs/for/master</div>
</div><!-- fragment --><p>Above commands update SPDK master branch, check out the newest fork of the DPDK submodule, then add it to a commit and finally push the submodule update to Gerrit. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
<ul>
        <li class="footer">Generated by
        <a href="http://www.doxygen.org/index.html">doxygen</a> 1.10.0 </li>
</ul>
</div>
</div>
</body>
</html>
