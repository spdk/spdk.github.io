<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="generator" content="Doxygen 1.9.1" />
  <title>SPDK: Changelog</title>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <script type="text/javascript" src="../js/doxyboot.js"></script>
  <script type="text/javascript" src="./navtree.js"></script>
  <link href="../css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="../css/spdk.css" rel="stylesheet" type="text/css">
</head>
<body>
  <nav class="navbar navbar-expand-md navbar-dark bg-dark px-2">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/" aria-label="SPDK">
      <img src="/img/spdk.svg"  width="36" height="36" alt="Storage Performance Development Kit" />
    </a>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <div class="navbar-nav me-auto">
        <a class="nav-link header-link active" href="../doc/">Documentation</a>
        <a class="nav-link header-link" href="../development/">Development</a>
        <a class="nav-link header-link" href="../community/">Community</a>
        <a class="nav-link header-link" href="../blog/">Blog</a>
      </div>
      <div class="navbar-nav ms-auto me-3">
        <a class="nav-link header-link" href="https://github.com/spdk/spdk">
          <svg xmlns="http://www.w3.org/2000/svg" class="navbar-nav-svg"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
        </a>
      </div>
    </div>
  </nav>
  <div class="container-fluid doc">
      <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('changelog.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Changelog </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_changelog"></a> </p>
<h1><a class="anchor" id="changelog-v24-05"></a>
v24.05: (Upcoming Release)</h1>
<h2>accel</h2>
<p>spdk_accel_get/set_opts() has changed to act more like <a class="el" href="structspdk__bdev.html">spdk_bdev</a>'s variant.</p>
<h2>bdev</h2>
<p>Added <code><a class="el" href="bdev_8h.html#af833943e22885817e6954426b6a11b5f" title="Get controller attributes for the bdev.">spdk_bdev_get_nvme_ctratt()</a></code> API to get controller attributes of bdev.</p>
<h2>lvol</h2>
<p>Added <code>bdev_lvol_start_shallow_copy</code> RPC to start a shallow copy of an lvol over a given bdev and <code>bdev_lvol_check_shallow_copy</code> RPC to get the status of the operation. These RPCs use the new API <code>spdk_lvol_shallow_copy</code>.</p>
<h2>blobstore</h2>
<p>Added new API <code>spdk_bs_blob_shallow_copy</code> to make a shallow copy from a blob to a blobstore device. Only clusters allocated to the blob will be written on the device.</p>
<h2>event</h2>
<p>SPDK applications can now start with <code>--wait-for-rpc</code> and JSON configuration provided at the same time.</p>
<p>Struct <code><a class="el" href="structspdk__app__opts.html" title="Event framework initialization options.">spdk_app_opts</a></code> was extended by <code>json_data</code> and <code>json_data_size</code> fields allowing user to provide a buffer with JSON config as alternative to providing JSON config file path (these fields are mutually exclusive).</p>
<h2>init</h2>
<p>Function <code>spdk_subsystem_init_from_json_config</code> is deprecated and will be removed in 24.09 release. Please use <code>spdk_subsystem_load_config</code> instead.</p>
<h2>nvme</h2>
<p>Added <code>spdk_nvme_ctrlr_get_max_sges</code>.</p>
<h2>bdev_uring</h2>
<p>Added <code>bdev_uring_rescan</code> RPC to allow rescaning the size of uring bdev.</p>
<h2>iscsi</h2>
<p>Added <code>iscsi_get_stats</code> RPC method to get stat information about all active connections.</p>
<p>Added <code>iscsi_enable_histogram</code> RPC method to enable or disable histogram for specified iscsi target.</p>
<p>Added <code>iscsi_get_histogram</code> RPC method to get histogram for specified iscsi target.</p>
<h2>thread</h2>
<p>spdk_iobuf_get/set_opts() has changed to act more like <a class="el" href="structspdk__bdev.html">spdk_bdev</a>'s variant.</p>
<h2>trace</h2>
<p>Merged <code>struct spdk_trace_flags</code> and <code>struct spdk_trace_histories</code> into new <code>struct <a class="el" href="structspdk__trace__file.html">spdk_trace_file</a></code>. Also renamed <code>spdk_get_trace_histories_size()</code> to <code>spdk_get_trace_file_size()</code>.</p>
<h2>nvmf</h2>
<p>Added support for namespace masking using new C APIs <code>spdk_nvmf_ns_add_host</code> and <code>spdk_nvmf_ns_remove_host</code> and RPCs <code>nvmf_ns_add_host</code> and <code>nvmf_ns_remove_host</code>. Users must pass new <code>--no-auto-visible</code> parameter to <code>nvmf_subsystem_add_ns</code> RPC to allow namespace masking to be controlled by these new RPCs.</p>
<p>Added <code>spdk_nvmf_subsystem_get_ana_state</code> API to get current ANA state of a particular ANA group ID.</p>
<p>Added support for enabling mDNS-based discovery of nvmf target for TCP transport with the addition of nvmf_publish_mdns_prr and nvmf_stop_mdns_prr RPCs.</p>
<h2>spdk_trace</h2>
<p><code>spdk_trace</code> has learned how to use the most recent trace file in /dev/shm when the user has specified neither <code>-f</code> nor <code>-s</code> options. This is only available on Linux since FreeBSD does not mount have a /dev/shm mount.</p>
<h1>v24.01</h1>
<h2>accel</h2>
<p>Added support for new operations for computing Data Integrity Field (DIF), <code><a class="el" href="accel_8h.html#a9c58d3dae8d2ffb15a7cb582ac503bac" title="Submit a Data Integrity Field (DIF) verify request.">spdk_accel_submit_dif_verify()</a></code>, <code><a class="el" href="accel_8h.html#a2d32c08aceebbe4ccb842a33fc3f0e5e" title="Submit a Data Integrity Field (DIF) generate request.">spdk_accel_submit_dif_generate()</a></code> and <code><a class="el" href="accel_8h.html#a2289636004169b418ed4e2a86217e4ff" title="Submit a Data Integrity Field (DIF) copy and generate request.">spdk_accel_submit_dif_generate_copy()</a></code>.</p>
<p>Added <code><a class="el" href="accel_8h.html#a72b6ffa90024fbdef55aae9a37cc71b0" title="Return the name of an operation based on the opcode.">spdk_accel_get_opcode_name()</a></code> API that returns name of an operation.</p>
<p>Added <code>spdk_accel_get_module()</code> API that returns pointer to a module.</p>
<p>Added optional <code>init()</code> and <code>fini()</code> callbacks to <code><a class="el" href="structspdk__accel__driver.html" title="Platform driver responsible for executing tasks in a sequence.">spdk_accel_driver</a></code> in order to allow drivers to initialize and clean up resources by the driver.</p>
<h2>accel_error</h2>
<p>Added new <code>error</code> accel module that allows user to inject error to selected accel operations.</p>
<h2>bdev</h2>
<p>Added <code><a class="el" href="group__bdev__io__submit__functions.html#ga42545d4c7c98398a8750a30b26167a3d" title="Submit an NVMe I/O command to the bdev.">spdk_bdev_nvme_iov_passthru_md()</a></code> API to allow sending larger passthru commands.</p>
<p>Added <code>max_rw_size</code> field to <code><a class="el" href="structspdk__bdev.html">spdk_bdev</a></code> structure allowing bdev modules to specify maximum size of an I/O.</p>
<p>Added <code>iobuf_small_cache_size</code> and <code>iobuf_large_cache_size</code> parameters to <code>bdev_set_options</code> RPC making iobuf use in bdev configurable.</p>
<h2>bdev_raid</h2>
<p>Added support for rebuild in raid1 and raid5f levels.</p>
<p>Added <code>superblock</code> argument to <code>bdev_raid_create</code> RPC to allow writing out raid metadata to a superblock. It can be then re-created from examined base bdevs, without the need to issue <code>bdev_raid_create</code>.</p>
<p>Added <code>bdev_raid_add_base_bdev</code> RPC to add a base bdevs to an existing raid bdev.</p>
<p>Added <code>bdev_raid_set_options</code> RPC that changes options for raid bdev module, currently allows setting <code>process_window_size_kb</code> affecting background operations like rebuild.</p>
<h2>blobstore</h2>
<p>Added <code><a class="el" href="blob_8h.html#a1bd61903827b230cf2f6d25fb321e8d0" title="Grow a blobstore to fill the underlying device.">spdk_bs_grow_live()</a></code> and <code><a class="el" href="blob__bdev_8h.html#a7a00c54abc3873ba2bdd6541ab01dc0e" title="Updates number of blocks of a blobstore block device.">spdk_bdev_update_bs_blockcnt()</a></code> API that can be used to increase size of blobstore filling the underlying device without first closing the blobstore.</p>
<h2>env</h2>
<p>Added SPDK command line parameter <code>--no-huge</code>, which enables SPDK to run without hugepages.</p>
<h2>event</h2>
<p>Added SPDK command line parameter <code>--interrupt-mode</code>, which enables to run SPDK in interrupt mode. Effective only if all components used in the application, support interrupt mode.</p>
<h2>ftl</h2>
<p>Added <code>rpc_bdev_ftl_get_properties</code> and <code>bdev_ftl_set_property</code> RPC with matching API calls, to allow modification of FTL device properties.</p>
<h2>idxd</h2>
<p>Added <code><a class="el" href="idxd_8h.html#a100dd0931609fd0604282bd0ba0d88cd" title="Build and submit a DIF check request.">spdk_idxd_submit_dif_check()</a></code> and <code><a class="el" href="idxd_8h.html#a5bf4736bd1b3e0ecfc19e51894c52bf0" title="Build and submit a DIF insert request.">spdk_idxd_submit_dif_insert()</a></code> API to support new operations for computing Data Integrity Field (DIF).</p>
<h2>json</h2>
<p>Added <code>spdk_json_write_uuid()</code>, <code>spdk_json_write_named_uuid()</code> and <code>spdk_json_decode_uuid()</code> to help with writing and decoding UUID.</p>
<h2>nvme</h2>
<p>A new transport option <code>rdma_max_cq_size</code> was added to limit indefinite growth of CQ size.</p>
<p>Added <code><a class="el" href="nvme_8h.html#a1ea63282a56675a3922c8abebdc8d0e9" title="Send the given NVM I/O command with metadata to the NVMe controller.">spdk_nvme_ctrlr_cmd_iov_raw_with_md()</a></code> API to allow sending larger passthru commands.</p>
<h2>nvmf</h2>
<p>Added <code>max_discard_size_kib</code> and <code>max_write_zeroes_size_kib</code> to <code>nvmf_create_subsystem</code> RPC to set the maximum discard size and maximum write zeroes size.</p>
<p>Added new optional <code>--ana-state</code> (or shortly <code>-n</code>) parameter to <code>nvmf_subsystem_add_listener</code> RPC.</p>
<p>Added public APIs <code><a class="el" href="nvmf_8h.html#af2865d5c13e5c7ca972e1577796d8dcf" title="Get whether a subsystem supports Asymmetric Namespace Access (ANA) reporting.">spdk_nvmf_subsystem_get_ana_reporting()</a></code> and <code><a class="el" href="nvmf_8h.html#a9124f6370456043e55419fdf64879c3e" title="Set Asymmetric Namespace Access (ANA) state for the specified ANA group id.">spdk_nvmf_subsystem_set_ana_state()</a></code>, replacing the internal functions <code>nvmf_subsystem_get_ana_reporting()</code> and <code>nvmf_subsystem_set_ana_state()</code> respectively.</p>
<p>Added support for NVMe-oF referrals in NVMe-oF target with addition of <code><a class="el" href="nvmf_8h.html#aa9a1143157acef6330d8c8c71362793c" title="Add a discovery service referral to an NVMe-oF target.">spdk_nvmf_tgt_add_referral()</a></code> and <code><a class="el" href="nvmf_8h.html#a28824d5f18a5ddf04007906f012199be" title="Remove a discovery service referral from an NVMeoF target.">spdk_nvmf_tgt_remove_referral()</a></code> API and <code>nvmf_discovery_add_referral</code>, <code>nvmf_discovery_remove_referral</code> and <code>nvmf_discovery_get_referrals</code> RPC.</p>
<p>Added <code><a class="el" href="nvmf_8h.html#ae365f2d881a64ca5adcfe9a179a84597" title="Set custom handlers for namespace reservation operations.">spdk_nvmf_set_custom_ns_reservation_ops()</a></code> API allowing to register custom handlers for reservation operations.</p>
<h2>scsi</h2>
<p>Added support for <code>SPDK_SBC_WRITE_SAME_10</code> and <code>SPDK_SBC_WRITE_SAME_16</code>.</p>
<h2>thread</h2>
<p>Added <code>iobuf_get_stats</code> RPC and <code><a class="el" href="thread_8h.html#a22cb35e6bb7625b1338c4db9de32bc0f" title="Get iobuf statistics.">spdk_iobuf_get_stats()</a></code> API to track iobuf use across components.</p>
<h2>trace</h2>
<p>Added <code><a class="el" href="trace_8h.html#a47b2f35adf0e5d3db035c759d6d01c8d" title="Initialize trace environment for an user created thread.">spdk_trace_register_user_thread()</a></code> to initialize trace environment and <code><a class="el" href="trace_8h.html#a2f3c2c36cb52730ac3a98e9d33fd9093" title="De-initialize trace environment for an user created thread.">spdk_trace_unregister_user_thread()</a></code> to de-initialize trace environment for a user created thread.</p>
<p>Modified <code><a class="el" href="trace_8h.html#a3014ded1a40e39f65b01efe27ec2893c" title="Initialize the trace environment.">spdk_trace_init()</a></code> to take number of user created threads as a parameter.</p>
<h2>ublk</h2>
<p>Added <code>ublk_recover_disk</code> RPC to support recovering after restarting ublk target.</p>
<h2>vhost</h2>
<p>Added <code>caw_iov</code> field to struct <code><a class="el" href="structspdk__scsi__task.html">spdk_scsi_task</a></code> to support SBC-3 compare_and_write IO.</p>
<p>Added parameter <code>delay</code> to <code>vhost_create_scsi_controller</code> RPC which allows user to defer starting the vhost-scsi controller until adding the scsi target is completed.</p>
<p>Added <code>vhost_start_scsi_controller</code> RPC to start vhost-scsi controller, it could be used to support live recovery feature of vhost-scsi target.</p>
<h2>rpc</h2>
<p>Functions <code>spdk_rpc_listen</code>, <code>spdk_rpc_accept</code> and <code>spdk_rpc_close</code> are deprecated and will be removed in 24.09 release. Please use <code>spdk_rpc_server_listen</code>, <code>spdk_rpc_server_accept</code> and <code>spdk_rpc_server_close</code> instead.</p>
<h1>v23.09</h1>
<h2>accel</h2>
<p>Added <code><a class="el" href="accel_8h.html#aaebd6fe37b7af8036e42184adc407ce4" title="Get minimum buffer alignment to execute a given operation.">spdk_accel_get_buf_align()</a></code> API to get minimum buffer alignment to execute a given operation.</p>
<p>Added <code>get_operation_info()</code> callback for accel_modules to return constraints for a given operation.</p>
<h2>bdev</h2>
<p>Added <code><a class="el" href="bdev_8h.html#af29e58cf7325dbc4f4ca8e0abb2d9506" title="Open a block device for I/O operations asynchronously with options.">spdk_bdev_open_async()</a></code> API to allow asynchronous bdev open that waits for specified time until the block device appears.</p>
<h2>bdev_nvme</h2>
<p>Added <code>bdev_nvme_enable_controller</code> and <code>bdev_nvme_disable_controller</code> RPC to enable and disable NVMe controller. For NVMe multipath <code>cntlid</code> is used to select only one NVMe-oF controller.</p>
<p>Added <code>cntlid</code> field to <code>bdev_nvme_reset_controller</code> RPC to support resetting only one NVMe-oF controller in multipath configuration.</p>
<h2>bdev_raid</h2>
<p>Added <code>bdev_raid_remove_base_bdev</code> RPC to remove a base bdev from existing raid bdev.</p>
<h2>dpdk</h2>
<p>Updated DPDK submodule to DPDK 23.07.</p>
<h2>env</h2>
<p>The <code>phys_addr</code> parameter in <code>spdk_*_malloc()</code> functions is now invalid. Passing non-NULL value will return NULL from the functions. The parameter was deprecated in SPDK 19.04. For retrieving physical addresses, <code><a class="el" href="env_8h.html#ae73d54bd295c1d46aa9a45df17e6aa40" title="Get the physical address of a buffer.">spdk_vtophys()</a></code> should be used instead.</p>
<h2>go</h2>
<p>Added JSON-RPC 2.0 client written in Go to ease communication with SPDK. Please see the documentation at <code>go/rpc/</code> and example at <code>examples/go/</code>.</p>
<h2>init</h2>
<p>Options for the JSON-RPC server initialization were added. The options are defined via the <code><a class="el" href="structspdk__rpc__opts.html" title="Structure with optional parameters for the JSON-RPC server initialization.">spdk_rpc_opts</a></code> structure and is passed to the existing API <code><a class="el" href="init_8h.html#adbfa73a5f5120e5a80d7b33beb7df862" title="Create SPDK JSON-RPC server listening at provided address and start polling it for connections.">spdk_rpc_initialize()</a></code> as a new argument. The options include <code>log_file</code> and <code>log_level</code>.</p>
<h2>intel-ipsec-mb</h2>
<p>Updated intel-ipsec-mb submodule to v1.4.</p>
<h2>jsonrpc</h2>
<p>New APIs, <code>spdk_jsonrpc_set_log_level</code> and <code>spdk_jsonrpc_set_log_file</code>, were added to enable logging JSON RPC calls history.</p>
<h2>log</h2>
<p>New APIs, <code>spdk_flog</code> and <code>spdk_vflog</code>, were added to write messages to the specified log file.</p>
<h2>nvme</h2>
<p>The <code><a class="el" href="structspdk__nvme__accel__fn__table.html" title="Function table for the NVMe accelerator device.">spdk_nvme_accel_fn_table</a></code> interface has been extended with callbacks allowing users to chain multiple accel operations. Users can now send requests with an existing accel sequence by setting the <code>accel_sequence</code> field in <code><a class="el" href="structspdk__nvme__ns__cmd__ext__io__opts.html" title="Structure with optional IO request parameters.">spdk_nvme_ns_cmd_ext_io_opts</a></code> if the controller supports it (i.e. sets the <code>SPDK_NVME_CTRLR_ACCEL_SEQUENCE_SUPPORTED</code> flag) and the user implements the necessary <code><a class="el" href="structspdk__nvme__accel__fn__table.html" title="Function table for the NVMe accelerator device.">spdk_nvme_accel_fn_table</a></code> callbacks.</p>
<p>The NVMe bdev will now advertise support for accel sequences if the <code>allow_accel_sequence</code> flag is set in <code>bdev_nvme_set_options</code> and the underlying controller also supports them.</p>
<p>The TCP transport will now calculate data digest using the accel sequence APIs if they're available.</p>
<p>Added <code><a class="el" href="nvme_8h.html#a935eb1d9b76305022e0d88e3594c38c1" title="Return the connection status of a given qpair.">spdk_nvme_qpair_is_connected()</a></code> API to check the connection status.</p>
<h2>nvmf</h2>
<p>The <code>spdk_nvmf_request::data</code> field has been removed: instead, clients should set <code>-&gt;iov</code> and <code>-&gt;iovcnt</code> appropriately, as nvmf request APIs now expect any data buffers to be described there. <code>spdk_nvmf_request_get_data()</code> has been removed.</p>
<p><code>transport</code> field in <code>listen_addresses</code> of <code>nvmf_get_subsystems</code> RPC is deprecated. <code>trtype</code> field should be used instead. <code>transport</code> field will be removed in 24.01 release.</p>
<p>Added <code><a class="el" href="nvmf_8h.html#a264077cd7633ac2103bd4e293e8a94f5" title="Accept new connections on the address provided.">spdk_nvmf_subsystem_add_listener_ext()</a></code> API for accepting new connections on the provided address, now allowing to specify additional options for the listener.</p>
<p>Deprecated <code>spdk_nvmf_subsytem_any_listener_allowed()</code> API (to be removed in 24.01) and replaced with <a class="el" href="nvmf_8h.html#a8f4f76f43797274eaf8b08a0894526f6" title="Check whether a subsystem allows any listen address or only addresses in the allowed list.">spdk_nvmf_subsystem_any_listener_allowed()</a>` API fixing the typo.</p>
<p>Added <code><a class="el" href="nvmf_8h.html#a0241868432ed4cd5687f5add03e52860" title="Checks whether a given subsystem is a discovery subsystem.">spdk_nvmf_subsystem_is_discovery()</a></code> API to check whether a given susbystem is discovery subsystem.</p>
<h2>scripts</h2>
<p><code>setup.sh</code> now supports interactive mode for device selection and hugepage reservation.</p>
<p>Added <code>backport.sh</code> script that formalizes process of backporting commits from latest SPDK, to specific release branches. Please see <a href="https://spdk.io/doc/backporting.html">documentation</a>.</p>
<h2>thread</h2>
<p>Added <code><a class="el" href="thread_8h.html#a9968fb813a07f35898a96f6042a30f12" title="Check if the specified spdk_thread is the app thread.">spdk_thread_is_app_thread()</a></code> API to check if specified spdk_thread is the app thread.</p>
<h2>util</h2>
<p>Extended DIF support to CRC-32 and CRC-64 format of the Protection Information.</p>
<p>Added <code><a class="el" href="crc64_8h.html#a9c5a5138b7fb9ded7acb97ed6f9095ea" title="Calculate a CRC-64 checksum (Rocksoft), for NVMe Protection Information.">spdk_crc64_nvme()</a></code> and <code><a class="el" href="crc32_8h.html#af5b03c08701498723dea77be3b10b2c5" title="Calculate a CRC-32C checksum, for NVMe Protection Information.">spdk_crc32c_nvme()</a></code>, CRC-64 and CRC-32C checksums compatible with NVMe Protection Information.</p>
<h1>v23.05</h1>
<h2>accel</h2>
<p>Added API <code>spdk_accel_submit_xor</code> to perform XOR.</p>
<p>Configuration of <code>mlx5_pci</code> driver of <code>accel_dpdk_cryptodev</code> module was changed. Now key and key2 should have equal length and key size in hexlified form can be either 32 bytes for 128b XTS key or 64 bytes for 256b XTS key. Support of the wrapped crypto credentials mode for this driver is dropped, only plain text mode is supported.</p>
<p>The accel library will now collect statistics on the number of executed operations and processed bytes. These statistics can be retreived using the <code>accel_get_stats</code> RPC.</p>
<p>Added support for appending a crc32 calculation to an accel sequence.</p>
<h2>bdev</h2>
<p>A new API <code>spdk_bdev_module_claim_bdev_desc</code> was added. Unlike <code>spdk_bdev_module_claim_bdev</code>, this function requires a bdev descriptor to be passed and the claim is automatically released when the descriptor is closed. It allows bdev modules to claim bdevs as a single writer, multiple writers, or multiple readers.</p>
<p>New APIs <code>spdk_bdev_quiesce</code>, <code>spdk_bdev_unquiesce</code>, <code>spdk_bdev_quiesce_range</code> and <code>spdk_bdev_unquiesce_range</code> were added. These allow I/O to be quiesced on an entire bdev or a specified LBA range.</p>
<p>Removed <code><a class="el" href="structspdk__bdev__ext__io__opts.html" title="Structure with optional IO request parameters.">spdk_bdev_ext_io_opts</a></code> from <code><a class="el" href="structspdk__bdev__io.html">spdk_bdev_io</a></code> and replaced it with fields that were missing in <code><a class="el" href="structspdk__bdev__io.html">spdk_bdev_io</a></code>.</p>
<p>It is now possible to submit an I/O with an associated accel sequence. All operations in such sequence will be executed prior to sending the I/O (writes) or after its completion (reads).</p>
<h2>env</h2>
<p>New functions <code>spdk_env_get_main_core</code> and <code>spdk_env_get_cpuset</code> were added.</p>
<p>It is now possible to run applications on cores with IDs greater than 128 by passing a core map using the <code>--lcores</code> parameter.</p>
<h2>examples</h2>
<p><code>examples/nvme/perf</code> application now accepts <code>--use-every-core</code> parameter that changes the existing worker and namespace association logic to access every namespace from each worker. This replicates behavior of bdevperf application when <code>-C</code> option is provided.</p>
<h2>gpt</h2>
<p>GPT bdevs now use the GPT Unique Partition ID as the bdev's UUID.</p>
<h2>idxd</h2>
<p>Removed the <code>SPDK_IDXD_FLAG_PERSISTENT</code> flag.</p>
<h2>lvol</h2>
<p>New API <code>spdk_lvol_iter_immediate_clones</code> was added to iterate the clones of an lvol.</p>
<p>New APIs <code>spdk_lvol_get_by_uuid</code> and <code>spdk_lvol_get_by_names</code> to get lvols by the lvol's UUID or lvstore and lvol names.</p>
<p>New <code>bdev_lvol_get_lvols</code> RPC to list logical volumes. This provides information about logical volumes without providing information about the bdevs. It is useful for listing the lvols associated with specific lvol stores and for listing lvols that are degraded and have no associated bdev.</p>
<p>Added support for external snapshots making it possible to create clones of any (including non-lvol) bdev. Users can create such clones using the <code>bdev_lvol_clone_bdev</code> RPC.</p>
<h2>nvme</h2>
<p>New API <code>spdk_nvme_ns_get_format_index</code> was added to calculate the exact format index, that was used to format the namespace.</p>
<p>Added two new APIs <code>spdk_nvme_ns_cmd_io_mgmt_recv</code> and <code>spdk_nvme_ns_cmd_io_mgmt_send</code> to receive and send the I/O management commands.</p>
<h2>nvmf</h2>
<p>New <code>spdk_nvmf_request_copy_to/from_buf()</code> APIs have been added, which support iovecs, unlike the deprecated <code>spdk_nvmf_request_get_data()</code>.</p>
<p>Two functions related to Asynchronous Event and error handling have been made public:</p>
<ul>
<li><code>spdk_nvmf_ctrlr_async_event_error_event</code>,</li>
<li><code>spdk_nvmf_ctrlr_abort_aer</code>.</li>
</ul>
<p>New <code>spdk_nvmf_transport_create_async</code> was added, it accepts a callback and callback argument. <code>spdk_nvmf_transport_create</code> is marked deprecated.</p>
<p>Parameters <code>cb_fn</code> and <code>ctx</code> of <code>spdk_nvmf_qpair_disconnect</code> API are deprecated. These parameters will be removed in 23.09 release.</p>
<p>Added a <code>secure_channel</code> parameter to the <code>nvmf_subsystem_add_listener</code> RPC. When true, all connections established via this listener will immediately attempt to establish a secure channel, prior to any authentication. Only valid for the TCP transport.</p>
<p>Added two optional transport module callbacks: <code>subsystem_add_host()</code> and <code>subsystem_remove_host()</code>. These functions will notify a transport about adding/removing hosts' access.</p>
<p>TLS PSK identity is now generated from subsystem NQN and host NQN. PSK interchange format is now expected as input, when configuring TLS in SPDK. TLS feature is considered experimental.</p>
<h2>part</h2>
<p>New API <code>spdk_bdev_part_construct_ext</code> is added and allows the bdev's UUID to be specified.</p>
<h2>sock</h2>
<p>Added a zero copy receive interface allowing users to provide buffers to a socket group (via <code><a class="el" href="sock_8h.html#a41bf8ae4fc3ac1bbc5e2b097a864db79" title="Provides a buffer to the group to be used in its receive pool.">spdk_sock_group_provide_buf()</a></code>), which will then get filled with the next portions of the stream on each socket. After that, pointer to the buffer holding the next part of the data can be obtained using <code><a class="el" href="sock_8h.html#adceecd0c5622abd26a1c760d81c5ba79" title="Receive the next portion of the stream from the socket.">spdk_sock_recv_next()</a></code>.</p>
<p>Added a callback <code>get_key()</code> to <code><a class="el" href="structspdk__sock__impl__opts.html" title="SPDK socket implementation options.">spdk_sock_impl_opts</a></code> structure.</p>
<p>New function <code><a class="el" href="sock_8h.html#abe68595096e108a2fa3e419071963e63" title="Get socket implementation name.">spdk_sock_get_impl_name()</a></code> was added to retrieve current socket implementation name.</p>
<h2>thread</h2>
<p>Added two new APIs <code>spdk_thread_bind</code> and <code>spdk_thread_is_bound</code> to bind or unbind <code>spdk_thread</code> to its current CPU core, and check bound status.</p>
<h2>ublk</h2>
<p>Enabled support for <code>UBLK_F_NEED_GET_DATA</code>. The buffers are no longer pre-allocated during initialization, but are allocated on-demand. Additionally, they're now allocated from the <code>iobuf</code> buffer pools.</p>
<h2>util</h2>
<p>New APIs <code>spdk_uuid_is_null</code> and <code>spdk_uuid_set_null</code> were added to compare and set UUID to NULL value.</p>
<p>Added new functions, <code>spdk_fd_group_{nest,unnest}</code>, providing efficient way of adding one <code>fd_group</code>'s file descriptors to another <code>fd_group</code>.</p>
<h1>v23.01</h1>
<h2>accel</h2>
<p>New library isa-l-crypto has been added, it is used by accel library in crypto operations.</p>
<p>New functions <code>spdk_accel_submit_encrypt</code> and <code>spdk_accel_submit_decrypt</code> were added.</p>
<p>New accel module <code>dpdk_cryptodev</code> has been added. It uses DPDK crypto PMD and support encrypt and decrypt operations. New RPC <code>dpdk_cryptodev_scan_accel_module</code> has been added to enable this accel module.</p>
<p>New accel module <code>mlx5</code> was added. It implements crypto operations, enabled when SPDK is configured with RDMA provider is mlx5_dv and crypto support.</p>
<p>Introduced the concept of chaining multiple accel operations together and executing them all in a single call. The operation can be chained via one of the <code>spdk_accel_append_*</code> functions and then executed using <code>spdk_accel_sequence_finish</code>. Currently, copy, decompress, decrypt, encrypt, and fill operations support this mode. This feature is considered experimental.</p>
<h2>bdev</h2>
<p>A new API <code>spkd_bdev_part_submit_request_ext</code> was added to specify a custom completion callback.</p>
<p>New APIs <code>spdk_bdev_for_each_channel</code> and <code>spdk_bdev_for_each_channel_continue</code> and associated function pointers were added to iterate each channel of the required bdev.</p>
<p>The RPC <code>bdev_get_iostat</code> now allows a user to query the per channel IO statistics for required bdev, and displays maximum and minimum latencies and I/O error counts.</p>
<p>New <code>spdk_bdev_copy_blocks</code> and <code>spdk_bdev_get_max_copy</code> APIs to support copy commands.</p>
<p>A new API <code>spdk_bdev_io_get_submit_tsc</code> was added to get the submit_tsc of the bdev I/O.</p>
<p>Bdevs will no longer have UUIDs generated based on timestamp and are responsible for setting this field themselves. Generation of UUIDs for NVMe bdevs may be enabled by running <code>bdev_nvme_set_options</code> RPC with <code>--generate-uuids</code> option. These identifiers are based on serial number and namespace ID and will always be the same for a given device.</p>
<p>A new API <code>spdk_bdev_channel_get_histogram</code> was added to get the histogram of a specified channel for a bdev.</p>
<p>Converted internal use of <code>pthread_mutex_t</code> to <code>struct <a class="el" href="structspdk__spinlock.html" title="A spinlock augmented with safety checks for use with SPDK.">spdk_spinlock</a></code>. Consumers of bdev API functions must be on an SPDK thread or the program will abort. It is now enforced that no internal bdev locks can be held when a poller or message goes off CPU.</p>
<p>A new RPC <code>bdev_reset_iostat</code> was added to reset I/O statistics of bdevs. Note that if one consumer reset I/O statistics, it affects all other consumers.</p>
<p>Add function pointers, <code>dump_device_stat_json</code> and <code>reset_device_stat</code> to the bdev module function table to display and reset I/O statistics specific for the module specific bdev context.</p>
<p>New APIs <code>spdk_bdev_reset_io_stat</code>, <code>spdk_bdev_add_io_stat</code> and <code>spdk_bdev_dump_io_stat_json</code> were added to process I/O statistics outside the generic bdev layer, especially in bdev modules.</p>
<h2>bdev_crypto</h2>
<p>vbdev_crypto is updated to use accel framework instead of DPDK PMDs.</p>
<h2>bdev_daos</h2>
<p>New RPC <code>bdev_daos_resize</code> was added to allow resizing the daos bdev.</p>
<h2>bdev_malloc</h2>
<p>Both of interleaved and separated metadata are now supported by the malloc bdev module.</p>
<p>Protection information is now supported by the malloc bdev module.</p>
<h2>bdev_nvme</h2>
<p>Updated <code>bdev_nvme_set_options</code> RPC (and rpc.py) to support the new <code>transport_tos</code> parameter.</p>
<p>For the active-active policy of the multipath mode, in addition to the default round-robin path selector, the minimum queue depth path selector was added. The minimum queue depth path selector selects an I/O path according to the number of outstanding requests of each nvme qpair.</p>
<p>Added RPCs <code>bdev_nvme_start_mdns_discovery</code>, <code>bdev_nvme_get_mdns_discovery_info</code> and <code>bdev_nvme_stop_mdns_discovery</code> to perform Avahi based mDNS discovery service, as per NVMe TP 8009 - Automated Discovery of Ethernet Discovery Controllers.</p>
<p>A new option <code>nvme_error_stat</code> was added to the <code>bdev_nvme_set_options</code> RPC to enable collecting NVMe error counts.</p>
<p>Added I/O statistics per I/O path to the NVMe bdev module for NVMe bdev multipath. It can be enabled by a new option <code>io_path_stat</code> of RPC <code>bdev_nvme_set_options</code>.</p>
<p>Added RPC <code>bdev_nvme_get_path_iostat</code> to get I/O statistics for IO paths of the NVMe bdev.</p>
<p>Added <code>selector</code> parameter to <code>bdev_nvme_set_multipath_policy</code> RPC to set path selector for multipath. Option <code>round_robin</code> and <code>queue_depth</code> are available.</p>
<p>Added <code>rr_min_io</code> option to RPC <code>bdev_nvme_set_multipath_policy</code>. It switches I/O to another path after rr_min_io I/Os are routed to current io path for the round-robin path selector.</p>
<p>Added option <code>--io-path-stat</code> for RPC <code>bdev_nvme_set_option</code> to enable collecting io path stat.</p>
<h2>bdev_raid</h2>
<p>Changed <code>bdev_raid_get_bdevs</code> RPC output format to include raid_bdev details.</p>
<h2>bdevperf</h2>
<p>Promoted the application to example to match similar programs: fio_plugin and perf. It can now be found inside <code>examples/bdev/bdevperf</code>.</p>
<h2>env</h2>
<p>Added <code>spdk_mempool_mem_iter</code> that allows to get start address and length of each memory chunk in order to create app-specific resources.</p>
<h2>event</h2>
<p>Added core lock file mechanism to prevent the same CPU cores from being used by multiple SPDK application instances.</p>
<p>Added <code>--disable-cpumask-locks</code> command line switch to disable CPU locks on SPDK startup.</p>
<p>Added RPCs <code>framework_enable_cpumask_locks</code> and <code>framework_disable_cpumask_locks</code> to enable and disable CPU core locks in runtime.</p>
<p>Added <code>--rpcs-allowed</code> command line option. Users can specify a comma-separated list of RPC names with this option to restrict allowed RPCs to only that list.</p>
<p>Added <code>--vfio-vf-token</code> command line option to specify a VF token (UUID) shared between SR-IOV PF and VFs for vfio_pci driver.</p>
<p>The <code>spdk_iov_xfer_*()</code> APIs were added for handling incremental copying between an iovec and a buffer.</p>
<h2>json</h2>
<p>Added API <code>spdk_json_write_double</code> and <code>spdk_json_write_named_double</code> to allow for writing and decoding of the the double data type.</p>
<h2>log</h2>
<p>Added consistent tracking of use of deprecated behavior. Deprecations continue to be listed in deprecation.md and now are in subsections with headers matching a tag used in <code>SPDK_LOG_DEPRECATED()</code> calls. When deprecated behavior is used, these tags will appear in SPDK's log at the warn level. As the SPDK application exits, it will log a summary of how many times <code>SPDK_LOG_DEPRECATED()</code> was called for each tag that was logged at least once.</p>
<h2>nvme</h2>
<p>NVMe transport options were newly introduced. The NVMe transport options are defined via the <code><a class="el" href="structspdk__nvme__transport__opts.html" title="NVMe transport options.">spdk_nvme_transport_opts</a></code> structure and configured via <code>spdk_nvme_transport_get_opts</code> and <code>spdk_nvme_transport_get_opts</code> functions.</p>
<p>Shared receive queue was supported by the RDMA transport. It can be configured by a new NVMe transport option <code>rdma_srq_size</code>.</p>
<p>Added <code>transport_tos</code> to <code><a class="el" href="structspdk__nvme__ctrlr__opts.html" title="NVMe controller initialization options.">spdk_nvme_ctrlr_opts</a></code> to support setting of the "type of service" value in the IPv4 header. Only RDMA is supported at this time.</p>
<p>Added API <code>spdk_nvme_qpair_get_num_outstanding_reqs</code> to get the number of outstanding reqs of a specified qpair.</p>
<h2>nvmf</h2>
<p>Added API <code>spdk_nvmf_tgt_pause_polling</code> and <code>spdk_nvmf_tgt_resume_polling</code> to allow pausing polling on poll group of a given target.</p>
<p>The <code>num_shared_buffers</code> option now controls the maximum number of buffers a transport will pull from the central <code>iobuf</code> pool. It will not allocate additional memory. If the requested amount cannot be satisfied, a warning will be displayed to increase the size of the <code>iobuf</code> pool.</p>
<h2>rpc</h2>
<p>Added <code>spdk_rpc_set_allowlist</code> to restrict allowed RPCs to the specified list.</p>
<h2>scheduler</h2>
<p>Changing scheduler from dynamic back to static is no longer possible, as there is no way of saving original SPDK thread distribution on reactors.</p>
<h2>thread</h2>
<p>Added <code>spdk_thread_get_app_thread</code> which returns the first thread that was created using <code>spdk_thread_create</code>.</p>
<p>Added <code>spdk_thread_is_running</code>. This returns <code>true</code> for a running thread, or <code>false</code> if its exit process has started using <code>spdk_thread_exit</code>.</p>
<p>Added API <code>spdk_spin_init</code>, <code>spdk_spin_destroy</code>, <code>spdk_spin_lock</code>, <code>spdk_spin_unlock</code>, and <code>spdk_spin_held</code> to support spinlocks that are aware of the SPDK concurrency model.</p>
<p>Added iobuf buffer pool, set of API calls for allocating data buffers across libraries. Please see new API <code>spdk_iobuf_*</code>.</p>
<h2>trace</h2>
<p>New <code>trace_get_info</code> RPC was added to get name of shared memory file, list of the available trace point groups and mask of the available trace points for each group.</p>
<h2>ublk device</h2>
<p>The ublk application supports the ublk kernel driver. It's implemented as a ublk backend in spdk_tgt and could be started with specifying configuration. See the <a href="https://www.kernel.org/doc/html/latest/block/ublk.html">ublk</a> documentation for more details.</p>
<p>ublk bdev could export a block device via Linux ublk. It will move this backend device into userspace as <code>/dev/ublkb*</code>. Before to adding ublk device, need to create ublk target by RPC method.</p>
<h2>util</h2>
<p>New API <code>spdk_fd_group_get_epoll_event</code> that returns the epoll(7) event that caused a function callback in file descriptor group to execute.</p>
<p>Added API <code>spdk_strarray_from_string</code>, <code>spdk_strarray_dup</code> and <code>spdk_strarray_free</code> for handling arrays of strings.</p>
<p>A new API <code>spdk_strcpy_replace</code> was added to replace all occurrences of the search string with the replacement string.</p>
<p>New API <code><a class="el" href="util_8h.html#a87d0db9f66fa3fc6763dbbe238c3c179" title="Operate like memset across an iovec.">spdk_iov_memset()</a></code> was added to memset an iovec.</p>
<p>New API <code>spdk_iov_one()</code> was added to initialize an iovec for a single buffer.</p>
<h1>v22.09</h1>
<h2>accel</h2>
<p>Many names were changed in the accel framework to make them consistent both with themselves and the rest of SPDK. The primary public header file is now named <code><a class="el" href="accel_8h.html" title="Acceleration Framework.">include/spdk/accel.h</a></code>.</p>
<p>Added a new runtime RPC <code>accel_get_opc_assignments</code> to get a list of current opcode to engine assignments.</p>
<p>Added a new startup RPC <code>accel_assign_opc</code> to assign/override a specific opcode to an engine.</p>
<h2>bdev</h2>
<p>New RPCs <code>bdev_xnvme_create</code> and <code>bdev_xnvme_delete</code> were added to support the xNVMe bdev.</p>
<p>A new API <code>spdk_bdev_for_each_bdev_io</code> was added to execute the function on the appropriate thread for each bdev_io submitted to the bdev.</p>
<p>A new API <code>spdk_bdev_get_current_qd</code> was added to measure and return the queue depth from a bdev. This API is available even when queue depth sampling is disabled.</p>
<p>Added <code>spdk_bdev_seek_data</code>, <code>spdk_bdev_seek_hole</code> and <code>spdk_bdev_io_get_seek_offset</code> functions that start from a given offset and seek for next data or for next hole. At this time only supported by lvol bdev module.</p>
<p>A new parameter <code>io_drain_timeout</code> has been added to <code><a class="el" href="structspdk__bdev.html">spdk_bdev</a></code> structure. It controls how long a bdev reset must wait for IO to complete prior to issuing a reset to the underlying device. If there is no outstanding IO at the end of that period, the reset is skipped. Best defined for bdevs that share an underlying bdev, such as multiple lvol bdevs sharing an nvme device, to avoid unnecessarily resetting the underlying bdev and affecting other bdevs that are sharing it. Modifying this field is optional. Setting the value to 0 keeps the original behavior to always send resets immediately, even if there is no I/O outstanding.</p>
<h2>blobstore</h2>
<p>Reserve space for <code>used_clusters</code> bitmap. The reserved space could be used for blobstore growing in the future.</p>
<p>Added <code>is_zeroes</code> operation to <code><a class="el" href="structspdk__bs__dev.html">spdk_bs_dev</a></code>. It allows to detect if logical blocks are backed by zeroes device and do a shortcut in copy-on-write flow by excluding copy part from zeroes device.</p>
<p>Added <code>spdk_blob_get_next_allocated_io_unit</code> and <code>spdk_blob_get_next_unallocated_io_unit</code> functions that start from a given offset and seek for first io_unit belonging to an allocated cluster or first io_unit belonging to an unallocated cluster.</p>
<p>Added <code>spdk_bs_grow</code> function to grow blobstore size if the underlying bdev size is increased. This is used by lvol bdev via <code>bdev_lvol_grow_lvstore</code> RPC.</p>
<h2>daos</h2>
<p>Added new DAOS bdev module, that creates SPDK block device on top of DAOS DFS. Please see <a href="https://spdk.io/doc/bdev.html#bdev_config_daos">documentation</a> for more details.</p>
<h2>env</h2>
<p>Added <code>spdk_pci_register_device_provider</code> and matching <code>SPDK_PCI_REGISTER_DEVICE_PROVIDER</code> functions for registering PCI device providers. That allow the VMD driver to be notified when users want to attach a device under a given BDF and when a device is detached.</p>
<h2>init</h2>
<p><code>spdk_subsystem_init_from_json_config</code> now fails if the JSON configuration file is not an object with an array named "subsystems".</p>
<h2>iscsi</h2>
<p>Added <code>bdev_iscsi_set_options</code> RPC to modify options of the iSCSI bdev module.</p>
<h2>json</h2>
<p>Added <code>spdk_json_find</code> API return errcode: EPROTOTYPE - json not enclosed in {}. <code>spdk_json_find</code> now returns -EPROTOTYPE instead of -ENOENT if the object parameter does not point to a JSON object (i.e. is not enclosed with {}).</p>
<h2>lvol</h2>
<p>Add <code>num_md_pages_per_cluster_ratio</code> parameter to the <code>bdev_lvol_create_lvstore</code> RPC. Calculate <code>num_md_pages</code> from <code>num_md_pages_per_cluster_ratio</code>, and pass it to <code><a class="el" href="structspdk__bs__opts.html">spdk_bs_opts</a></code>.</p>
<h2>nvme</h2>
<p>Added SPDK_NVME_TRANSPORT_CUSTOM_FABRICS to enum <code>spdk_nvme_transport_type</code> to support custom fabric transport. SPDK_NVME_TRANSPORT_CUSTOM was intended to be non-fabric custom transport.</p>
<p>Added a new function <code>spdk_nvme_ns_cmd_verify</code> to submit a Verify Command to a Namespace.</p>
<p>Added <code>spdk_nvme_ctrlr_disable_read_changed_ns_list_log_page</code> to allow an application to tell the driver to not read the CHANGED_NS_LIST log page in response to a NS_ATTR_CHANGED AEN. When called the application is required to read this log page instead to clear the AEN.</p>
<p>Added <code>psk</code> field to <code><a class="el" href="structspdk__nvme__ctrlr__opts.html" title="NVMe controller initialization options.">spdk_nvme_ctrlr_opts</a></code> struct in order to enable SSL socket implementation of TCP connection and set the PSK. Applicable for TCP transport only.</p>
<h2>raid</h2>
<p>Renamed the <code>raid5</code> module to <code>raid5f</code> to reflect that it is not a traditional RAID5 implementation - only full stripe writes are supported, partial stripe writes (read-modify-write) are not.</p>
<h2>rpc</h2>
<p>Added <code>psk</code> parameter to <code>bdev_nvme_attach_controller</code> RPC in order to enable SSL socket implementation of TCP connection and set the PSK. Applicable for TCP transport only.</p>
<p>New options <code>enable_ktls</code> and <code>tls_version</code> were added to the <code>sock_impl_set_options</code> structure. New options <code>psk_key</code> and <code>psk_identity</code> were added to the <code>sock_impl_set_options</code> structure.</p>
<p>Added warning message for <code>bdev_rbd_create</code>, if it is used without -c. <code>bdev_rbd_create()</code> API without specifying -c is deprecated and will be removed in future release.</p>
<p>Renamed <code>enable_vmd</code> RPC to <code>vmd_enable</code> to make it consistent with our naming scheme of <code>&lt;subsystem&gt;_&lt;action&gt;</code>. For now, the old name is still available, but is marked as deprecated.</p>
<p>New function <code>spdk_rpc_get_method_state_mask</code> was added to RPC library.</p>
<h2>sma</h2>
<p>Extended <code>VolumeParameters</code> with crypto parameters allowing the user to configure crypto when attaching a volume to a device. This interface is now supported by all upstream device types (nvmf-tcp, virtio-blk, vfio-user) using <code>bdev_crypto</code>. Users must specify the crypto engine to use under <code>crypto</code> section in config. It is also possible to register out-of-tree crypto engines by inheriting from the <code>CryptoEngine</code> class.</p>
<p>Added two new methods: <code>SetQos</code> and <code>GetQosCapabilities</code> allowing the user to configure QoS on a per-device or per-volume level. Not all QoS settings have to be supported by each device, so users can use <code>GetQosCapabilities</code> to query them for that. All upstream device types support QoS on a per-volume level using bdev layer's QoS mechanism.</p>
<h2>sock</h2>
<p>Added new <code>ssl</code> based socket implementation, the code is located in <code>module/sock/posix</code>. For now we are using hard-coded PSK and only support TLS 1.3.</p>
<h2>util</h2>
<p>Added new functions: <code>spdk_hexlify</code> and <code>spdk_unhexlify</code>.</p>
<p>A new API <code>spdk_xor_gen</code> was added to generate XOR from multiple source buffers. It is going to be used by <code>raid5f</code> for calculating parity.</p>
<h2>vfu_tgt</h2>
<p>Added vfu_tgt library abstraction based on libvfio-user for PCI device emulation. Besides the NVMe device emulation, its now possible to emulate virtio-blk and virtio-scsi devices.</p>
<h2>virtio</h2>
<p>virtio-vhost-user no longer tries to support dynamic memory allocation. The vhost target does not support the high rate of SET_MEM_TABLE vhost messages that result from dynamic memory allocation, so a virtio-vhost-user device will now present an ERRLOG, assert, and skip the SET_MEM_TABLE vhost message if a memory notification is received outside of the normal device start/stop. Applications using the virtio library in vhost-user mode should now pre-allocate the application's memory using the -s/&ndash;mem-size option and use single shared memory file segments using the -g/&ndash;single-file-segments option.</p>
<p>Added <code>vfio-user</code> transport type for virtio-blk and virtio-scsi devices.</p>
<h2>vmd</h2>
<p>Fixed hotplug when a device is inserted in a slot in which a disk was already enumerated previously. Added two new RPCs: <code>vmd_remove_device</code> simulating a hotremove, and <code>vmd_rescan</code>, which rescans all buses managed by the VMD driver and hotplugs all newfound devices.</p>
<h1>v22.05</h1>
<h2>sock</h2>
<p>A new option <code>ack_timeout</code> was added to the <code><a class="el" href="structspdk__sock__opts.html" title="Spdk socket initialization options.">spdk_sock_opts</a></code> structure.</p>
<h2>util</h2>
<p>A new parameter <code>bounce_iovcnt</code> was added to <code>spdk_dif_generate_copy</code> and <code>spdk_dif_verify_copy</code>. The <code>bounce_iovcnt</code> is used to specify the number of bounce_iov to support multiple block-aligned fragment copies.</p>
<p>A new API <code>spdk_copy_iovs_to_buf</code> and <code>spdk_copy_buf_to_iovs</code> were added to copy iovs to buf or copy buf to iovs. There're many cases need to use these two APIs.</p>
<h2>bdev</h2>
<p>Removed deprecated spdk_bdev_module_finish_done(). Use <a class="el" href="bdev__module_8h.html#a13dae91c3223ea829a78b979d34018c0" title="Indicate that the module finish has completed.">spdk_bdev_module_fini_done()</a> instead.</p>
<p>A new API <code>spdk_bdev_unregister_by_name</code> was added to handle race conditions correctly.</p>
<p>New APIs, <code>spdk_for_each_bdev</code> and <code>spdk_for_each_bdev_leaf</code>, were added to provide iteration safe for race conditions.</p>
<p>A new RPC <code>bdev_nvme_get_io_paths</code> was added to get all active I/O paths.</p>
<p>A new RPC <code>bdev_nvme_set_preferred_path</code> was added to set preferred I/O path for an NVMe bdev when in multipath mode. This RPC does not support NVMe bdevs in failover mode.</p>
<p>A new RPC <code>bdev_nvme_set_multipath_policy</code> was added to set multipath policy of a NVMe bdev in multipath mode.</p>
<p>A new option <code>disable_auto_failback</code> was added to the <code>bdev_nvme_set_options</code> RPC to disable automatic failback.</p>
<h2>idxd / dsa</h2>
<p>A new parameter <code>flags</code> was added to all low level submission and preparation APIs to enable the caller to pass operation flags per the DSA specification.</p>
<p>A new flag 'SPDK_IDXD_FLAG_PERSISTENT' was added to let DSA know that the destination is persistent.</p>
<p>The RPC <code>idxd_scan_accel_engine</code> has been renamed to <code>dsa_scan_accel_engine</code></p>
<p>The RPC <code>iaa_scan_accel_engine</code> has been added.</p>
<p>Many HW related structs/functions with the name <code>idxd</code> have been renamed <code>dsa</code> to more accurately represent the HW they are associated with.</p>
<p>Two new functions were added to the library <code>spdk_idxd_submit_compress</code> and <code>spdk_idxd_submit_decompress</code></p>
<h2>accel_fw</h2>
<p>A new parameter <code>flags</code> was added to accel API. The APIs include: <code>spdk_accel_submit_copy</code> <code>spdk_accel_submit_dualcast</code> <code>spdk_accel_submit_fill</code> <code>spdk_accel_submit_copy_crc32c</code> <code>spdk_accel_submit_copy_crc32cv</code> <code>spdk_accel_submit_compress</code> <code>spdk_accel_submit_decompress</code></p>
<p>A new flag <code>ACCEL_FLAG_PERSISTENT</code> was added to indicate the target memory is PMEM.</p>
<p>The API <code>spdk_accel_get_capabilities</code> has been removed.</p>
<h2>crypto</h2>
<p>Support for AES_XTS was added for MLX5 polled mode driver (pmd).</p>
<p>bdev_crypto_create RPC now requires hexlified 'key' and 'key2' params for all pmd drivers. Unhexlifying is performed during RPC command processing and the vbdev crypto module runs on binary keys as before.</p>
<h2>bdev</h2>
<p>Added a timeout option to the <code>bdev_get_bdevs</code> RPC. It allows the user to specify the amount of time to wait until a bdev with a given name appears in the system.</p>
<h2>bdev_nvme</h2>
<p>Added <code>bdev_nvme_add_error_injection</code> and <code>bdev_nvme_remove_error_injection</code> RPCs to add and remove NVMe error injections.</p>
<p>New parameters, <code>ctrlr_loss_timeout_sec</code>, <code>reconnect_delay_sec</code>, and <code>fast_io_fail_timeout_sec</code>, are added to the RPC <code>bdev_nvme_set_options</code>. They can be overridden if they are given by the RPC <code>bdev_nvme_attach_controller</code>.</p>
<h2>blobstore</h2>
<p>New functions <code>spdk_blob_io_writev_ext</code> and <code>spdk_blob_io_readv_ext</code> are added. The new functions accept <code><a class="el" href="structspdk__blob__ext__io__opts.html" title="Structure with optional IO request parameters The content of this structure must be valid until the I...">spdk_blob_ext_io_opts</a></code> structure with extended IO request options.</p>
<h2>event</h2>
<p>Added <code>msg_mempool_size</code> parameter to <code>spdk_reactors_init</code> and <code>spdk_thread_lib_init_ext</code>. The size of <code>g_spdk_msg_mempool</code> can now be controlled through the same-named user option of <code><a class="el" href="structspdk__app__opts.html" title="Event framework initialization options.">spdk_app_opts</a></code> structure.</p>
<h2>nvme</h2>
<p>The API <code>spdk_nvme_ctrlr_prepare_for_reset()</code> was deprecated. The functionality provided by the <code>spdk_nvme_ctrlr_prepare_for_reset()</code> was merged into the API <code><a class="el" href="nvme_8h.html#a458a65224a0f20c73d0acb44715d86dc" title="Disconnect the given NVMe controller.">spdk_nvme_ctrlr_disconnect()</a></code>.</p>
<h2>nvmf</h2>
<p>Removed deprecated max_qpairs_per_ctrlr parameter from nvmf_create_transport RPC. Use max_io_qpairs_per_ctrlr instead.</p>
<p>Deprecated the ability for hosts to connect to the discovery subsystem automatically on any existing listener. Users should now explicitly add listeners for the discovery subsystem. Host can still connect to the discovery subsystem as before, but a warning message will be emitted if no listener was configured for the transport ID of the incoming connection.</p>
<p>Added adaptive interrupt feature for vfio-user transport. New parameter <code>disable_adaptive_irq</code> is added to the RPC <code>nvmf_create_transport</code>.</p>
<h2>thread</h2>
<p>Added <code><a class="el" href="thread_8h.html#a6695466847e7a751b768ab4b8bcd53d0" title="Run the msg callback on the given thread.">spdk_thread_exec_msg()</a></code> API.</p>
<h2>scheduler</h2>
<p><code>framework_set_scheduler</code> can now be called after application initialization. Added callbacks to set custom parameters specific for each scheduler implementation and <code>framework_get_scheduler</code> to retrieve them.</p>
<p>Added <code>dynamic</code> scheduler options: load_limit, core_limit, core_busy. Their descriptions are available in JSON-RPC document, in section <a href="jsonrpc.html#rpc_framework_set_scheduler">framework_set_scheduler</a>.</p>
<h2>raid</h2>
<p>Add concat as a special raid module. The concat module could create a virtual bdev. The virtual bdev combines multiple underlying bdevs together. The layout of the underlying bdevs is one after another. The concat bdev is extendable. When the free space of the concat bdev is not enough, the user can deconstruct the concat bdev, then reconstruct it with an additional underlying bdev.</p>
<h2>sock</h2>
<p>Allow MSG_ZEROCOPY flag to be set or not according to data size, which can be enabled and set by setting "zerocopy_threshold". zerocopy_threshold = 0 means disable this function; zerocopy_threshold &gt; 0 means enable it and use this value as the threshold.</p>
<h2>rpc</h2>
<p>Introduced <code>zerocopy_threshold</code> to enable zerocopy on send for server sockets according to data size to be flushed.</p>
<h1>v22.01</h1>
<h2>accel</h2>
<p>The batching capability was removed. Batching is now considered an implementation detail of the low level drivers.</p>
<h2>bdev</h2>
<p>The NVMe bdev module supports multipath and improved I/O error resiliency.</p>
<p>The parameter <code>retry_count</code> of the RPC <code>bdev_nvme_set_options</code> was deprecated and will be removed in SPDK 22.04, and the parameter <code>transport_retry_count</code> is added and used instead.</p>
<p>An new parameter <code>bdev_retry_count</code> is added to the RPC <code>bdev_nvme_set_options</code>.</p>
<p>New parameters, <code>ctrlr_loss_timeout_sec</code>, <code>reconnect_delay_sec</code>, and <code>fast_io_fail_timeout_sec</code>, are added to the RPC <code>bdev_nvme_attach_controller</code>.</p>
<p>An new parameter <code>num_io_queues</code> is added to <code>bdev_nvme_attach_controller</code> RPC to allow specifying amount of requested IO queues.</p>
<p>Added <code>key_file</code> parameter to the <code>rbd_register_cluster</code> RPC. It is an optional parameter to specify a keyring file to connect to a RADOS cluster.</p>
<p>Added <code>spdk_bdev_get_zone_id</code> API to retrieve zone_id for a certain LBA.</p>
<h2>bdev_aio</h2>
<p>Added <code>bdev_aio_rescan</code> RPC to allow rescanning the size of aio bdev.</p>
<h2>bdev_nvme</h2>
<p>Added discovery service to bdev_nvme module, which now can connect to a discovery controller. bdev_nvme will connect to all current and future subsystems in the discovery controller. Added <code>bdev_nvme_start_discovery</code> and <code>bdev_nvme_stop_discovery</code> RPC.</p>
<h2>dpdk</h2>
<p>Updated DPDK submodule to DPDK 21.11.</p>
<h2>env</h2>
<p>Added <code>spdk_pci_for_each_device</code>.</p>
<p>Removed <code>spdk_pci_get_first_device</code> and <code>spdk_pci_get_next_device</code>. These APIs were unsafe, because they did not account for PCI devices being inserted or removed while the caller was using handles returned from these APIs. Existing users of these APIs should switch to <code>spdk_pci_for_each_device</code> instead.</p>
<p>Added 3 experimental APIs to handle PCI device interrupts (<code>spdk_pci_device_enable_interrupt</code>, <code>spdk_pci_device_disable_interrupt</code>, <code>spdk_pci_device_get_interrupt_efd</code>).</p>
<p>Added <code>framework_get_pci_devices</code> RPC to list PCIe devices attached to an SPDK application.</p>
<h2>idxd</h2>
<p>Many APIs are now vectored rather than scalar, meaning they take iovecs instead of individual pointers.</p>
<h2>json</h2>
<p>Added <code>spdk_json_write_bytearray</code> API to serialize a buffer as a hex string.</p>
<h2>nvme</h2>
<p>API <code>spdk_nvme_trtype_is_fabrics</code> was added to return existing transport type is fabric or not.</p>
<p>API <code>spdk_nvme_poll_group_remove</code> was limited to be available only for a disconnected qpair in the group.</p>
<p>New APIs, <code>spdk_nvme_ctrlr_disconnect</code>, <code>spdk_nvme_ctrlr_reconnect_async</code>, and <code>spdk_nvme_ctrlr_reconnect_poll_async</code>, have been added to improve error recovery, and the existing APIs,<code>spdk_nvme_ctrlr_reset_async</code> and <code>spdk_nvme_ctrlr_reset_poll_async</code> were deprecated.</p>
<p>Added <code>spdk_nvme_ctrlr_get_discovery_log_page</code> API for getting the full discovery log page from a discovery controller.</p>
<h2>nvmf</h2>
<p>Added support for zero-copy operations in the NVMe-oF TCP target. It can be enabled via the <code>zcopy</code> parameter when creating a transport. The zero-copy operations are only used for requests not using in-capsule data.</p>
<p>Added a <code>subsystem</code> parameter to <code>spdk_nvmf_transport_stop_listen_async</code>. When not NULL, it will only disconnect qpairs for controllers associated with the specified subsystem.</p>
<p>Removed accept poller from transport layer. Each transport can have its own policy of handling new connections. To notify transport layer <code>spdk_nvmf_poll_group_add</code> and <code>spdk_nvmf_tgt_new_qpair</code> can be used.</p>
<h2>scsi</h2>
<p>Structure <code>spdk_scsi_lun</code> has been extended with new member <code>resizing</code> so that SCSI layer now reports unit attention for disk resize.</p>
<h2>trace</h2>
<p>Added <code>spdk_trace_create_tpoint_group_mask</code> to return tracepoint group mask from a tracepoint group name.</p>
<p>Added <code>trace_set_tpoint_mask</code> and <code>trace_clear_tpoint_mask</code> RPC to allow enabling individual traces.</p>
<h2>util</h2>
<p>Added <code>spdk_ioviter_first</code> and <code>spdk_ioviter_next</code> to iterate over two iovecs and yield pointers to common length segments.</p>
<h2>sock</h2>
<p>A new parameter <code>hint</code> is added to <code>spdk_sock_get_optimal_sock_group</code>. It allows to suggest a poll group when no optimal poll group is found.</p>
<h1>v21.10</h1>
<p>Structure <code><a class="el" href="structspdk__nvmf__target__opts.html">spdk_nvmf_target_opts</a></code> has been extended with new member <code>discovery_filter</code> which allows to specify filtering rules applied during discovery log generation. Refer to <code>enum spdk_nvmf_tgt_discovery_filter</code> for more info.</p>
<h2>bdev</h2>
<p>New API <code>spdk_bdev_get_memory_domains</code> has been added, it allows to get SPDK memory domains used by bdev.</p>
<p>New API functions <code>spdk_bdev_readv_blocks_ext</code> and <code>spdk_bdev_writev_blocks_ext</code> have been added. These functions accept <code><a class="el" href="structspdk__bdev__ext__io__opts.html" title="Structure with optional IO request parameters.">spdk_bdev_ext_io_opts</a></code> structure with extended IO request options, e.g. DMA memory domain which describes data that may belong to another memory domain and can't be accessed directly.</p>
<p>Added <code>async_fini_start</code> to allow bdev modules to complete the <code>fini_start</code> asynchronously, with new <code>spdk_bdev_module_fini_start_done</code> API.</p>
<p>Deprecated <code>spdk_bdev_module_finish_done()</code> API, which will be removed in SPDK 22.01. Bdev modules should use <code><a class="el" href="bdev__module_8h.html#a13dae91c3223ea829a78b979d34018c0" title="Indicate that the module finish has completed.">spdk_bdev_module_fini_done()</a></code> instead.</p>
<p>The <code>ocssd</code> bdev has been removed. The Open Channel specification has been largely superseded by zoned namespaces, few if any devices have been brought to market, and there is little reason to continue to support this. OCSSD support in the nvme driver will remain for now.</p>
<h2>dma</h2>
<p>A new library, lib/dma, has been added. This library provides the necessary infrastructure for handling systems and devices with multiple memory domains. For example, a PCIe add-in card with an SoC may be running SPDK on the SoC. That SoC has its own local memory, but SPDK may be controlling devices that can also access the host system memory. This library provides infrastructure to enumerate the memory domains and request hardware perform DMA transfers between them.</p>
<h2>dpdk</h2>
<p>Updated DPDK submodule to DPDK 21.08.</p>
<h2>event</h2>
<p>Added the <code>disable_signal_handlers</code> flag to the <code><a class="el" href="structspdk__app__opts.html" title="Event framework initialization options.">spdk_app_opts</a></code> struct.</p>
<h2>idxd</h2>
<p>Added <code>spdk_idxd_get_socket</code> to query the socket that the idxd device is on.</p>
<h2>json</h2>
<p>Added API to allow for writing and decoding of new types:</p>
<ul>
<li><code>spdk_json_write_named_uint16</code></li>
<li><code>spdk_json_write_named_uint8</code></li>
<li><code>spdk_json_write_uint16</code></li>
<li><code>spdk_json_write_uint8</code></li>
<li><code>spdk_json_number_to_uint8</code></li>
<li><code>spdk_json_decode_uint8</code></li>
</ul>
<h2>log</h2>
<p>Added API <code>spdk_log_to_syslog_level</code> to return syslog level based on SPDK's log level.</p>
<h2>nvme</h2>
<p>Added new functions <code>spdk_nvme_zns_set_zone_desc_ext</code> and <code>spdk_nvme_zns_ext_report_zones</code> to set zone descriptor extension and to get extended zone report respectively.</p>
<p>New API <code>spdk_nvme_ctrlr_get_memory_domains</code> has been added, it allows to get SPDK memory domains used by nvme controller.</p>
<p>New API functions <code>spdk_nvme_ns_cmd_readv_ext</code> and <code>spdk_nvme_ns_cmd_writev_ext</code> have been added. These functions accept <code><a class="el" href="structspdk__nvme__ns__cmd__ext__io__opts.html" title="Structure with optional IO request parameters.">spdk_nvme_ns_cmd_ext_io_opts</a></code> structure with extended IO request options, e.g. DMA memory domain which describes data that may belong to another memory domain and can't be accessed directly.</p>
<p>Added a new function <code>spdk_nvme_ctrlr_get_regs_bpinfo</code> to get boot partition info of a controller. Added new functions <code>spdk_nvme_ctrlr_write_boot_partition</code>, <code>spdk_nvme_ctrlr_read_boot_partition_start</code> and <code>spdk_nvme_ctrlr_read_boot_partition_poll</code> to write and read the boot partitions of a controller.</p>
<p>Added <code>spdk_nvme_ctrlr_get_opts</code> to retrieve the current controller options.</p>
<p>Added <code>async_mode</code> to <code><a class="el" href="structspdk__nvme__io__qpair__opts.html" title="NVMe I/O queue pair initialization options.">spdk_nvme_io_qpair_opts</a></code> to enable creation of submission and completion queues asynchronously. This mode is currently supported at PCIe layer, which tracks the qpair creation with state machine and returns to the user immediately. Default mode is set to false to create io qpairs synchronously.</p>
<p>Added <code>spdk_nvme_ctrlr_get_regs_cc</code> to retrieve NVMe controller CC (Configuration) register.</p>
<p>Added <code>spdk_nvme_ctrlr_prepare_for_reset</code> to inform the driver that the application is preparing to reset the specified NVMe controller. This function allows the driver to make decisions knowing that a reset is about to happen.</p>
<h2>nvmf</h2>
<p>Added <code>oncs</code> to <code>struct <a class="el" href="structspdk__nvmf__ctrlr__data.html" title="A subset of struct spdk_nvme_ctrlr_data that are emulated by a fabrics device.">spdk_nvmf_ctrlr_data</a></code> so that the transport layer can decide support RESERVATION feature or not.</p>
<p>An <code>opts_size</code> element was added in the <code><a class="el" href="structspdk__nvmf__ns__opts.html" title="NVMe-oF target namespace creation options.">spdk_nvmf_ns_opts</a></code> structure to solve the ABI compatibility issue between different SPDK version. An new option <code>anagrpid</code> was added in the <code><a class="el" href="structspdk__nvmf__ns__opts.html" title="NVMe-oF target namespace creation options.">spdk_nvmf_ns_opts</a></code> structure.</p>
<p>An new parameter <code>anagrpid</code> was added to the RPC <code>nvmf_subsystem_add_ns</code>.</p>
<p>An new parameter <code>anagrpid</code> was added to the RPC <code>nvmf_subsystem_listener_set_ana_state</code>.</p>
<p><code>spdk_nvmf_subsystem_destroy</code> is now can be asynchronous, it accepts a callback and callback argument.</p>
<p>A new parameter, <code>poll_groups_mask</code> was added to the <code>nvmf_set_config</code> RPC that allows specifying a subset of cores for the nvmf poll groups. This helps to avoid imbalances when some cores are busy with periodic timer tasks that run very frequently.</p>
<p>A new parameter, <code>commit</code> was added to <code>nvmf_bdev_ctrlr_end_zcopy</code> that allows indicating whether the buffers should be committed.</p>
<p>Added <code>listen_dump_opts</code> to <code><a class="el" href="structspdk__nvmf__transport__ops.html">spdk_nvmf_transport_ops</a></code> so that the transport layer can display listen opts.</p>
<p>Added <code>fabrics_connect_timeout_us</code> to <code>bdev_nvme_attach_controller</code> RPC to allow specifying timeout for connect operation.</p>
<p>Added <code>multipath</code> to <code>bdev_nvme_attach_controller</code> RPC to allow specifying multipath behavior.</p>
<h2>scheduler</h2>
<p>New API for implementing schedulers and governors. Please see <code>include/spdk/scheduler.h</code> for details.</p>
<h2>scsi</h2>
<p>New functions, <code>spdk_scsi_dev_get_first_lun</code> and <code>spdk_scsi_dev_get_next_lun</code> have been added to iterate LUNs of a SCSI device.</p>
<p>Each SCSI device supports 256 LUNs at the maximum now and the macro constant <code>SPDK_SCSI_DEV_MAX_LUN</code> was removed.</p>
<h2>trace_parser</h2>
<p>A new library, lib/trace_parser, has been added. This library provides functions that parse traces recorded by an SPDK application. That includes merging traces from multiple cores, sorting them by their timestamp and constructing trace entries spanning across multiple buffers.</p>
<h2>util</h2>
<p>The <code>spdk_fd_group_add</code> API now takes a <code>name</code> parameter.</p>
<h1>v21.07</h1>
<h2>accel_fw</h2>
<p>Added API <code>spdk_accel_submit_copy_crc32c</code> to perform a CRC32C while copying data.</p>
<p>Added API <code>spdk_accel_batch_prep_copy_crc32c</code> to batch CRC32C + copy commands.</p>
<p>Added API <code>spdk_accel_submit_copy_crc32cv</code> to submit chained CRC32C + copy commands.</p>
<h2>bdev</h2>
<p>Change <code>spdk_bdev_read_blocks_with_md</code> arg offset definition from int64_t to uint64_t.</p>
<p>Red-black tree has been used to organize the bdev names and aliases uniformly to provide faster lookup.</p>
<p>Removed ZCOPY emulation: The bdev module can be checked to see if it supports ZCOPY and if not supported then use existing READ/WRITE commands.</p>
<p>Added iov to spdk_bdev_zcopy_start.</p>
<h2>dpdk</h2>
<p>Updated DPDK submodule to DPDK 21.05.</p>
<h2>idxd</h2>
<p>Remove the <code>probe_cb</code> parameter in <code>spdk_idxd_probe</code> function. And remove the definition of <code>spdk_idxd_probe_cb</code> function pointer. It should be implemented in idxd_user.c.</p>
<p>Added API <code>spdk_idxd_submit_copy_crc32c</code> to perform a CRC32C while copying data.</p>
<p>Added API <code>spdk_idxd_batch_prep_copy_crc32c</code> to prepare a batch operation to perform a CRC32C while copying data.</p>
<p>We have userspace idxd driver under accel_engine library (module/accel/idxd/accel_engine). And kernel idxd driver usage is also added under the accel_engine library. This approach implemented a wrapper library to use IDXD device by leveraging the kernel DSA driver in SPDK idxd library (lib/idxd). Then users can leverage the RPC later to configure how to use the DSA device by user space driver or kernel driver.</p>
<h2>init</h2>
<p>Added new <code>init</code> library that initializes the SPDK subsystems, which previously was internal to application framework. That functionality has been made public and for use by applications which don't leverage SPDK's application framework.</p>
<h2>iscsi</h2>
<p>New parameters, <code>pdu_pool_size</code>, <code>immediate_data_pool_size</code>, and <code>data_out_pool_size</code>, were added to the RPC <code>iscsi_set_options</code> to run iSCSI target with varying amount of available memory.</p>
<h2>json</h2>
<p>Added API <code>spdk_json_write_named_uint128</code> and <code>spdk_json_write_uint128</code> to perform the uint128 related data.</p>
<h2>net</h2>
<p>Removed deprecated <code>net</code> library.</p>
<p>Added support for ZCOPY. ZCOPY is used in preference to READ and WRITE if the bdev module supports ZCOPY and the bdev module has ZCOPY enabled.</p>
<h2>nvme</h2>
<p><code>spdk_nvme_map_prps</code> and <code>spdk_nvme_map_cmd</code> were moved to nvmf/vfio-user as internal APIs as vfio-user is the only user for the above two APIs.</p>
<p>Added a new function <code>spdk_nvme_ns_cmd_copy</code> to submit a Simple Copy Command to a Namespace.</p>
<p>Update the <code>spdk_nvme_generic_command_status_code</code> structure with new status code according to the definition in NVMe 1.4 spec.</p>
<p><code>spdk_nvme_ctrlr_get_default_ctrlr_opts</code> now sets <code>use_cmb_sqs</code> to false. This means that if a controller has a CMB and supports SQs in the CMB, SPDK will not use the CMB for SQs by default - the user must set <code>use_cmb_sqs</code> to true in the <code><a class="el" href="structspdk__nvme__ctrlr__opts.html" title="NVMe controller initialization options.">spdk_nvme_ctrlr_opts</a></code> structure prior to controller attach.</p>
<p>Add a new function <code>spdk_nvme_detach_poll</code> to simplify a common use case to continue polling until all detachments complete.</p>
<p>Added new argument <code>timeout_admin_us</code> to <code>spdk_nvme_ctrlr_register_timeout_callback</code> so callers can specify a different timeout for admin commands vs. io commands.</p>
<p>An existing function <code>spdk_nvme_detach_async</code> was updated to add one or more detachments to an active context while it is being polled.</p>
<p>Rename a variable in the member <code>cmic</code> of the struct <code><a class="el" href="structspdk__nvme__ctrlr__data.html">spdk_nvme_ctrlr_data</a></code> from <code>multi_host</code> to <code>multi_ctrlr</code>. The variable means that the NVM subsystem may have two or more controllers if set to 1. However <code>multi_host</code> had indicated a particular use case such that the NVM subsystem is used by multiple hosts.</p>
<p>A new option <code>disable_read_ana_log_page</code> was added to struct <code><a class="el" href="structspdk__nvme__ctrlr__opts.html" title="NVMe controller initialization options.">spdk_nvme_ctrlr_opts</a></code> to disable reading ANA log page. The upper layer is expected to read ANA log page instead if <code>true</code>. The default value is <code>false</code>.</p>
<p>New APIs, <code>spdk_nvme_ctrlr_reset_async</code> and <code>spdk_nvme_ctrlr_reset_poll_async</code>, have been added to reset a controller asynchronously.</p>
<p>New RPC <code>bdev_nvme_reset_controller</code> was added, to reset an NVMe controller.</p>
<p>Added <code>spdk_nvme_ns_get_nguid</code> function to get NGUID for the given namespace.</p>
<p>Added <code>spdk_nvme_ctrlr_is_fabrics</code> function to indicate whether a ctrlr handle is associated with a fabrics controller.</p>
<h2>nvmf</h2>
<p>Added <code>min_cntlid</code> and <code>max_cntlid</code> to <code>nvmf_create_subsystem</code> to limit the controller ID range. Added <code>spdk_nvmf_subsystem_get_min_cntlid</code> and <code>spdk_nvmf_subsystem_get_max_cntlid</code> to request those values.</p>
<p><code>spdk_nvmf_request_get_buffers_multi</code> API is removed.</p>
<p>Added the <code>nvmf_set_crdt</code> RPC for setting command retry delay times.</p>
<p>Expanded <code><a class="el" href="structspdk__nvmf__poll__group__stat.html">spdk_nvmf_poll_group_stat</a></code> with current qpair count statistics.</p>
<p>Removed following deprecated APIs:</p>
<ul>
<li><code>spdk_nvmf_poll_group_get_stat</code> (function in <code><a class="el" href="nvmf_8h.html" title="NVMe over Fabrics target public API.">nvmf.h</a></code>),</li>
<li><code>spdk_nvmf_transport_poll_group_get_stat</code> (function in <code><a class="el" href="nvmf_8h.html" title="NVMe over Fabrics target public API.">nvmf.h</a></code>),</li>
<li><code>spdk_nvmf_transport_poll_group_free_stat</code>(function in <code><a class="el" href="nvmf_8h.html" title="NVMe over Fabrics target public API.">nvmf.h</a></code>),</li>
<li><code>spdk_nvmf_rdma_device_stat</code> (struct in <code><a class="el" href="nvmf_8h.html" title="NVMe over Fabrics target public API.">nvmf.h</a></code>),</li>
<li><code>spdk_nvmf_transport_poll_group_stat</code> (struct in <code><a class="el" href="nvmf_8h.html" title="NVMe over Fabrics target public API.">nvmf.h</a></code>),</li>
<li><code>poll_group_get_stat</code> (transport op in <code><a class="el" href="nvmf__transport_8h.html" title="NVMe-oF Target transport plugin API.">nvmf_transport.h</a></code>),</li>
<li><code>poll_group_free_stat</code> (transport op in <code><a class="el" href="nvmf__transport_8h.html" title="NVMe-oF Target transport plugin API.">nvmf_transport.h</a></code>).</li>
</ul>
<h2>rpc</h2>
<p>New RPC <code>bdev_rbd_register_cluster</code> and <code>bdev_rbd_unregister_cluster</code> was added, it allows to create and delete the rados object cluster, then users can choose the cluster to create related rbd device.</p>
<p>Revised <code>bdev_rbd_create</code> parameter, it allows to use an optional parameter <code>--cluster-name</code> to create a rbd bdev with an already registered Rados Cluster Object.</p>
<p>New RPC <code>bdev_rbd_get_clusters_info</code> was added, it allows to get the info of the registered Rados Cluster names.</p>
<p>New optional parameter, <code>timeout_admin_us</code>, added to the bdev_nvme_set_options RPC.</p>
<p>Revised a parameter <code>--stripe-size_kb</code> to <code>--stripe-size-kb</code> of <code>bdev_raid_create</code> method provided in <code>scripts/rpc.py</code> for consistency.</p>
<p>An new optional parameter <code>config_kernel_mode</code> was added to the RPC <code>idxd_scan_accel_engine</code>, and this is used to enable using the kernel mode IDXD driver.</p>
<p>Removed deprecated parameter <code>enable-zerocopy-send</code> of RPC <code>sock_impl_set_options</code>, use <code>enable-zerocopy-send-server</code> or <code>enable-zerocopy-send-client</code> instead. Removed deprecated parameter <code>disable-zerocopy-send</code> of RPC <code>sock_impl_set_options</code>, use <code>disable-zerocopy-send-server</code> or <code>disable-zerocopy-send-client</code> instead.</p>
<h2>rpm</h2>
<p>Removed deprecated <code>pkg/spdk.spec</code>, please use <code>rpmbuild/spdk.spec</code> instead. See <a href="https://spdk.io/doc/rpm.html">RPM documentation</a> for more details.</p>
<h2>thread</h2>
<p>Red-black tree has been used for timed pollers to provide faster insertion and deletion and for io_devices to provide faster lookup.</p>
<p>Removed <code>spdk_io_channel</code> structure from public header and moved it to thread_internal.h.</p>
<h2>trace</h2>
<p>Added <code>spdk_trace_register_description_ext</code> function to register variable number of tracepoint arguments.</p>
<p>Added ability to chain multiple trace entries together to extend the size of the argument buffer.</p>
<h2>util</h2>
<p>Red-black tree macros has been added by using the macros provided by the FreeBSD operating system under the same BSD license.</p>
<p>Add an new macro <code>SPDK_SIZEOF_MEMBER</code> to get the size of a member of a struct.</p>
<p><code>spdk_crc32c_iov_update</code> function was added to support calculating the crc32c of the iovs.</p>
<p>Added zipf random number generator with power law probability distribution. When applied to performance testing of block devices, it will select blocks over the full range of LBAs, but will more frequently select lower-numbered LBAs.</p>
<h1>v21.04</h1>
<h2>accel</h2>
<p>Two new accelerated crc32 functions <code>spdk_accel_submit_crc32cv</code> and <code>spdk_accel_batch_prep_crc32cv</code> are added in order to provide the chained accelerated CRC32 computation support.</p>
<h2>bdev</h2>
<p>For <code>bdev_ocssd_create</code> RPC, the optional parameter <code>range</code> was removed. Only one OCSSD bdev can be created for one OCSSD namespace.</p>
<p>Removed the <code>spdk_bdev_open</code> from bdev library API. Removed the <code>spdk_vbdev_register</code> and <code>spdk_bdev_part_base_construct</code> from bdev module API. Removed the <code>config_text</code> function for bdev modules to report legacy config.</p>
<p>Added <code>spdk_bdev_get_max_active_zones</code> API to display maximum number active zones of a given bdev.</p>
<p>Added <code>spdk_bdev_get_max_zone_append_size</code> API to display maximum zone append data transfer size.</p>
<h2>bdev_nvme</h2>
<p>Added support for zoned namespaces.</p>
<h2>blobstore</h2>
<p>Removed the <code>spdk_bdev_create_bs_dev_from_desc</code> and <code>spdk_bdev_create_bs_dev</code> API.</p>
<h2>env</h2>
<p>Added <code>spdk_pci_device_allow</code> API to allow applications to add PCI addresses to the allowed list after the application has started.</p>
<p>Removed the <code>pci_whitelist</code>, <code>pci_blacklist</code> and <code>master_core</code> members of struct <code><a class="el" href="structspdk__env__opts.html" title="Environment initialization options.">spdk_env_opts</a></code>.</p>
<p>Added hotplug support based on uevent in <code>pci_event.c</code>. Added usage of this functionality in nvme, virtio-scsi and virtio_blk libraries. Please see the new API <code>spdk_pci_event_listen</code>, <code>spdk_pci_get_event</code>, <code>spdk_pci_register_error_handler</code> and <code>spdk_pci_unregister_error_handler</code>.</p>
<h2>event</h2>
<p>Removed the <code>config_file</code>, <code>max_delay_us</code>, <code>pci_whitelist</code> and <code>pci_blacklist</code> members of struct <code><a class="el" href="structspdk__app__opts.html" title="Event framework initialization options.">spdk_app_opts</a></code>.</p>
<h2>idxd</h2>
<p>A new API <code>spdk_idxd_device_needs_rebalance</code> was added so that users of the library can know whether they need to rebalance the flow control for the channel that was just added/removed. This is based on how the low level library shares devices amongst channels.</p>
<p>The API <code>spdk_idxd_reconfigure_chan</code> had the <code>num_channels</code> removed as this is now tracked in the library. The app makes use the new API above to determine whether to rebalance or not. This applies to <code>spdk_idxd_configure_chan</code> as well.</p>
<p>The API <code>spdk_idxd_put_channel</code> now returns the rebalance state for the underlying device.</p>
<h2>iscsi</h2>
<p>A security vulnerability has been identified and fixed in the SPDK iSCSI target. A TEXT PDU with no data, but CONTINUE flag set, would result in a NULL pointer dereference and crash the SPDK iSCSI target process. All users of the SPDK iSCSI target are recommended to update. All SPDK versions &lt;= v21.01 are affected.</p>
<h2>net</h2>
<p>The net library is deprecated and will be removed in the 21.07 release.</p>
<h2>nvme</h2>
<p>Added a new function <code>spdk_nvme_ctrlr_get_regs_pmrcap</code> to get the PMR capabilities.</p>
<p>Added an accelerated table pointer in <code>spdk_nvme_poll_group</code> which can be used to provide the accelerated functions by users with hardware engine, such as crc32c accelerated function.</p>
<p>Added new functions <code>spdk_nvme_ctrlr_get_pmrsz</code>, <code>spdk_nvme_ctrlr_enable_pmr</code>, <code>spdk_nvme_ctrlr_disable_pmr</code>, <code>spdk_nvme_ctrlr_map_pmr</code> and <code>spdk_nvme_ctrlr_unmap_pmr</code>.</p>
<p>Added NVMe transport operations to enable, disable, map and unmap the PMR.</p>
<p>Added <code>spdk_nvme_qpair_get_optimal_poll_group</code> function and <code>qpair_get_optimal_poll_group</code> function pointer in <a class="el" href="structspdk__nvmf__transport__ops.html">spdk_nvmf_transport_ops</a> structure in order to add the qpair to the most suitable polling group.</p>
<p>Added OPTPERF and namespace optimal performance fields to <a class="el" href="nvme__spec_8h.html" title="NVMe specification definitions.">nvme_spec.h</a>.</p>
<p>Added <code>spdk_nvme_set_hotplug_filter</code> API to allow applications to choose which hot-inserted SSDs should be probed. This is useful for use cases where multiple independent SPDK processes are running on one node. The filter function can then be implemented in these processes to decide which SSDs to probe based on the new SSD's PCI address.</p>
<p>New functions <code>spdk_nvme_poll_group_get_stats</code> and <code>spdk_nvme_poll_group_free_stats</code> were added. These functions allow to get transport statistics per NVME poll group.</p>
<p>Added <code>spdk_nvme_map_cmd</code> API to map the NVMe command with SGL cases.</p>
<p>Added support for vector variant of ZNS zone append commands with new API <code>spdk_nvme_zns_zone_appendv</code> and <code>spdk_nvme_zns_zone_appendv_with_md</code>.</p>
<p>Added <code>spdk_nvme_zns_ns_get_max_open_zones</code> and <code>spdk_nvme_zns_ns_get_max_active_zones</code> API, to display maximum number of open and active zones of the given namespace.</p>
<p>Added <code>spdk_nvme_zns_ns_get_zone_size_sectors</code> API to provide size of zone in number of sectors.</p>
<p>Added <code>spdk_nvme_qpair_get_id</code> API to display the ID of the specified qpair.</p>
<h2>nvmf</h2>
<p>Removed the <code>spdk_nvmf_tgt_listen</code> and <code>spdk_nvmf_subsystem_add_ns</code> API.</p>
<p>Added new APIs:</p>
<ul>
<li><code>spdk_nvmf_poll_group_dump_stat</code> (function in <code><a class="el" href="nvmf_8h.html" title="NVMe over Fabrics target public API.">nvmf.h</a></code>).</li>
<li><code>poll_group_dump_stat</code> (transport op in <code><a class="el" href="nvmf__transport_8h.html" title="NVMe-oF Target transport plugin API.">nvmf_transport.h</a></code>).</li>
</ul>
<p>The following APIs have been deprecated and will be removed in SPDK 21.07:</p>
<ul>
<li><code>spdk_nvmf_poll_group_get_stat</code> (function in <code><a class="el" href="nvmf_8h.html" title="NVMe over Fabrics target public API.">nvmf.h</a></code>),</li>
<li><code>spdk_nvmf_transport_poll_group_get_stat</code> (function in <code><a class="el" href="nvmf_8h.html" title="NVMe over Fabrics target public API.">nvmf.h</a></code>),</li>
<li><code>spdk_nvmf_transport_poll_group_free_stat</code>(function in <code><a class="el" href="nvmf_8h.html" title="NVMe over Fabrics target public API.">nvmf.h</a></code>),</li>
<li><code>spdk_nvmf_rdma_device_stat</code> (struct in <code><a class="el" href="nvmf_8h.html" title="NVMe over Fabrics target public API.">nvmf.h</a></code>),</li>
<li><code>spdk_nvmf_transport_poll_group_stat</code> (struct in <code><a class="el" href="nvmf_8h.html" title="NVMe over Fabrics target public API.">nvmf.h</a></code>),</li>
<li><code>poll_group_get_stat</code> (transport op in <code><a class="el" href="nvmf__transport_8h.html" title="NVMe-oF Target transport plugin API.">nvmf_transport.h</a></code>),</li>
<li><code>poll_group_free_stat</code> (transport op in <code><a class="el" href="nvmf__transport_8h.html" title="NVMe-oF Target transport plugin API.">nvmf_transport.h</a></code>).</li>
</ul>
<p>See header files for details.</p>
<p>The <code>trtype</code> field in JSON returned by <code>nvmf_get_stats</code> RPC contains now the name of the transport, which is the same as the type for defined transports and more informative for a custom transport.</p>
<p>Added <code>hdgst</code> and <code>ddgst</code> parameters to <code>bdev_nvme_attach_controller</code> RPC in order change state of TCP header and data digest.</p>
<p>Added <code>num_cqe</code> parameter to <code>nvmf_create_transport</code> RPC to set number of completion queues (CQ) for RDMA transport. Useful when CQ resize operation is not supported, for example iWARP.</p>
<h2>ocf</h2>
<p>Updated OCF submodule to v20.12.2</p>
<p>Added <code>bdev_ocf_set_cache_mode</code> RPC to dynamically switch cache mode of OCF bdev.</p>
<p>OCF deprecation notice has removed as Huawei is picking up support for the OCF project.</p>
<h2>opal</h2>
<p>Removed the <code>spdk_opal_supported</code> API.</p>
<h2>raid</h2>
<p>For <code>bdev_raid_create</code> RPC, the deprecated parameter <code>strip_size</code> was removed.</p>
<h2>rpc</h2>
<p>New RPC <code>bdev_nvme_get_transport_statistics</code> was added, it allows to get transport statistics of nvme poll groups.</p>
<p>Parameter <code>enable-zerocopy-send</code> of RPC <code>sock_impl_set_options</code> is deprecated and will be removed in SPDK 21.07, use <code>enable-zerocopy-send-server</code> or <code>enable-zerocopy-send-client</code> instead. Parameter <code>disable-zerocopy-send</code> of RPC <code>sock_impl_set_options</code> is deprecated and will be removed in SPDK 21.07, use <code>disable-zerocopy-send-server</code> or <code>disable-zerocopy-send-client</code> instead.</p>
<p>Added cmd_parser.py used to parse the args from argparse. There are two benefit to use command parser:</p>
<ul>
<li>Simplify the definition of rpc method. It will reduce the rpc method code.</li>
<li>Make the rpc call more versatile. User can add private args into rpc method.</li>
</ul>
<h2>rpm</h2>
<p>Added support for new RPM spec, rpmbuild/spdk.spec, which can be used for packaging the SPDK. The pkg/spdk.spec is considered to be deprecated and scheduled for removal in SPDK 21.07. See <a href="https://spdk.io/doc/rpm.html">RPM documentation</a> for more details.</p>
<h2>sock</h2>
<p>The type of <code>enable_placement_id</code> in struct <code><a class="el" href="structspdk__sock__impl__opts.html" title="SPDK socket implementation options.">spdk_sock_impl_opts</a></code> is changed from bool to int. We can use RPC to configure different value of <code>enable_placement_id</code>. Then we can leverage SO_INCOMING_CPU to get placement_id, which aims to utilize CPU cache locality, enabled by setting enable_placement_id=2.</p>
<p>A new socket placement mode called PLACEMENT_MARK has been added. Some NICs allow sockets to be marked using the SO_MARK socket option as a hint for which hardware queue they should be associated with. This mode leverages that by setting the same value for all sockets within a poll group.</p>
<p>New parameters <code>enable_zerocopy_send_server</code> and <code>enable_zerocopy_send_client</code> were added to struct <a class="el" href="structspdk__sock__impl__opts.html" title="SPDK socket implementation options.">spdk_sock_impl_opts</a>, these parameters enable or disable zero copy send for server and client sockets which are created using <code>spdk_sock_listen</code> and <code>spdk_sock_listen_ext</code> (server); <code>spdk_sock_connect</code> and <code>spdk_sock_connect_ext</code> (client) functions. Existing parameter <code>enable_zerocopy_send</code> enables or disables zero copy send for both server and client sockets.</p>
<h2>thread</h2>
<p>A new API <code>spdk_io_channel_get_io_device</code> was added to get the io_device for the specified I/O channel.</p>
<p>Added <code>spdk_thread_set_interrupt_mode</code> function in order to set present spdk_thread into interrupt mode or back to poll mode. It is valid only when thread interrupt facility is enabled by <code>spdk_interrupt_mode_enable</code>.</p>
<p>Added <code>spdk_poller_register_interrupt</code> function to mark that the poller is capable of entering interrupt mode. Callback function will be called when the poller must transition into or out of interrupt mode.</p>
<h2>virtio</h2>
<p>Added the <code>bdev_virtio_blk_set_hotplug</code> RPC for the virtio blk pci device.</p>
<h1>v21.01</h1>
<h2>bdev</h2>
<p>An <code>opts_size</code> element was added in the <code><a class="el" href="structspdk__bdev__opts.html">spdk_bdev_opts</a></code> structure to solve the ABI compatibility issue between different SPDK version. And also add <code>opts_size</code> parameter in spdk_bdev_get_opts function. Two fields <code>small_buf_pool_size</code> and <code>large_buf_pool_size</code> were added into <a class="el" href="structspdk__bdev__opts.html">spdk_bdev_opts</a>, which were used to determine the small and large buffer pool size of the whole bdev module.</p>
<p>A new API <code>spdk_bdev_wait_for_examine</code> was added to allow for checking state of examine process. Along with corresponding <code>bdev_wait_for_examine</code> RPC, which is now always called during <code>spdk_bdev_subsystem_config_json</code> making sure every bdev is ready to be used.</p>
<p>A new API <code>spdk_bdev_io_get_aio_status</code> was added for getting the status of bdev_io as Linux AIO errno. Also <code>spdk_bdev_io_complete_aio_status</code> function and <code>SPDK_BDEV_IO_STATUS_AIO_ERROR</code> were added for bdev module to complete a bdev_io with Linux AIO errno.</p>
<p>A new API <code>spdk_bdev_get_module_name</code> was added for getting block device module name. Also <code>spdk_bdev_get_module_ctx</code> was added to obtain a bdev module context for the block device opened by the specified descriptor.</p>
<p>Added <code>max_segment_size</code> and <code>max_num_segments</code> to <code><a class="el" href="structspdk__bdev.html">spdk_bdev</a></code> structure for bdev modules to specify splitting requirements.</p>
<h2>blob</h2>
<p>An <code>opts_size</code> element was added in the <code><a class="el" href="structspdk__bs__opts.html">spdk_bs_opts</a></code> structure to solve the ABI compatibility issue between different SPDK version. And also add <code>opts_size</code> parameter in <code>spdk_bs_opts_init</code> function.</p>
<p>An <code>opts_size</code> element was added in the <code><a class="el" href="structspdk__blob__opts.html">spdk_blob_opts</a></code> structure to solve the ABI compatibility issue between different SPDK version. And also add <code>opts_size</code> parameter in <code>spdk_blob_opts_init</code> function.</p>
<p>An <code>opts_size</code> element was added in the <code><a class="el" href="structspdk__blob__open__opts.html">spdk_blob_open_opts</a></code> structure to solve the ABI compatibility issue between different SPDK version. And also add <code>opts_size</code> parameter in <code>spdk_blob_open_opts_init</code> function.</p>
<h2>build</h2>
<p>SPDK now generates pkg-config files to simplify the process of determining which libraries must be linked into an SPDK application.</p>
<h2>dpdk</h2>
<p>Updated DPDK submodule to DPDK 20.11.</p>
<p>Removed <code>--with-igb-uio-driver</code> configure option. Since DPDK 20.11 igb_uio driver was moved to separate dpdk-kmods repository. If required, users need to refer to dpdk-kmods repository to build the driver.</p>
<h2>env</h2>
<p>The <code>pci_whitelist</code>, <code>pci_blacklist</code> and <code>master_core</code> members of struct <code><a class="el" href="structspdk__env__opts.html" title="Environment initialization options.">spdk_env_opts</a></code> have been deprecated. The new members are named <code>pci_allowed</code>, <code>pci_blocked</code> and <code>main_core</code> respectively.</p>
<p>An <code>opts_size</code> element was added in the <code><a class="el" href="structspdk__app__opts.html" title="Event framework initialization options.">spdk_app_opts</a></code> structure to solve the ABI compatibility issue between different SPDK version. An <code>opts_size</code> parameter is added into <code>spdk_app_opts_init</code> function.</p>
<h2>event</h2>
<p>The <code>pci_whitelist</code> and <code>pci_blacklist</code> members of struct <code><a class="el" href="structspdk__app__opts.html" title="Event framework initialization options.">spdk_app_opts</a></code> have been deprecated. The new members are named <code>pci_allowed</code> and <code>pci_blocked</code> respectively.</p>
<p>The <code>--pci-blacklist</code> command line option has been deprecated, replaced with <code>--pci-blocked</code>.</p>
<p>The <code>--pci-whitelist/-W</code> command line options have been deprecated, replaced with <code>--pci-allowed/-A</code>.</p>
<p>Added new experimental <code>dynamic</code> scheduler that rebalances idle threads, adjusts CPU frequency using dpdk_governor and turns idle reactor cores to interrupt mode. Please see <a href="https://www.spdk.io/doc/scheduler.html">scheduler documentation</a> for details.</p>
<h1>ioat</h1>
<p>The PCI BDF whitelist option has been removed from the <code>ioat_scan_accel_engine</code> RPC. IOAT PCI functions can still be allowed or denied using SPDK application command line options.</p>
<h2>isa-l</h2>
<p>Updated ISA-L submodule to v2.30.0.</p>
<h2>json</h2>
<p>A new API <code>spdk_jsonrpc_send_bool_response</code> was added to allow sending response for writing json bool results into one function. Update API <code>bdev_nvme_set_options</code> and add a <code>keep_alive_timeout_ms</code> parameter. Now you can specify the <code>keep_alive_timeout</code> before creating NVMe bdev.</p>
<h2>nbd</h2>
<p>Change the return type of function <code>spdk_nbd_stop</code> from void to int. And update the <code>spdk_nbd_fini</code> with two parameters to make its behavior from sync to async.</p>
<h2>nvme</h2>
<p>Directives support was added to the NVMe driver.</p>
<p>Two async APIs <code>spdk_nvme_ctrlr_cmd_directive_receive</code> and <code>spdk_nvme_ctrlr_cmd_directive_send</code> are added for Directive Send and Directive Receive command, respectively.</p>
<p>Added a new function <code>spdk_nvme_ctrlr_reset_subsystem</code> to perform a NVMe subsystem reset. Note: The NVMe-oF target does not support the subsystem reset yet.</p>
<p>Add a new function <code>spdk_nvme_bytes_to_numd</code> to transfer bytes to number of dwords.</p>
<p>Added a new custom transport <code>SPDK_NVME_TRANSPORT_VFIOUSER</code> to enable NVMe driver running with NVMe over vfio-user target.</p>
<p>Added the vfio-user custom transport implementation in NVMe driver which can connect to NVMe over vfio-user target via vfio-user transport.</p>
<p>Added a new function <code>spdk_nvme_ctrlr_set_remove_cb</code> to remove or override <code>remove_cb</code> and <code>remove_ctx</code> specified when the controller was probed.</p>
<p>Added support for ZNS zone append command with new API <code>spdk_nvme_zns_zone_append</code> and <code>spdk_nvme_zns_zone_append_with_md</code>.</p>
<h2>nvmf</h2>
<p><code>nvmf_fc_lld_fini</code> now takes callback and hence updating FC Broadcom LLD driver to the latest is required.</p>
<p>FC transport supported primary tagging and VMID.</p>
<p>Broadcom FC LLD driver and SPDK NVMe-oF FC transport consolidated one LLD API, <code>nvmf_fc_init_poller_queues</code> into another LLD API <code>nvmf_fc_init_q</code>. Hence updating Broadcom FC LLD driver to the latest is required.</p>
<p>The functions <code>destroy</code> and <code>qpair_fini</code> in the transport interface now accept a <code>cb_fn</code> and <code>cb_arg</code> to call upon completion, and their execution can be asynchronous.</p>
<p>The SPDK NVMe-oF target now supports async event notification for discovery log changes. This allows the initiator to create persistent connection to discovery controller and be notified of any discovery log changes.</p>
<p>An <code>opts_size</code> element was added in the <code><a class="el" href="structspdk__nvmf__transport__opts.html">spdk_nvmf_transport_opts</a></code> structure to solve the ABI compatibility issue between different SPDK version. And also add <code>opts_size</code> parameter in <code>spdk_nvmf_transport_opts_init</code> function.</p>
<p>Added a new custom vfio-user transport implementation in NVMe-oF which can provide emulated NVMe devices to QEMU and SPDK NVMe driver.</p>
<p>Added new API <code>spdk_nvmf_tgt_listen_ext</code> that uses <code><a class="el" href="structspdk__nvmf__listen__opts.html">spdk_nvmf_listen_opts</a></code> to allow passing generic options to specific transport. This functionality replaces one provided with <code>nvmf_subsystem_set_options</code>. Also removed <code>nvmf_subsystem_set_options</code> RPC that allowed transport specific options within subsystem.</p>
<p>The <code>trsvcid</code> in <code>nvmf_subsystem_add_listener</code> RPC is now optional.</p>
<p>Pausing a subsystem now only pauses all admin queues. This allows for the management of hosts and listeners, plus the addition of namespaces without a full subsystem pause. Additionally, the target now allows for pausing individual namespaces within a subsystem. To remove a namespace from a subsystem, only the specific namespace must be paused. I/O will continue to other namespaces while these operations execute.</p>
<h2>rpc</h2>
<p>An new optional parameter <code>wait</code> was added to the RPC <code>iscsi_create_portal_group</code>, and an new RPC <code>iscsi_start_portal_group</code> was added. They will be used not to start listening on portals for a portal group until all associated target nodes are created at startup, otherwise some iSCSI initiators may fail to re-login when SPDK iSCSI target application restarts.</p>
<p>Two optional parameter <code>--small-buf-pool-size</code> and <code>--large-buf-pool-size</code> were added into <code>bdev_set_options</code> function.</p>
<h2>vhost</h2>
<p>Added optional <code>packed_ring_recovery</code> parameter to <code>vhost_create_blk_controller</code> RPC enabling packed ring live recovery.</p>
<h1>v20.10</h1>
<h2>accel</h2>
<p>New APIs <code>spdk_accel_batch_cancel</code> and <code>spdk_idxd_batch_cancel</code> were added to allow cancelling a batch sequence.</p>
<h2>bdev</h2>
<p>A new <code>spdk_bdev_part_base_construct_ext</code> function has been added and the <code>spdk_bdev_part_base_construct</code> has been deprecated. The <code>spdk_bdev_part_base_construct_ext</code> function takes bdev name as an argument instead of bdev structure to avoid a race condition that can happen when the bdev is being removed between a call to get its structure based on a name and actually opening it.</p>
<p>Removed <code>spdk_bdev_config_text</code> function for bdev modules to report legacy config.</p>
<h2>blobstore</h2>
<p>A new <code>spdk_bdev_create_bs_dev_ext</code> function has been added and <code>spdk_bdev_create_bs_dev_from_desc</code> function has been deprecated.</p>
<h2>dpdk</h2>
<p>Updated DPDK submodule to DPDK 20.08.</p>
<h2>env</h2>
<p>A new API <code>spdk_mem_get_fd_and_offset</code> was added to get file descriptor and offset for a given virtual address.</p>
<h2>event</h2>
<p>Removed <code>spdk_subsystem_config</code> callback for submodules as part of legacy config removal.</p>
<p>Removed <code>spdk_app_get_running_config</code> function that printed configuration in legacy format, and removed <code>usr1_handler</code> from <code>struct <a class="el" href="structspdk__app__opts.html" title="Event framework initialization options.">spdk_app_opts</a></code> callback that was used to call it.</p>
<p>Added SPDK thread scheduler framework which is used to rebalance load among CPU cores. The scheduler implementation is pluggable and two schedulers are added first, <code>static</code> scheduler and <code>gscheduler</code> scheduler.</p>
<p><code>static</code> scheduler is used by default and does not reschedule threads and keeps the initial assignments.</p>
<p>CPU frequency governor framework and implementation are also added. <code>dpdk_governor</code> is the first implementation and is based on rte_power library of DPDK. <code>gscheduler</code> scheduler utilizes the CPU frequency governor.</p>
<p>Scheduler and governor frameworks are experimental features.</p>
<h2>fio</h2>
<p>Bdev fio_plugin no longer supports legacy configuration files. Options <code>spdk_conf</code> and <code>spdk_json_conf</code> have to point to valid JSON configuration.</p>
<h2>gpt</h2>
<p>Removed option to disable GPT probing via legacy configuration. Please use generic bdev functionality to replicate the behavior. See <code>bdev_set_options --disable-auto-examine</code> and <code>bdev_examine</code> RPC.</p>
<h2>intel-ipsec-mb</h2>
<p>Updated intel-ipsec-mb submodule to v0.54</p>
<h2>isa-l</h2>
<p>Updated ISA-L submodule to v2.29.0.</p>
<h2>iscsi</h2>
<p>The iSCSI target supports iSCSI login redirection feature to achieve fault tolerance and load balancing particularly in scale out iSCSI target system, which runs multiple SPDK iSCSI targets.</p>
<h2>json</h2>
<p>A new API <code>spdk_json_decode_object_relaxed</code> was added to allow parsing json values even if decoder for a given key is not found.</p>
<p>A new API <code>spdk_json_free_object</code> was added to free memory allocated by <code>spdk_json_decode_object</code>.</p>
<h2>log</h2>
<p>A log flag structure, <code>spdk_log_register_flag</code>, <code>spdk_log_get_first_flag</code>, <code>spdk_log_get_next_flag</code> and macro <code>SPDK_LOG_REGISTER_COMPONENT</code>, have been added which enable registering and interacting with log flags. Added <code>SPDK_INFOLOG</code>, <code>SPDK_DEBUGLOG</code> and <code>SPDK_LOGDUMP</code> macros to display logs for specified log flag.</p>
<p>The log flags in the event framework <code>-L</code> and several SPDK applications has been enabled on release builds of SPDK. On debug builds this option will additionally set log print level to <code>SPDK_LOG_DEBUG</code>.</p>
<p>A new API <code>spdk_log_enable_timestamps</code> and new RPC <code>log_enable_timestamps</code> was added to toggle log timestamps.</p>
<h2>miscellaneous</h2>
<p>The contents of the log_rpc library have been moved to the event library. The log_rpc library now no longer exists.</p>
<p>The contents of the app_rpc library have been moved to the event library. The app_rpc library now no longer exists.</p>
<p>The contents of the bdev_rpc library have been moved to the bdev library. The app_rpc library now no longer exists.</p>
<p>The bdevperf application now disables the zcopy API by default. Prior to this change, bdevperf enabled using the zcopy API by default which caused a performance impact of up to 25% on bdevs that don't natively support zcopy because the API emulates zero-copy by allocating a buffer. The bdevperf <code>-x</code> param was renamed to <code>-Z</code> and the default value changed to false. For bdevs that support zcopy, use the -Z flag to enable using zcopy API.</p>
<h2>net</h2>
<p>Net framework intended for use by user-space TCP stacks was removed.</p>
<h2>nvme</h2>
<p>Zoned Namespace Command Set support has been added to NVMe driver, see <code><a class="el" href="nvme__zns_8h.html" title="NVMe driver public API extension for Zoned Namespace Command Set.">nvme_zns.h</a></code> for details.</p>
<p>New APIs, <code>spdk_nvme_detach_async</code> and <code>spdk_nvme_detach_poll_async</code>, have been added to detach multiple controllers in parallel to mitigate lengthy shutdown notification of a few NVMe SSDs.</p>
<p>New APIs, <code>spdk_nvme_ns_get_ana_group_id</code> and <code>spdk_nvme_ns_get_ana_state</code>, have been added to get ANA group ID and ANA state of the given namespace, respectively.</p>
<p>If no specific command set is requested (by setting the command_set member in the <code><a class="el" href="structspdk__nvme__ctrlr__opts.html" title="NVMe controller initialization options.">spdk_nvme_ctrlr_opts</a></code> structure), SPDK will automatically select the most appropriate command set based on what the controller supports.</p>
<h2>nvmf</h2>
<p>A new API <code>spdk_nvmf_subsystem_add_ns_ext</code> has been added and the API <code>spdk_nvmf_subsystem_add_ns</code> has been deprecated.</p>
<p>The NVMe-oF target now supports Asymmetric Namespace Access (ANA) Reporting to provide multipath to NVMe-oF initiator.</p>
<p>Add <code>no_wr_batching</code> parameter to <code><a class="el" href="structspdk__nvmf__transport__opts.html">spdk_nvmf_transport_opts</a></code> struct to disable Work Requests batching in RDMA transport.</p>
<p>NVMf Target transports can now parse any additional JSON params in the nvmf_create_transport RPC through the JSON context provided via spdk_nvmf_target_opts-&gt;transport_specific.</p>
<p>A new RPC <code>nvmf_subsystem_set_options</code> was added to allow transport specific options within subsystem.</p>
<p>A new API <code>spdk_nvmf_transport_stop_listen_async</code> was added to stop accepting new connections at the provided address. <code>nvmf_subsystem_remove_listener</code> RPC now uses this function.</p>
<p>A new API <code>spdk_nvmf_subsystem_disconnect_host</code> was added to disconnect all connections originating from the provided hostnqn. <code>nvmf_subsystem_remove_host</code> RPC now uses this function.</p>
<h2>ocf</h2>
<p>Updated OCF submodule to v20.03.1</p>
<h2>rpc</h2>
<p>New optional parameters, <code>enable_placement_id</code> and <code>enable_quickack</code> were added to the <code>sock_impl_set_options</code> RPC.</p>
<p>A new RPC <code>bdev_examine_bdev</code> was added to allow users to examine a bdev explicitly. It can be used only if bdev_auto_examine is set to false by the RPC <code>bdev_set_options</code>.</p>
<p>New optional parameters <code>no_wr_batching</code> and <code>control_msg_num</code> were added to the RPC 'nvmf_create_transport'.</p>
<p>New RPCs, <code>iscsi_target_node_set_redirect</code> and <code>iscsi_target_node_request_logout</code>, have been added, and a new optional parameter <code>private</code> has been added to the RPC <code>iscsi_create_portal_group</code> to support iSCSI login redirection feature.</p>
<p>A new optional parameter <code>ana_reporting</code> was added to the RPC <code>nvmf_create_subsystem</code>, and a new RPC <code>nvmf_subsystem_listener_set_ana_state</code> was added for ANA reporting.</p>
<p>New RPCs, <code>nvmf_subsystem_get_listeners</code> and <code>nvmf_subsystem_get_qpairs</code>, were added to retrieve configuration of the NVMe-oF subsystem.</p>
<h2>scsi</h2>
<p>Two new APIs have been added <code>spdk_scsi_dev_construct_ext</code> and <code>spdk_scsi_dev_add_lun_ext</code> that allow the upper layer(e.g. vhost-scsi) to receive the notification when the scsi bdev has been resized.</p>
<p>The <code>spdk_scsi_dev_construct</code> and <code>spdk_scsi_dev_add_lun</code> eventually may be deprecated and removed.</p>
<h2>sock</h2>
<p>The <code>enable_placement_id</code> field was added in the <code>struct <a class="el" href="structspdk__sock__impl__opts.html" title="SPDK socket implementation options.">spdk_sock_impl_opts</a></code> to make the placement_id feature configurable by users. The default setting is not enabled.</p>
<p>The <code>enable_quick_ack</code> field was added in the <code>struct <a class="el" href="structspdk__sock__impl__opts.html" title="SPDK socket implementation options.">spdk_sock_impl_opts</a></code> to enable or disable quick ack for the POSIX sock module. The default setting is not enabled.</p>
<h2>thread</h2>
<p><code>fd_group</code> is applied to support interrupt mode. New APIs were added to support an experimental interrupt mode. This allows modules or libraries to selectively register file descriptors that the spdk_thread can wait on, as an alternative to polling. In v20.10, this functionality is enabled in a very small subset of SPDK libraries and modules.</p>
<h2>util</h2>
<p>A new utility named <code>fd_group</code> was add. It is now implemented by epoll on Linux platform. It can be used by spdk_thread and reactor to implement interrupt mode.</p>
<p>Added <code>spdk_bit_pool</code> utility, see <code><a class="el" href="bit__pool_8h.html" title="Bit pool data structure.">bit_pool.h</a></code> for details.</p>
<h2>vhost</h2>
<p>SPDK has switched to DPDK's rte_vhost library since 19.07 release, removed the internal rte_vhost library which is used for DPDK older than 19.05, removed the experimental vhost nvme target which depends on the internal rte_vhost library.</p>
<h2>vpp</h2>
<p>Removed socket abstraction for VPP.</p>
<h1><a class="anchor" id="changelog-v20-07"></a>
v20.07: SPDK CSI driver, new accel_fw commands, I/O abort support</h1>
<p>spdk_json_free_object() was added to free memory allocated by spdk_json_decode_object().</p>
<h2>accel</h2>
<p>A new API was added <code>spdk_accel_get_capabilities</code> that allows applications to query the capabilities of the currently enabled accel engine back-end.</p>
<p>A new capability, CRC-32C, was added via <code>spdk_accel_submit_crc32c</code>.</p>
<p>The software accel engine implementation has added support for CRC-32C.</p>
<p>A new capability, compare, was added via <code>spdk_accel_submit_compare</code>.</p>
<p>The software accel engine implementation has added support for compare.</p>
<p>Several APIs were added to <code>accel_engine.h</code> to support batched submission of operations.</p>
<p>Several APIs were added to <code>accel_engine.h</code> to support dualcast operations.</p>
<h2>accel_fw</h2>
<p>The accel_fw was updated to no longer require the app to allocate an accel_task on its behalf. All public APIs now take a callback arg as the parameter that used to be the accel_task.</p>
<p>The accel_fw API <code>spdk_accel_task_size</code> was removed as it is no longer required.</p>
<p>The accel_fw was updated to support compare, dualcast, crc32c.</p>
<p>The accel_fw introduced batching support for all commands in all plug-ins. See docs for detailed information.</p>
<h2>bdev</h2>
<p>A new API <code>spdk_bdev_abort</code> has been added to submit abort requests to abort all I/Os whose callback context match to the bdev on the given channel.</p>
<h2>build</h2>
<p>The fio plugins now compile to <code>build/fio</code> and are named <code><a class="el" href="structspdk__bdev.html">spdk_bdev</a></code> and <code>spdk_nvme</code>. Existing fio configuration files will need to be updated.</p>
<h2>dpdk</h2>
<p>Updated DPDK submodule to DPDK 20.05.</p>
<h2>env</h2>
<p>Several new APIs have been added to provide greater flexibility in registering and accessing polled mode PCI drivers. See <code><a class="el" href="env_8h.html" title="Encapsulated third-party dependencies.">env.h</a></code> for more details.</p>
<h2>idxd</h2>
<p>The idxd library and plug-in module for the accel_fw were updated to support all accel_fw commands as well as batching. Batching is supported both through the library and the plug-in module.</p>
<p>IDXD engine support for CRC-32C has been added.</p>
<h2>ioat</h2>
<p>A new API <code>spdk_ioat_get_max_descriptors</code> was added.</p>
<h2>nvme</h2>
<p>An <code>opts_size</code>element was added in the <code><a class="el" href="structspdk__nvme__ctrlr__opts.html" title="NVMe controller initialization options.">spdk_nvme_ctrlr_opts</a></code> structure to solve the ABI compatibility issue between different SPDK version.</p>
<p>A new API <code>spdk_nvme_ctrlr_cmd_abort_ext</code> has been added to abort previously submitted commands whose callback argument match.</p>
<p>Convenience functions, <code>spdk_nvme_print_command</code> and <code>spdk_nvme-print_completion</code> were added to the public API.</p>
<p>A new function, <code>spdk_nvmf_cuse_update_namespaces</code>, updates the cuse representation of an NVMe controller.</p>
<p>A new function <code>qpair_iterate_requests</code> has been added to the nvme transport interface. ALl implementations of the transport interface will have to implement that function.</p>
<h2>nvmf</h2>
<p>The NVMe-oF target no longer supports connecting scheduling configuration and instead always uses what was previously called "transport" scheduling.</p>
<p><code>spdk_nvmf_tgt_accept</code> no longer exists. The accept process now occurs automatically after the creation of an nvmf target and queue pairs are assigned to poll groups by the underlying transport. Further, <code><a class="el" href="structspdk__nvmf__transport__ops.html">spdk_nvmf_transport_ops</a></code> has changed such that the accept function pointer no longer takes a function pointer as an argument. Instead, transports should call <code>spdk_nvmf_tgt_new_qpair</code> whenever they previously would have called that callback.</p>
<p>The NVMe-oF target now supports aborting any submitted NVM or Admin command. Previously, the NVMe-oF target could abort only Asynchronous Event Request commands.</p>
<h2>rdma</h2>
<p>A new <code>rdma</code> library has been added. It is an abstraction layer over different RDMA providers. Two providers are available - verbs (used by default when RDMA is enabled or enabled explicitly using &ndash;with-rdma=verbs) and mlx5 Direct Verbs aka DV (enabled by &ndash;with-rdma=mlx5_dv). Using mlx5_dv requires libmlx5 installed on the system.</p>
<h2>rpc</h2>
<p>Parameter <code>-p</code> or <code>--max-qpairs-per-ctrlr</code> of <code>nvmf_create_transport</code> RPC command accepted by the rpc.py script is deprecated, new parameter <code>-m</code> or <code>--max-io-qpairs-per-ctrlr</code> was added.</p>
<p>Added <code>sock_impl_get_options</code> and <code>sock_impl_set_options</code> RPC methods.</p>
<p>Command line parameters <code>-r</code> and <code>--rpc-socket</code> will longer accept TCP ports. RPC server must now be started on a Unix domain socket. Exposing RPC on the network, as well as providing proper authentication (if needed) is now a responsibility of the user.</p>
<p>The <code>bdev_set_options</code> RPC has a new option, <code>bdev_auto_examine</code> to control the auto examine function of bdev modules.</p>
<p>New RPCs <code>sock_impl_get_options</code> and <code>sock_impl_set_options</code> been added to expose new socket features. See <code>sock</code> section for more details.</p>
<h2>sock</h2>
<p>Added <code>spdk_sock_impl_get_opts</code> and <code>spdk_sock_impl_set_opts</code> functions to set/get socket layer configuration options. Options can be set independently for each implementation.</p>
<p>Added <code>recv_buf_size</code> and 'send_buf_size' socket layer options. They are used only in posix implementation.</p>
<p>Added <code>uring</code> based socket implementation, the code is located in module/sock/uring. This feature is only available in Linux which requires kernel version is greater than 5.4.3. Currently, our CI pool added the uring based socket tests for iSCSI target and also the tests for SPDK NVMe-oF tcp transport.</p>
<p>Added <code>enable_recv_pipe</code> socket layer option to allow disabling of double buffering on receive. New option is used only in posix implementation.</p>
<p>Added <code>enable_zerocopy_send</code> socket layer option to allow disabling of zero copy flow on send. New option is used only in posix implementation.</p>
<h2>util</h2>
<p>Some previously exposed CRC32 functions have been removed from the public API - <code>spdk_crc32_update</code>, <code>spdk_crc32_table_init</code>, and the <code>spdk_crc32_table</code> struct.</p>
<h2>vhost</h2>
<p>The function <code>spdk_vhost_blk_get_dev</code> has been removed.</p>
<h1><a class="anchor" id="changelog-v20-04"></a>
v20.04: SPDK Top, IDXD, NVMe qpair groups</h1>
<p>IDXD engine support for compare has been added.</p>
<h2>configuration</h2>
<p>Legacy INI style configuration for SPDK applications has been deprecated and will be removed in future release. Please switch to JSON-RPC configuration files and/or RPC driven run-time configuration.</p>
<h2>copy</h2>
<p>The copy engine library, modules and public APIs have been renamed. Use of the word <code>copy</code> has been replaced with the word <code>accel</code> short for accelerator in preparation for adding new capabilities in the future. Additionally, APIs for what was previously called the <code>memcpy</code> engine have been renamed to identify the engine as a software accelerator.</p>
<h2>crypto</h2>
<p>Support for AES_XTS was added for the QAT polled mode driver (pmd). The create RPC <code>bdev_crypto_create</code> has 2 new optional parameters: cipher and key2. Cipher can be either AES_CBC (default) or AES_XTS. AES_XTS is only valid when using the QAT polled mode driver. The key2 parameter is the second key required for AES_XTS.</p>
<h2>event</h2>
<p>Reactors now accumulate CPU stats and they are retrieved by the RPC <code>framework_get_reactors</code>.</p>
<h2>idxd</h2>
<p>IDXD support was added in the form of a low level library that can directly utilize the IDXD offload engine as well as an accel plug-in module allowing for use with the generic accel framework API. IDXD is the first in a family of offload engines that share the same interface, specifically DSA is added here. More info can be found here: <a href="https://01.org/blogs/2019/introducing-intel-data-streaming-accelerator">https://01.org/blogs/2019/introducing-intel-data-streaming-accelerator</a></p>
<p>Much of the implementation models IOAT, however the low level interfaces are very different. The RPC to enable IDXD requires a configuration number as well. The code includes two pre-defined configurations of IDXD groups/work queues/engines. A future version will provide an interface to allow for setting of individual configuration parameters.</p>
<p>IDXD is not yet available so this feature should be considered experimental. It will be built up with additional documentation as an ongoing activity.</p>
<h2>iscsi</h2>
<p>The iSCSI target now creates a lightweight thread per poll group instead of assuming a pool of lightweight threads already exist at start up time. A poll group is a collection of unrelated iSCSI connections. Each poll group is only accessed from the associated lightweight thread.</p>
<h2>ftl</h2>
<p>Several changes have been made to the <code><a class="el" href="structspdk__ftl__conf.html">spdk_ftl_conf</a></code>, <code>spdk_ftl_dev_init_ops</code>, and <code><a class="el" href="structspdk__ftl__attrs.html">spdk_ftl_attrs</a></code> structs. Please see <code>include/spdk/ftl.h</code> for more details.</p>
<h2>miscellaneous</h2>
<p>The <code>--json-ignore-init-errors</code> command line parameter has been added to ignore initialization errors on JSON config load.</p>
<p>The public header file io_channel.h has been removed. Please use <a class="el" href="thread_8h.html" title="Thread.">thread.h</a> which has the exact same API.</p>
<h2>nvme</h2>
<p>Exported internal nvme_ctrlr_cmd_security_receive/send() APIs as public APIs with "the spdk_" prefix.</p>
<p>Added <code>priority</code> field in <code><a class="el" href="structspdk__nvme__transport__id.html" title="NVMe transport identifier.">spdk_nvme_transport_id</a></code>, this field is used to specify the priority of the NVMe-oF connection, and currently it is used for NVMe-oF tcp connection.</p>
<p>A new poll group API has been added to allow for pooling of nvme qpairs across a single entity which can be polled for completions. This new API consists of the <code>spdk_nvme_poll_group</code> family of functions. As a result of this new API, all NVMe transports are expected to implement several poll group related functions.</p>
<p>A new flag, <code>create_only</code>, has been added to the <code><a class="el" href="structspdk__nvme__io__qpair__opts.html" title="NVMe I/O queue pair initialization options.">spdk_nvme_io_qpair_opts</a></code> structure. This flag allows a user to call <code>spdk_nvme_ctrlr_get_default_io_qpair</code> without also connecting the qpair within the context of that call.</p>
<p>As a result of the <code>create_only</code> flag, two new API functions, <code>spdk_nvme_ctrlr_connect_io_qpair</code> and <code>spdk_nvme_ctrlr_disconnect_io_qpair</code>, have been added to facilitate connecting newly created qpairs (for example, after they have been added to a poll group) and disconnecting qpairs without destroying them (for example to disconnect a qpair before migrating it to a new poll group and reconnecting it).</p>
<p>The functions <code>spdk_nvme_ctrlr_alloc_cmb_io_buffer</code> and <code>spdk_nvme_ctrlr_free_cmb_io_buffer</code> have been changed to <code>spdk_nvme_ctrlr_map_cmb</code> and <code>spdk_nvme_ctrlr_unmap_cmb</code> respectively.</p>
<p>An additional function, <code>spdk_nvme_ctrlr_reserve_cmb</code>, has been added to facilitate reserving the entire size of the controller memory buffer for data transfer.</p>
<h2>nvme_cuse</h2>
<p><code>spdk_nvme_cuse_get_ctrlr_name</code> now takes two additional parameters, <code>char *name</code> which stores the pointer to the controller name, and <code>size_t *size</code> which stores the length of the name. The return type has also been changed from char * to int.</p>
<p><code>spdk_nvme_cuse_get_ns_name</code> now takes two additional parameters, <code>char *name</code> which stores the pointer to the namespace name, and <code>size_t *size</code> which stores the length of the name. The return type has also been changed from char * to int.</p>
<h2>nvme_opal</h2>
<p>Several public OPAL structure definitions have been changed since the last release.</p>
<h2>nvmf</h2>
<p><code><a class="el" href="nvmf_8h.html#a12a23b74ddfec6b8683b3a0afccba10d" title="Destroy a poll group.">spdk_nvmf_poll_group_destroy()</a></code> is now asynchronous and accepts a completion callback.</p>
<p>The NVMe-oF target now creates a lightweight thread per poll group instead of assuming a pool of lightweight threads already exist at start up time. A poll group is a collection of unrelated NVMe-oF connections. Each poll group is only accessed from the associated lightweight thread.</p>
<p>A new struct, <code>spdk_nvmf_subsystem_listener</code>, has been added to encapsulate the subsystem specific nature of a listener object.</p>
<p><code>spdk_nvmf_tgt_listen</code> no longer accepts a callback function or argument. It also returns an int to indicate the status of the listen call.</p>
<p>The execution of <code>spdk_nvme_poll_group_destroy</code> is now asynchronous and the function accepts a cb_fn and cb_arg to call upon completion.</p>
<p>The execution of <code>spdk_nvmf_subsystem_add_listener</code> is now asynchronous and the function accepts a cb_fn and cb_arg to call upon completion.</p>
<p>The <code><a class="el" href="nvmf__transport_8h.html" title="NVMe-oF Target transport plugin API.">nvmf_transport.h</a></code> header has been made public to allow custom NVMe-oF transports to integrate with NVMe-oF libraries without using internal APIs.</p>
<h2>ocf</h2>
<p>Updated the OCF submodule to OCF v20.03</p>
<p>New version of OCF comes with API changes and bug fixes</p>
<h2>rpc</h2>
<p>A new RPC <code>thread_set_cpumask</code> has been added to set the cpumask of the thread to the specified value.</p>
<p>A new RPC <code>thread_get_pollers</code> has been added to retrieve pollers from SPDK threads.</p>
<p>A new RPC <code>thread_get_io_channels</code> has been added to retrieve I/O channels from SPDK threads.</p>
<p>A new RPC <code>bdev_rbd_resize</code> has been added to resize Ceph RBD bdevs.</p>
<h2>sock</h2>
<p>The <code>spdk_sock_set_priority</code> function has been removed since the feature to set the sock priority will be contained in two new functions, i.e., <code>spdk_sock_listen_ext</code> and <code>spdk_sock_connect_ext</code>. Users may now specify the priority of the socket in the opts that they want to use.</p>
<h2>spdk_top</h2>
<p>A new application, <code>spdk_top</code>, has been added which allows users to monitor resource consumption by a running SPDK application. More information on this application can be found in <code>app/spdk_top/README</code>.</p>
<h2>thread</h2>
<p>A new function <code>spdk_thread_lib_init_ext</code> has been added, and the function <code>spdk_thread_lib_init</code> has been deprecated. The user of <code>spdk_thread_lib_init_ext</code> is expected to implement both functions <code>spdk_thread_op_fn</code> and <code>spdk_thread_op_supported_fn</code>. <code>spdk_thread_op_supported_fn</code> is called to check whether the SPDK thread operation is supported. <code>spdk_thread_op_fn</code> is called to execute the SPDK thread operation. Current SPDK operation types are <code>SPDK_THREAD_OP_NEW</code> and <code>SPDK_THREAD_OP_RESCHED</code>. The operation <code>SPDK_THREAD_OP_NEW</code> is called each time a new thread is created. The operation <code>SPDK_THREAD_OP_RESCHED</code> is called when SPDK thread needs to be rescheduled.</p>
<p>A unique ID has been added for each created SPDK thread, it is retrieved by a new function <code>spdk_thread_get_id</code>, and the SPDK thread which has the specific ID is got by a new function <code>spdk_thread_get_by_id</code>.</p>
<p>A new function <code>spdk_thread_cpumask</code> has been added to set the current thread's cpumask to the specified value. The function requires the operation <code>SPDK_THREAD_OP_RESCHED</code> is supported.</p>
<p>A new function <code>spdk_poller_register_named</code> has been added to set arbitrary name to the created poller. If NULL, the name is set to the pointer of the poller function.</p>
<p>The function <code>spdk_thread_poll</code> now measures run time per call correctly on multiple SPDK threads configuration, and a new function <code>spdk_thread_get_last_tsc</code> has been added to use together.</p>
<p>Voluntary termination of SPDK thread has been supported by refining the functions <code>spdk_thread_exit</code> and <code>spdk_thread_poll</code>.</p>
<h2>util</h2>
<p>New functions <code>spdk_sn32_lt</code> and <code>spdk_sn32_gt</code> have been added. They compare two sequence numbers based on serial number arithmetic.</p>
<h2>vhost</h2>
<p>Poll groups per session have been replaced by SPDK threads per vhost controller.</p>
<h2>vmd</h2>
<p>A new function, <code>spdk_vmd_fini</code>, has been added. It releases all resources acquired by the VMD library through the <code>spdk_vmd_init</code> call.</p>
<h1><a class="anchor" id="changelog-v20-01"></a>
v20.01: Optimized thin provisioning, FTL bdev, VMD hot plug, FUSED support</h1>
<h2>bdev</h2>
<p>A new function, <code>spdk_bdev_set_timeout</code>, has been added to set per descriptor I/O timeouts.</p>
<p>A new class of functions <code>spdk_bdev_compare*</code>, have been added to allow native bdev support of block comparisons and compare-and-write.</p>
<p>A new class of bdev events, <code>SPDK_BDEV_EVENT_MEDIA_MANAGEMENT</code>, has been added to allow bdevs which expose raw media to alert all I/O channels of pending media management events.</p>
<p>A new API was added <code>spdk_bdev_io_get_aux_buf</code> allowing the caller to request an auxiliary buffer for its own private use. The API is used in the same manner that <code>spdk_bdev_io_get_buf</code> is used and the length of the buffer is always the same as the bdev_io primary buffer. 'spdk_bdev_io_put_aux_buf' frees the allocated auxiliary buffer.</p>
<h2>blobfs</h2>
<p>Added boolean return value for function spdk_fs_set_cache_size to indicate its operation result.</p>
<p>Added <code>blobfs_set_cache_size</code> RPC method to set cache size for blobstore filesystem.</p>
<h2>blobstore</h2>
<p>Added new <code>use_extent_table</code> option to <code><a class="el" href="structspdk__blob__opts.html">spdk_blob_opts</a></code> for creating blobs with Extent Table descriptor. Using this metadata format, dramatically decreases number of writes required to persist each cluster allocation for thin provisioned blobs. Extent Table descriptor is enabled by default. See the <a href="https://spdk.io/doc/blob.html#blob_pg_cluster_layout">Blobstore Programmer's Guide</a> for more details.</p>
<h2>dpdk</h2>
<p>Updated DPDK submodule to DPDK 19.11.</p>
<h2>env_dpdk</h2>
<p><code>spdk_env_dpdk_post_init</code> now takes a boolean, <code>legacy_mem</code>, as an argument.</p>
<p>A new function, <code>spdk_env_dpdk_dump_mem_stats</code>, prints information about the memory consumed by DPDK to a file specified by the user. A new utility, <code>scripts/dpdk_mem_info.py</code>, wraps this function and prints the output in an easy to read way.</p>
<h2>event</h2>
<p>The functions <code>spdk_reactor_enable_framework_monitor_context_switch()</code> and <code>spdk_reactor_framework_monitor_context_switch_enabled()</code> have been changed to <code><a class="el" href="event_8h.html#a367fa3d40d7f507cc4f258b27592fb43" title="Enable or disable monitoring of context switches.">spdk_framework_enable_context_switch_monitor()</a></code> and <code><a class="el" href="event_8h.html#aa6e70166c6ac9e7e7399d1b140979d29" title="Return whether context switch monitoring is enabled.">spdk_framework_context_switch_monitor_enabled()</a></code>, respectively.</p>
<h2>ftl</h2>
<p>All NVMe dependencies were removed from ftl library. From now ftl library is using bdev_zone API. bdev_ftl becomes virtual bdev.</p>
<p><code>ctrlr</code> and <code>trid</code> fields in <code>spdk_ftl_dev_init_opts</code> structure were replaced by <code>base_bdev_desc</code>.</p>
<p><code>bdev_ftl_create</code> RPC method <code>trtype</code> and <code>traddr</code> parameters were replaced by <code>base_bdev</code> parameter.</p>
<p><code>spdk_ftl_module_init</code> and <code>spdk_ftl_module_fini</code> functions were removed.</p>
<p><code>spdk_ftl_punit_range</code> and <code>ftl_module_init_opts</code> structures were removed.</p>
<h2>isa-l</h2>
<p>Updated ISA-L submodule to commit f3993f5c0b6911 which includes implementation and optimization for aarch64.</p>
<p>Enabled ISA-L on aarch64 by default in addition to x86.</p>
<h2>nvme</h2>
<p><code>delayed_pcie_doorbell</code> parameter in <code><a class="el" href="structspdk__nvme__io__qpair__opts.html" title="NVMe I/O queue pair initialization options.">spdk_nvme_io_qpair_opts</a></code> was renamed to <code>delay_cmd_submit</code> to allow reuse in other transports.</p>
<p>Added RDMA WR batching to NVMf RDMA initiator. Send and receive WRs are chained together and posted with a single call to ibv_post_send(receive) in the next call to qpair completion processing function. Batching is controlled by 'delay_cmd_submit' qpair option.</p>
<p>The NVMe-oF initiator now supports plugging out of tree NVMe-oF transports. In order to facilitate this feature, several small API changes have been made:</p>
<p>The <code><a class="el" href="structspdk__nvme__transport__id.html" title="NVMe transport identifier.">spdk_nvme_transport_id</a></code> struct now contains a trstring member used to identify the transport. A new function, <code>spdk_nvme_transport_available_by_name</code>, has been added. A function table, <code><a class="el" href="structspdk__nvme__transport__ops.html">spdk_nvme_transport_ops</a></code>, and macro, <code>SPDK_NVME_TRANSPORT_REGISTER</code>, have been added which enable registering out of tree transports.</p>
<p>A new function, <code>spdk_nvme_ns_supports_compare</code>, allows a user to check whether a given namespace supports the compare operation.</p>
<p>A new family of functions, <code>spdk_nvme_ns_compare*</code>, give the user access to submitting compare commands to NVMe namespaces.</p>
<p>A new function, <code>spdk_nvme_ctrlr_cmd_get_log_page_ext</code>, gives users more granular control over the command dwords sent in log page requests.</p>
<h2>nvmf</h2>
<p>Add SockPriority option in [Transport] section, this can be used for NVMe-oF target on TCP transport to set sock priority for the incoming TCP connections.</p>
<p>The NVMe-oF target now supports plugging out of tree NVMe-oF transports. In order to facilitate this feature, several small API changes have been made:</p>
<p>The <code><a class="el" href="structspdk__nvme__transport__id.html" title="NVMe transport identifier.">spdk_nvme_transport_id</a></code> struct now contains a trstring member used to identify the transport. <code>spdk_nvmf_tgt_get_transport</code>, <code>spdk_nvmf_transport_opts_init</code>, and <code>spdk_nvmf_transport_create</code> all have been modified to take a string. A function table, <code><a class="el" href="structspdk__nvmf__transport__ops.html">spdk_nvmf_transport_ops</a></code>, and macro, <code>SPDK_NVMF_TRANSPORT_REGISTER</code>, have been added which enable registering out of tree transports.</p>
<p>Add <code><a class="el" href="nvmf_8h.html#ac796e8f25381f344119ef0f44c2a017c" title="Stop accepting new connections at the provided address.">spdk_nvmf_tgt_stop_listen()</a></code> that can be used to stop listening for incoming connections for specified target and trid. Listener is not stopped implicitly upon destruction of a subsystem any more.</p>
<p>A custom NVMe admin command handler has been added which allows the user to use the real drive attributes from one of the target NVMe drives when reporting drive attributes to the initiator. This handler can be enabled via the <code>nvmf_set_config</code> RPC. Note: In a future version of SPDK, this handler will be enabled by default.</p>
<p>The SPDK target and initiator both now include compare-and-write functionality with one caveat. If using the RDMA transport, the target expects the initiator to send both the compare command and write command either with, or without inline data. The SPDK initiator currently respects this requirement, but this note is included as a flag for other initiators attempting compatibility with this version of SPDK.</p>
<p>The <code><a class="el" href="structspdk__nvme__ctrlr__opts.html" title="NVMe controller initialization options.">spdk_nvme_ctrlr_opts</a></code> struct has been extended with new field <code>transport_ack_timeout</code> which allows to configure transport ACK timeout. Applicable for RDMA transport only.</p>
<h2>rpc</h2>
<p>A new RPC, <code>bdev_zone_block_create</code>, enables creating an emulated zoned bdev on top of a standard block device.</p>
<p>A new RPC, <code>bdev_ocssd_create</code>, enables creating an emulated zoned bdev on top of an Open Channel SSD.</p>
<p>A new RPC, <code>blobfs_set_cache_size</code>, enables managing blobfs cache size.</p>
<p>A new RPC, <code>env_dpdk_get_mem_stats</code>, has been added to facilitate reading DPDK related memory consumption stats. Please see the env_dpdk section above for more details.</p>
<p>A new RPC, <code>framework_get_reactors</code>, has been added to retrieve a list of all reactors.</p>
<p><code>bdev_ftl_create</code> now takes a <code>base_bdev</code> argument in lieu of <code>trtype</code>, <code>traddr</code>, and <code>punits</code>.</p>
<p><code>bdev_nvme_set_options</code> now allows users to disable I/O submission batching with the <code>-d</code> flag</p>
<p><code>bdev_nvme_cuse_register</code> now accepts a <code>name</code> parameter.</p>
<p><code>bdev_uring_create</code> now takes arguments for <code>bdev_name</code> and <code>block_size</code></p>
<p><code>nvmf_set_config</code> now takes an argument to enable passthru of identify commands to base NVMe devices. Please see the nvmf section above for more details.</p>
<h2>scsi</h2>
<p><code>spdk_scsi_lun_get_dif_ctx</code> now takes an additional argument of type <code><a class="el" href="structspdk__scsi__task.html">spdk_scsi_task</a></code>.</p>
<h2>sock</h2>
<p>Added spdk_sock_writev_async for performing asynchronous writes to sockets. This call will never return EAGAIN, instead queueing internally until the data has all been sent. This can simplify many code flows that create pollers to continue attempting to flush writes on sockets.</p>
<p>Added <code>impl_name</code> parameter in spdk_sock_listen and spdk_sock_connect functions. Users may now specify the sock layer implementation they'd prefer to use. Valid implementations are currently "vpp" and "posix" and NULL, where NULL results in the previous behavior of the functions.</p>
<h2>thread</h2>
<p><code>spdk_thread_send_msg</code> now returns int indicating if the message was successfully sent.</p>
<p>A new function <code>spdk_thread_send_critical_msg</code>, has been added to support sending a single message from a context that may be interrupted, e.g. a signal handler.</p>
<p>Two new functions, <code>spdk_poller_pause</code>, and <code>spdk_poller_resume</code>, have been added to give greater control of pollers to the application owner.</p>
<h2>util</h2>
<p><code>spdk_pipe</code>, a new utility for buffering data from sockets or files for parsing has been added. The public API is available at <code><a class="el" href="pipe_8h.html" title="A pipe that is intended for buffering data between a source, such as a socket, and a sink,...">include/spdk/pipe.h</a></code>.</p>
<h2>bdev</h2>
<p>Added spdk_bdev_io_get_nvme_fused_status function for translating bdev_io status to NVMe status code for fused compare-and-write operation.</p>
<p>Added spdk_bdev_get_acwu function for getting block device atomic compare and write unit size.</p>
<h1><a class="anchor" id="changelog-v19-10"></a>
v19.10: Zoned bdev API, Opal bdev, NVMe character devices</h1>
<h2>rpc</h2>
<p>Many of SPDK's RPCs were renamed to be more consistent and intuitive in this release. The old names will continue to function, but will display a deprecation warning.</p>
<p>Added optional parameters '&ndash;arbitration-burst' and '&ndash;low/medium/high-priority-weight' to 'bdev_nvme_set_options' RPC method.</p>
<p>Added optional parameter '&ndash;md-size' to 'construct_null_bdev' RPC method.</p>
<p>Added optional parameters '&ndash;dif-type' and '&ndash;dif-is-head-of-md' to 'construct_null_bdev' RPC method.</p>
<p>Added <code>blobfs_detect</code> RPC method to detect whether a blobfs exists on given bdev.</p>
<p>Added <code>blobfs_create</code> RPC method to build blobfs on given bdev.</p>
<p>Added <code>blobfs_mount</code> RPC method to mount blobfs on given bdev to a host path by FUSE. Then on the host path, user can directly do some file operations which will be mapped to blobfs.</p>
<h2>bdev</h2>
<p>Added new parameter <code>cdw0</code> to <code><a class="el" href="bdev__module_8h.html#a3341d564a521b3e7874f72fc1390f043" title="Complete a bdev_io with an NVMe status code and DW0 completion queue entry.">spdk_bdev_io_complete_nvme_status()</a></code> and <code><a class="el" href="bdev_8h.html#ae7e1bf90f44f042c2b2ad463b8667735" title="Get the status of bdev_io as an NVMe status code and command specific completion queue value.">spdk_bdev_io_get_nvme_status()</a></code> that allows setting/getting the NVMe completion queue DW0 entry. This allows vendor specific IO commands to return command specific completion info back to the initiator.</p>
<p>Added <code><a class="el" href="bdev_8h.html#ab5775a23cadb2eb1d5381dc105577a37" title="Get the write unit size for this bdev.">spdk_bdev_get_write_unit_size()</a></code> function for retrieving required number of logical blocks for write operation.</p>
<p>New zone-related fields were added to the result of the <code>get_bdevs</code> RPC call:</p>
<ul>
<li><code>zoned</code>: indicates whether the device is zoned or a regular block device</li>
<li><code>zone_size</code>: number of blocks in a single zone</li>
<li><code>max_open_zones</code>: maximum number of open zones</li>
<li><code>optimal_open_zones</code>: optimal number of open zones</li>
</ul>
<p>The <code>zoned</code> field is a boolean and is always present, while the rest is only available for zoned bdevs.</p>
<p>A new <code>spdk_bdev_open_ext</code> function has been added and <code>spdk_bdev_open</code> function has been deprecated. The new open function introduces requirement to provide callback function that will be called by asynchronous event such as bdev removal. <code>spdk_bdev_open_ext</code> function takes bdev name as an argument instead of bdev structure to avoid a race condition that can happen when the bdev is being removed between a call to get its structure based on a name and actually opening it.</p>
<p>New 'resize' event has been added to notify about change of block count property of block device. Event is delivered only if block device was opened with <code>spdk_bdev_open_ext</code> function.</p>
<h2>bdev zone</h2>
<p>Added new public header for zoned bdev. Zoned bdev is an extension of the bdev interface.</p>
<p><code><a class="el" href="bdev__zone_8h.html#ad5e6fcc674d5ebe932e2b2dcaa28f9b5" title="Get device zone size in logical blocks.">spdk_bdev_get_zone_size()</a></code>, <code><a class="el" href="bdev__zone_8h.html#a7739e6335f06de1565e50d3afc247aa0" title="Get device maximum number of open zones.">spdk_bdev_get_max_open_zones()</a></code>, <code><a class="el" href="bdev__zone_8h.html#aa50981e9f75708e66f7174c96cf396f8" title="Get device optimal number of open zones.">spdk_bdev_get_optimal_open_zones()</a></code> APIs were added for retrieving zoned device information. <code><a class="el" href="group__bdev__io__submit__functions.html#ga01f2a4fd5da187f568381fa3c55f603c" title="Submit a get_zone_info request to the bdev.">spdk_bdev_get_zone_info()</a></code> API was added for retrieving information about zones in zoned device. Added <code><a class="el" href="group__bdev__io__submit__functions.html#ga9220b3c7c3f9591cfdfd73977ee69f91" title="Submit a zone_management request to the bdev.">spdk_bdev_zone_management()</a></code> API for changing zone state. <code><a class="el" href="group__bdev__io__submit__functions.html#ga17d6c2c7f25d21c5d2cdfb6e187e2033" title="Submit a zone_append request to the bdev.">spdk_bdev_zone_append()</a></code> and <code><a class="el" href="group__bdev__io__submit__functions.html#gab8a2fd5a40daa3d36c15b3f92c9a81a7" title="Submit a zone_append request with metadata to the bdev.">spdk_bdev_zone_append_with_md()</a></code> APIs were added for appending data to a zone. Added <code>spdk_bdev_io_get_append location()</code> function for retrieving append location for I/O. Added <code><a class="el" href="bdev_8h.html#a2e334778f2dfb469e2f96bcd42c6343b" title="Checks if bdev supports zoned namespace semantics.">spdk_bdev_is_zoned()</a></code> function for checking if bdev supports zoned namespace semantics.</p>
<h2>bdev opal</h2>
<p>EXPERIMENTAL: A new opal bdev has been added to support management of NVMe self-encrypting drives through the Opal specification. Users can create opal bdevs from an NVMe namespace bdev, if the controller containing that namespace supports Opal. Currently this is only supported for namespace ID=1. The following RPCs have been added to support Opal: <code>bdev_nvme_opal_init</code>, <code>bdev_nvme_opal_revert</code>, <code>bdev_opal_create</code>, <code>bdev_opal_delete</code>, <code>bdev_opal_get_info</code>, <code>bdev_opal_new_user</code>, <code>bdev_opal_set_lock_state</code>. It does not yet support recreating the opal bdevs after application restart. This bdev module should be considered very experimental, and the RPCs may change significantly in future releases.</p>
<h2>delay bdev</h2>
<p>The <code>bdev_delay_update_latency</code> has been added to allow users to update a latency value for a given delay bdev.</p>
<h2>compress bdev</h2>
<p>A new RPC <code>bdev_compress_get_orphans</code> has been added to list compress bdevs that were not loaded due to a missing pm metadata file. In this state they can only be deleted.</p>
<h2>null bdev</h2>
<p>Metadata support has been added to Null bdev module.</p>
<p>Protection information support has been added to Null bdev module.</p>
<h2>nvme</h2>
<p>Added <code>no_shn_notification</code> to NVMe controller initialization options, users can enable it for NVMe controllers. When the option is enabled, the controller will not do the shutdown process and just disable the controller, users can start their application later again to initialize the controller to the ready state.</p>
<p>A controller flag <code>SPDK_NVME_CTRLR_WRR_SUPPORTED</code> was added to indicate the controller can support weighted round robin arbitration feature with submission queue.</p>
<p>Added <code>arbitration_burst</code> option for arbitration feature, and added three <code>low/medium/high_priority_weight</code> options for weighted round robin arbitration.</p>
<p>Added <code>spdk_nvme_ns_cmd_write_uncorrectable</code>.</p>
<p>Added new error handling and reporting functionality. This includes several new API functions to facilitate applications recovering when a qpair or controller fails.</p>
<p><code>spdk_nvme_ctrlr_reconnect_io_qpair</code> - Reconnects a failed I/O qpair. <code>spdk_nvme_ctrlr_set_trid</code> - Sets the trid of an existing controller. Can be used to change the trid for failover cases. <code>spdk_nvme_ctrlr_is_failed</code> - Returns the failed state of a controller. <code>spdk_nvme_ctrlr_fail</code> - Forces a controller into a failed state.</p>
<p>Modified the return behavior of several API functions to better indicate to applications when a qpair is failed. This list of functions includes:</p>
<p><code>spdk_nvme_qpair_process_completions</code> <code>spdk_nvme_ns_cmd_*</code> <code>spdk_nvme_ctrlr_process_admin_completions</code> <code>spdk_nvme_ctrlr_cmd_*</code></p>
<p>These functions now return -ENXIO when the qpair or controller on which they operate is failed.</p>
<p>EXPERIMENTAL: Added NVMe character device support to allow to create NVMe device nodes in Linux kernel for controller as well as for namespace and process ioctl requests as usual from linux environment.</p>
<h2>nvmf</h2>
<p>The <code>spdk_nvmf_tgt_create</code> function now accepts an object of type <code><a class="el" href="structspdk__nvmf__target__opts.html">spdk_nvmf_target_opts</a></code> as its only parameter. This new structure contains the max_subsystems parameter previously passed into that function.</p>
<p>A new public API function <code>spdk_nvmf_get_tgt</code> has been added which allows users to retrieve a pointer to an <code>spdk_nvmf_tgt</code> object by supplying its name. In the special case where an RPC or application only creates a single target, this function can accept a null name parameter and will return the only available target.</p>
<p>The majority of the NVMe-oF RPCs now accept an optional tgt_name parameter. This will allow those RPCs to work with applications that create more than one target.</p>
<p>Three new NVMe-oF RPCs have been added <code>nvmf_create_target</code>, <code>nvmf_delete_target</code>, and <code>nvmf_get_targets</code>. These new RPCs provide a basic interface for managing multiple target objects. In SPDK the target object defines a unique discovery service. As of this release, these RPCs are not intended to be used with the in-tree SPDK target applications, spdk_tgt and nvmf_tgt, which use a single, global target structure. As such, they are not included in scripts/rpc.py</p>
<p>Three new header functions have also been added to help deal with multiple targets. <code>spdk_nvmf_tgt_get_name</code> takes a target pointer as an argument and returns its human readable name. <code>spdk_nvmf_get_first_target</code> takes no arguments and returns the first target in the global list. <code>spdk_nvmf_get_next_tgt</code> takes a target pointer as an argument and returns the next one in the global list.</p>
<p>The <code>spdk_nvmf_tgt_accept</code> takes additional argument allowing to pass arbitrary context information to the <code>new_qpair</code> callback. This will simplify the code when having multiple nvmf targets or when retrieving the context information from globals is not suitable.</p>
<h2>blobstore</h2>
<p>A new <code>spdk_bdev_create_bs_dev_from_desc</code> function has been added and <code>spdk_bdev_create_bs_dev</code> function has been deprecated. The new create function can cowork with <code>spdk_bdev_open_ext</code> function, which provides callback function that will be called by asynchronous event such as bdev removal.</p>
<h2>blobfs_bdev</h2>
<p>A new blobfs module <code>bdev</code> has been added to simplify the operations of blobfs on bdev.</p>
<p>Function <code>spdk_blobfs_bdev_detect</code> is added to detect whether blobfs exists on the given block device.</p>
<p>Function <code>spdk_blobfs_bdev_create</code> is added to create a blobfs on the given block device.</p>
<p>Function <code>spdk_blobfs_bdev_mount</code> is added to mount a blobfs on the given block device to a host path by FUSE. Then, a new thread is created dedicatedly for one mountpoint to handle FUSE request by blobfs API.</p>
<h2>build</h2>
<p>Option to build FUSE components into blobfs_bdev module for mounting a blobfs filesystem. It requires the installation of libfuse3. By default, it is disabled. And it will be enabled if run <code>./configure</code> with <code>--with-fuse</code> option.</p>
<h2>iSCSI</h2>
<p>Portals may no longer be associated with a cpumask. The scheduling of connections is moving to a more dynamic model.</p>
<p>An new RPC <code>iscsi_portal_group_set_auth</code> has been added to set CHAP authentication for discovery sessions specific for the existing iSCSI portal group. This RPC overwrites the setting by the global parameters for the iSCSI portal group.</p>
<h2>socket</h2>
<p>Added <code>spdk_sock_is_connected</code> to check whether the socket is currently connected. <code>spdk_sock_group_poll</code> now returns number of events on success.</p>
<h2>env</h2>
<p>Added <code><a class="el" href="env_8h.html#a53e5710a5ece84d2d821b91351892da4" title="Undo spdk_pci_device_claim().">spdk_pci_device_unclaim()</a></code> function to cleanup pci claim file.</p>
<h2>event</h2>
<p><code>framework_start_init</code> RPC no longer stops the application on error during initialization.</p>
<h2>DPDK</h2>
<p>Updated DPDK submodule to DPDK 19.08.</p>
<h2>ocf</h2>
<p>Updated OCF submodule to OCF v19.06</p>
<p>Along with update, new cache mode 'write only' was added.</p>
<p>New cache modes added to use via RPC, wi - write invalidate and wa - write around.</p>
<p>New version of OCF provides fully asynchronous management API.</p>
<h1><a class="anchor" id="changelog-v19-07"></a>
v19.07: NVMe-oF FC Transport, VMD, NVMe-oF Persistent reservations, Bdev I/O with separate metadata</h1>
<h2>ftl</h2>
<p>EXPERIMENTAL: Added ability to mirror writes to persistent write buffer cache to allow for recovery from dirty shutdown event.</p>
<p>Added handling of Asynchronous Nand Management Events (ANM).</p>
<h2>vmd</h2>
<p>EXPERIMENTAL: Added Intel Volume Management Device (VMD) driver. VMD is an integrated controller inside the CPU PCIe root complex. It enables virtual HBAs for the connected NVMe SSDs. <code><a class="el" href="vmd_8h.html#a8ab093f9cdad46a637fac6aa07739ace" title="Enumerate VMD devices and hook them into the spdk pci subsystem.">spdk_vmd_init()</a></code> enumerates NVMe SSDs behind VMD device and hook them into SPDK PCI subsystem. <code><a class="el" href="nvme_8h.html#a225bbc386ec518ae21bd5536f21db45d" title="Enumerate the bus indicated by the transport ID and attach the userspace NVMe driver to each device f...">spdk_nvme_probe()</a></code> or <code><a class="el" href="nvme_8h.html#ae26375a74c2c935ec32f0c41a7ed93df" title="Connect the NVMe driver to the device located at the given transport ID.">spdk_nvme_connect()</a></code> can be used to connect NVMe driver to the device located at the given transport ID.</p>
<p>To obtain transport ID of NVMe SSD behind VMD <code>spdk_lspci</code> can be used.</p>
<p>Current implementation does not support hotplug.</p>
<h2>blobfs</h2>
<p>Blobfs file asynchronous operations were added to public APIs.</p>
<h2>util</h2>
<p>A new file API <code>spdk_posix_file_load</code> was added to load file content into a data buffer.</p>
<p>New APIs <code>spdk_dif_ctx_set_data_offset</code>, <code>spdk_dif_verify_stream</code>, <code>spdk_dif_get_range_with_md</code>, <code>spdk_dif_get_length_with_md</code> have been added, and existing APIs <code>spdk_dif_ctx_init</code>, <code>spdk_dif_set_md_interleave_iovs</code>, and <code>spdk_dif_generate_stream</code> have been refined to insert or strip DIF into iovs windows of any alignment.</p>
<p>New APIs <code>spdk_dif_ctx_set_remapped_init_ref_tag</code>, <code>spdk_dif_remap_ref_tag</code>, and <code>spdk_dix_remap_ref_tag</code> have been added to remap DIF reference tag.</p>
<p>New APIs <code>spdk_dif_update_crc32c</code> and <code>spdk_dif_update_crc32c_stream</code> have been added to compute CRC-32C checksum for extended LBA payload.</p>
<p>Bdevperf and bdevio applications now support starting tests with application specific RPCs. Please see helper Python scripts in their respective directories. This is a move towards simpler RPC-only configuration for all main and auxiliary applications.</p>
<p>Legacy INI style configuration for SPDK applications will become deprecated in SPDK 19.10, and removed in SPDK 20.01. Please consider moving to JSON-RPC configuration files and/or RPC driven run-time configuration.</p>
<h2>nvmf</h2>
<p>EXPERIMENTAL: A Fibre Channel transport that supports Broadcom HBAs has been added. This depends on the FC HBA driver at <a href="https://github.com/ecdufcdrvr/bcmufctdrvr">https://github.com/ecdufcdrvr/bcmufctdrvr</a>. See <a href="https://spdk.io/doc/nvmf.html#nvmf_fc_transport">the documentation</a> for more information.</p>
<p>Persistent reservation emulation has been added to the NVMe-oF target. Persistent reservation state is stored in a JSON file on the local filesystem between target restart. To support this, an optional parameter to the RPC method <code>nvmf_subsystem_add_ns</code> called <code>--ptpl-file</code> was added. This allows the user to specify which file to store the persistent reservation state in. Note that this is done per namespace.</p>
<p>The c2h success optimization under which a command capsule response is not sent for reads is turned on by default. A config knob was added to allow disabling the optimization. This will mostly be used for integration testing with 5.0.x kernels while some compatibility fixes make their way down the pipeline for 5.1.x kernels.</p>
<p>The sock priority setting of the TCP connection owned by the tcp transport is added. It is used to optimize the TCP connection performance under designated traffic classes. And the priority is used to differentiate the sock priority between SPDK NVMe-oF TCP target application and other TCP based applications.</p>
<p>Shared receive queue can now be disabled even for NICs that support it using the <code>nvmf_create_transport</code> RPC method parameter <code>no_srq</code>. The actual use of a shared receive queue is predicated on hardware support when this flag is not used.</p>
<p>spdk_nvmf_get_optimal_poll_group was added, which is used to return the optimal poll group for the qpair. And <code>ConnectionScheduler</code> configuration is added into the [Nvmf] section in etc/spdk/nvmf.conf.in to demonstrate how to configure the connection scheduling strategy among different spdk threads.</p>
<p>Added infrastructure to retrieve global and per poll group NVMf statistics.</p>
<p>DIF strip and insert is now supported for TCP transport. When it is enabled, DIF setting is not exposed to the NVMe-oF initiator, and DIF is attached into data for write I/O and stripped from data for read I/O.</p>
<p>Added a field <code>dif_insert_or_strip</code> to struct <a class="el" href="structspdk__nvmf__transport__opts.html">spdk_nvmf_transport_opts</a>, and updated the related rpc function nvmf_create_transport to make this configurable parameter available to users. The <code>dif_insert_or_strip</code> is relevant for TCP transport for now and used to configure the DIF strip and insert.</p>
<p>Added infrastructure to retrieve NVMf transport statistics.</p>
<h2>notify</h2>
<p>The function <code>spdk_notify_get_types()</code> and <code>spdk_notify_get_events()</code> were renamed to <code>spdk_notify_foreach_type()</code> and <code>spdk_notify_foreach_event()</code>, respectively. And update type name of callback accordingly.</p>
<h2>bdev</h2>
<p>The format of the data returned by the get_bdevs_iostat RPC has changed to make it easier to parse. It now returns an object with a "ticks" object and "bdevs" array with the per-bdev statistics.</p>
<p>A new bdev module <code>delay</code> has been added which simulates a drive latency when placed on top of a Null bdev. This module is intended only for testing and can be created using the new RPC <code>bdev_delay_create</code>. That RPC takes the name of the underlying bdev as well as average and p99 latency arguments for both read and write operations. Average latency is defined as a value close to what you would expect a perf tool such as FIO to report back as the mean latency of all I/O submitted to the drive. p99 latency is defined as the value one would expect the drive to see the slowest 1% of I/O report. For underlying drives with already significant latency, the latency values provided to the drive will be additive. This should be taken into account if trying to achieve an artificial latency on top of an nvme drive or aio device.</p>
<p>DIF reference tag remapping is now supported for partition type virtual bdev modules. When using partition type virtual bdevs, block address space is remapped during I/O processing and DIF reference tag is remapped accordingly.</p>
<p>Added spdk_bdev_*_with_md() functions allowing for IO with metadata being transferred in separate buffer. To check support for separate metadata, use <a class="el" href="bdev_8h.html#ac8c880555f4d66991c1fd9dbd3abaf4f" title="Query whether metadata is interleaved with block data or separated from block data.">spdk_bdev_is_md_separate()</a>.</p>
<p>All bdevs now have a UUID. For devices whose backing hardware does not provide a UUID, one is automatically generated. Across runs of SPDK, bdevs whose UUID is automatically generated may change.</p>
<p>A new virtual bdev module <code>compress</code> has been added to provide compression services on top of a thinly provisioned logical volume. See documentation for complete details.</p>
<h2>nvme</h2>
<p>Added an optional parameter <code>--io-queue-requests</code> to RPC <code>set_bdev_nvme_options</code>, which can be used to change the number of requests allocated for one NVMe I/O queue. For very big I/O size, e.g. 128MiB, with this option user will not get an error due to limited requests in NVMe driver layer.</p>
<p>Added <a class="el" href="nvme_8h.html#abb7ae9abf97b7c6b57777d06eaa1258a" title="Get the transport ID for a given NVMe controller.">spdk_nvme_ctrlr_get_transport_id()</a> to get the transport ID from a previously attached controller.</p>
<p>Nvme Opal library spdk_opal_cmd deprecated. Adding separate command APIs. NVMe Opal library add support for activating locking SP which will make the transaction from "Manufactured-Inactive" state to "Manufactured" state. Upon successfully invoking of this method, lock and unlock features will be enabled. NVMe Opal library add support for locking/unlocking range and list locking range info. NVMe opal library add support for multiuser. Admin can enable user and add user to specific locking range and the user can lock/unlock his range.</p>
<p>Added <a class="el" href="nvme_8h.html#a8c00b191b38472b57b06f3f394353ad3" title="Send the given NVM I/O command, I/O buffers, lists and all to the NVMe controller.">spdk_nvme_ctrlr_io_cmd_raw_no_payload_build()</a> allowing a caller to pass a completely formed command to an NVMe submission queue (buffer addresses and all). This is supported on the PCIe transport only.</p>
<p>Added spdk_nvme_get_ctrlr_registers() to return a pointer to the virtual address of the NVMe controller registers. This is supported on the PCIe transport only.</p>
<p>Added additional options to the spdk_nvme_ctrlr_alloc_qpair() option parameter structure to allow caller to override the virtual and optionally physical address of the submission and completion queue pair to be created. This is supported on the PCIe transport only.</p>
<p>Added <code>disable_error_logging</code> to struct <a class="el" href="structspdk__nvme__ctrlr__opts.html" title="NVMe controller initialization options.">spdk_nvme_ctrlr_opts</a>, which disables logging of failed requests. By default logging is enabled.</p>
<p>Added <a class="el" href="nvme_8h.html#ac06275147a2cbb800440686b8ba9a73b" title="Prints (SPDK_NOTICELOG) the contents of an NVMe submission queue entry (command).">spdk_nvme_qpair_print_command()</a>, <a class="el" href="nvme_8h.html#ad4b2335194f9c4c24a5e2c15a9432f4a" title="Prints (SPDK_NOTICELOG) the contents of an NVMe completion queue entry.">spdk_nvme_qpair_print_completion()</a> and <a class="el" href="nvme_8h.html#a5f179ad680512c168148e13aa74b3f4b" title="Given NVMe status, return ASCII string for that error.">spdk_nvme_cpl_get_status_string()</a>. Allowing for easier display of error messages.</p>
<p>Added support for NVMe Sanitize command.</p>
<h2>env</h2>
<p>The parameter <code>free_space</code> has been added to <a class="el" href="env_8h.html#a96a046de83d31127e79a7b16760b4776" title="Queue the array of objects (with length count) on the ring.">spdk_ring_enqueue()</a> to wait when the ring is almost full and resume when there is enough space available in the ring.</p>
<p>A new API <code>spdk_mempool_lookup</code> has been added to lookup the memory pool created by the primary process.</p>
<p>Added spdk_pci_get_first_device() and spdk_pci_get_next_device() to allow iterating over PCI devices detected by SPDK. Because of this, all SPDK APIs to attach/detach PCI devices are no longer thread safe. They are now meant to be called from only a single thread only, the same only that called <a class="el" href="env_8h.html#a402ca8ae67be57c2c258a7a2bf22cfec" title="Initialize or reinitialize the environment library.">spdk_env_init()</a>. This applies to the newly added APIs as well.</p>
<h2>vpp</h2>
<p>SPDK now supports VPP version 19.04.2, up from VPP 18.01.</p>
<p>VPP socket abstraction now uses VPP Session API, instead of VLC (VPP Communications Library). This allows for better control over sessions and queues. Please see VPP documentation for more details: <a href="https://wiki.fd.io/view/VPP/HostStack">VPP Host Stack</a></p>
<h2>sock</h2>
<p>Add <a class="el" href="sock_8h.html#ad24c07b476251c95ed574ce3f61a2faa" title="Get the optimal sock group for this sock.">spdk_sock_get_optimal_sock_group()</a>, which returns the optimal sock group for this socket. When a socket is created, it is often assigned to a sock group using spdk_sock_group_add_sock so that a set of sockets can be polled more efficiently. For some network devices, it is optimal to assign particular sockets to specific sock groups. This API is intended to provide the user with that information.</p>
<p><a class="el" href="sock_8h.html#ae60bf2833f9b9bd99088c1c0929d6321" title="Get the ctx of the sock group.">spdk_sock_group_get_ctx()</a> was added to return the context of the spdk_sock_group. <a class="el" href="sock_8h.html#a06f3441fbe7ea447b7ae03e71e074e27" title="Create a new socket group with user provided pointer.">spdk_sock_group_create()</a> is updated to allow input the user provided ctx. spdk_sock_set_priority() is added to set the priority of the socket.</p>
<h2>rpc</h2>
<p>Added thread_get_stats RPC method to retrieve existing statistics.</p>
<p>Added nvmf_get_stats RPC method to retrieve NVMf subsystem statistics.</p>
<p>Response buffers for RPC requests are now always pre-allocated, which implies that all <a class="el" href="jsonrpc_8h.html#a22757fb7d0f34984e29b3fe311dfed01" title="Begin building a response to a JSON-RPC request.">spdk_jsonrpc_begin_result()</a> calls always succeed and return a valid buffer for JSON response. RPC calls no longer need to check if the buffer is non-NULL.</p>
<p>Added SPDK_RPC_REGISTER_ALIAS_DEPRECATED to help with deprecation process when renaming existing RPC. First time a deprecated alias is used, it will print a warning message.</p>
<p>RPC <code>get_rpc_methods</code> was renamed <code>rpc_get_methods</code>. The old name is still usable, but is now deprecated.</p>
<h2>blobstore</h2>
<p>A snapshot can now be deleted if there is only a single clone on top of it.</p>
<h2>build</h2>
<p>Preliminary support for cross compilation is now available. Targeting an older CPU on the same architecture using your native compiler can be accomplished by using the <code>--target-arch</code> option to <code>configure</code> as follows:</p>
<div class="fragment"><div class="line">./configure --target-arch=broadwell</div>
</div><!-- fragment --><p>Additionally, some support for cross-compiling to other architectures has been added via the <code>--cross-prefix</code> argument to <code>configure</code>. To cross-compile, set CC and CXX to the cross compilers, then run configure as follows:</p>
<div class="fragment"><div class="line">./configure --target-arch=aarm64 --cross-prefix=aarch64-linux-gnu</div>
</div><!-- fragment --><h2>vhost</h2>
<p>A security vulnerability has been identified and fixed in SPDK Vhost-SCSI target. A malicious client (e.g. a virtual machine) could send a carefully prepared, invalid I/O request to crash the entire SPDK process. All users of SPDK Vhost-SCSI target are strongly recommended to update. All SPDK versions &lt; 19.07 are affected.</p>
<p>By default, SPDK will now rely on upstream DPDK's rte_vhost instead of its fork located inside SPDK repo. The internal fork is still kept around to support older DPDK versions, but is considered legacy and will be eventually removed.</p>
<p><code>configure</code> will now automatically use the upstream rte_vhost if the used DPDK version is &gt;= 19.05.</p>
<p>spdk_vhost_init() is now asynchronous and accepts a completion callback.</p>
<h2>iscsi target</h2>
<p>A security vulnerability has been identified and fixed in SPDK iSCSI target. A malicious client (e.g. an iSCSI initiator) could send a carefully prepared, invalid I/O request to crash the entire SPDK process. All users of SPDK iSCSI target are strongly recommended to update. All SPDK versions &lt; 19.07 are affected.</p>
<h2>thread</h2>
<p>Exposed <a class="el" href="thread_8h.html#a60dac2a0fc19b23be6fecb1e5b6f8a7a" title="Force the current system thread to act as if executing the given SPDK thread.">spdk_set_thread()</a> in order for applications to associate with SPDK thread when necessary.</p>
<p>Added <a class="el" href="thread_8h.html#a10aa5a8ec5228fa87db97f7655f8c0d6" title="Destroy a thread, releasing all of its resources.">spdk_thread_destroy()</a> to allow framework polling the thread to release resources associated with that thread.</p>
<h1><a class="anchor" id="changelog-v19-04"></a>
v19.04: Compression bdev, Notification library, NVMe Opal support</h1>
<h2>nvme</h2>
<p>Added asynchronous probe support. New APIs <a class="el" href="nvme_8h.html#a02411bf7ae4827a350711e688316997e" title="Probe and add controllers to the probe context list.">spdk_nvme_probe_async()</a>, <a class="el" href="nvme_8h.html#ae8a8762934973d124cbad92fce47a351" title="Connect the NVMe driver to the device located at the given transport ID.">spdk_nvme_connect_async()</a> and <a class="el" href="nvme_8h.html#aedea919a47bdd811b604656e29e3fcef" title="Proceed with attaching controllers associated with the probe context.">spdk_nvme_probe_poll_async()</a> were added to enable this feature. <a class="el" href="nvme_8h.html#a02411bf7ae4827a350711e688316997e" title="Probe and add controllers to the probe context list.">spdk_nvme_probe_async()</a> and <a class="el" href="nvme_8h.html#ae8a8762934973d124cbad92fce47a351" title="Connect the NVMe driver to the device located at the given transport ID.">spdk_nvme_connect_async()</a> return a context associated with the specified controllers. Users then call <a class="el" href="nvme_8h.html#aedea919a47bdd811b604656e29e3fcef" title="Proceed with attaching controllers associated with the probe context.">spdk_nvme_probe_poll_async()</a> until it returns 0, indicating that the operation completed.</p>
<p>A new qpair creation option, delay_pcie_doorbell, was added. This can be passed to spdk_nvme_alloc_io_qpair(). This makes the I/O submission functions, such as spdk_nvme_ns_writev(), skip ringing the submission queue doorbell. Instead the doorbell will be rung as necessary inside <a class="el" href="nvme_8h.html#aa331d140870e977722bfbb6826524782" title="Process any outstanding completions for I/O submitted on a queue pair.">spdk_nvme_qpair_process_completions()</a>. This can result in significantly fewer MMIO writes to the doorbell register under heavy load, greatly improving performance.</p>
<p><a class="el" href="nvme_8h.html#a260b335960b9d81ac1a2601b003b99cd" title="Get the NVMe controller CMBSZ (Controller Memory Buffer Size) register.">spdk_nvme_ctrlr_get_regs_cmbsz()</a> was added to report the size of the controller memory buffer, if available.</p>
<p><a class="el" href="nvme_8h.html#af654a7a016511f265b29294fd06ce26e" title="Get supported flags of the controller.">spdk_nvme_ctrlr_get_flags()</a> was added to return controller feature flags. Two flags are currently tracked: SPDK_NVME_CTRLR_SGL_SUPPORTED SPDK_NVME_CTRLR_SECURITY_SEND_RECV_SUPPORTED</p>
<p>The NVMe hotplug poller is now able to detach devices hot-removed from the system via <code>/sys/bus/pci/devices/&lt;bdf&gt;/remove</code> and <code>/sys/bus/pci/devices/&lt;bdf&gt;/driver/unbind</code>.</p>
<p>Opal support was added for scan, take ownership, revert TPer, and dumping device info. The nvme_manage tool can be used to perform these operations. The public API functions are <a class="el" href="nvme_8h.html#a5175d6805225d84d6e4aa4e0f1546c69" title="Receive security protocol data from controller.">spdk_nvme_ctrlr_security_receive()</a> and <a class="el" href="nvme_8h.html#ada4ab089f73f3f43e9c5b8e6415e6f50" title="Send security protocol data to controller.">spdk_nvme_ctrlr_security_send()</a>. This module should be considered experimental pending additional features and tests.</p>
<p>The NVMe-oF initiator is now able to transfer IO whose size is more than 128KiB if the corresponding NVMe-oF target allows.</p>
<h2>raid</h2>
<p>Added new strip_size_kb rpc param on create to replace the more ambiguous strip_size. The strip_size rpc param is deprecated.</p>
<p>Changed the raid bdev product_name from "Pooled Device" to "Raid Volume"</p>
<h2>thread</h2>
<p>Added <a class="el" href="thread_8h.html#a9f877dd192ccdd30572941aa4e453c48" title="Returns whether there are any pollers registered to be run on the thread.">spdk_thread_has_pollers()</a> function to verify if there are any registered pollers to be run on the thread. Added <a class="el" href="thread_8h.html#adc45e09bda68d13cfc0ae010738cd658" title="Returns whether there are scheduled operations to be run on the thread.">spdk_thread_is_idle()</a> function to check if there are any scheduled operations to be performed on the thread at given time.</p>
<p><a class="el" href="thread_8h.html#a49abb69cad49e5f35363d9b8ee990ae2" title="Creates a new SPDK thread object.">spdk_thread_create()</a> now takes an optional CPU affinity mask that is passed to the scheduler.</p>
<p><a class="el" href="thread_8h.html#a96c6e1cadb3b5a83c5723487e3f02c23" title="Initialize the threading library.">spdk_thread_lib_init()</a> now takes an optional context size. For each thread created, an additional region of memory of this size will be allocated. A pointer to this region of memory can be obtained by calling <a class="el" href="thread_8h.html#a1deb97a85a8240119cf46fa8a0b71388" title="Return a pointer to this thread&#39;s context.">spdk_thread_get_ctx()</a>. The inverse operation is also available via <a class="el" href="thread_8h.html#af813fe52c71ec5e254f8671570f57bdc" title="Return the thread object associated with the context handle previously obtained by calling spdk_threa...">spdk_thread_get_from_ctx()</a>.</p>
<p><a class="el" href="thread_8h.html#ad9e3693e8e9e6c9063ea36414294ae91" title="Perform one iteration worth of processing on the thread.">spdk_thread_poll()</a> now optionally accepts the current time, in ticks. This can be used to avoid some calls to <a class="el" href="env_8h.html#a7d868d272aa0c000f6135966dfadc596" title="Get a monotonic timestamp counter.">spdk_get_ticks()</a> internally.</p>
<p><a class="el" href="event_8h.html#a3901d9ed6c234d92296db9ec9252a0f5" title="Start the framework.">spdk_app_start()</a> now only accepts a single context argument.</p>
<h2>bdev</h2>
<p>An new API <code>spdk_bdev_get_data_block_size</code> has been added to get size of data block except for metadata.</p>
<p>spdk_vbdev_register() has been deprecated. <a class="el" href="bdev__module_8h.html#a5fef71f7761986298bb4aaf345736bb3" title="Register a new bdev.">spdk_bdev_register()</a> should be used instead.</p>
<p>A mechanism for acquiring and releasing data buffers from bdev modules, used to perform zero copy operations, was added.</p>
<p>New APIs <a class="el" href="bdev_8h.html#abc3537d0315100b24da6acc95929e849" title="Get block device metadata size.">spdk_bdev_get_md_size()</a>, <a class="el" href="bdev_8h.html#aa02f628c6ef7cae08b8b623b4800c74d" title="Query whether metadata is interleaved with block data or separated with block data.">spdk_bdev_is_md_interleaved()</a>, <a class="el" href="bdev_8h.html#ac94b5900766ec42da5fc3658a5749858" title="Get DIF type of the block device.">spdk_bdev_get_dif_type()</a>, <a class="el" href="bdev_8h.html#a4e43a19692e14e5e46b3315e4cf0bc1d" title="Check whether DIF is set in the first 8/16 bytes or the last 8/16 bytes of metadata.">spdk_bdev_is_dif_head_of_md()</a>, and <a class="el" href="bdev_8h.html#a147389751cd351d30703e28f522e9610" title="Check whether the DIF check type is enabled.">spdk_bdev_is_dif_check_enabled()</a> have been added to get metadata and DIF settings.</p>
<p>Bdevs claimed by the <code>examine_config</code> callback will be now further examined in the <code>examine_disk</code> callback.</p>
<p><a class="el" href="bdev__module_8h.html#a65de686e7ddcf8caa6d7fa032e7023c6" title="Get the bdev module&#39;s I/O channel that the given bdev_io was submitted on.">spdk_bdev_io_get_io_channel()</a> was added as a convenient way to get an io_channel from a bdev_io.</p>
<h2>ocf</h2>
<p>Updated OCF submodule to OCF v19.3.2</p>
<p>Added support for many-to-one configuration for OCF bdev. Multiple core devices can now be cached on single cache device.</p>
<p>Added persistent metadata support, allowing to restore cache state after shutdown. During start of SPDK application, the devices are examined and if OCF metadata is present - appropriate OCF bdevs will be recreated.</p>
<p>Added Write-Back mode support. In this mode, data is first written to caching device and periodically synchronized to the core devices. Dirty data is saved as persistent metadata on cache device, allowing for safe restore during application restart. For more details please see OCF documentation: <a href="https://open-cas.github.io/cache_configuration.html">OpenCAS cache configuration</a></p>
<h2>NVMe-oF Target</h2>
<p>Support for per-device shared receive queues in the RDMA transport has been added. It is enabled by default for any device that supports it.</p>
<p>The size of a shared receive queue is defined by transport configuration file parameter <code>MaxSRQDepth</code> and <code>nvmf_create_transport</code> RPC method parameter <code>max_srq_depth</code>. Default size is 4096.</p>
<p>Add model number as parameter to construct_nvmf_subsystem (-d option), rather than using hardcoded define.</p>
<p>DIF passthrough feature has been added. DIF setting of the allocated bdevs is exposed to the NVMe-oF initiator and data with DIF from the NVMe-oF initiator is passed through to the allocated bdevs.</p>
<h2>env</h2>
<p>The <code>phys_addr</code> parameter in <a class="el" href="env_8h.html#a54dee7b759c26ff2a7e1789ddb59f214" title="Allocate dma/sharable memory based on a given dma_flg.">spdk_malloc()</a> and <a class="el" href="env_8h.html#a3ccd5c242af65c41dbe49ae2d903b5e4" title="Allocate dma/sharable memory based on a given dma_flg.">spdk_zmalloc()</a> has been deprecated. For retrieving physical addresses, <a class="el" href="env_8h.html#ae73d54bd295c1d46aa9a45df17e6aa40" title="Get the physical address of a buffer.">spdk_vtophys()</a> should be used instead.</p>
<p><a class="el" href="env_8h.html#acbf96e1e440b86ba23728e226b0745c6" title="Resize a dma/sharable memory buffer with the given new size and alignment.">spdk_realloc()</a> has been added to reallocate DMA/shared memory.</p>
<p><a class="el" href="env_8h.html#aa81297d98a464efeea8b33cee11f35dc" title="Check if device was requested to be removed from the process.">spdk_pci_device_is_removed()</a> has been added to let the upper-layer SPDK drivers know that device has a pending external hotremove request.</p>
<p><a class="el" href="env_8h.html#a719b5099cc3aa62190a1f44642ba6f91" title="Release any resources of the environment library that were allocated with spdk_env_init().">spdk_env_fini()</a> and <a class="el" href="env__dpdk_8h.html#aff24042058543bcee5a8a7ba0cd6b226" title="Release any resources of the environment library that were allocated with spdk_env_dpdk_post_init().">spdk_env_dpdk_post_fini()</a> were added to release any resources allocated by <a class="el" href="env_8h.html#a402ca8ae67be57c2c258a7a2bf22cfec" title="Initialize or reinitialize the environment library.">spdk_env_init()</a> or <a class="el" href="env__dpdk_8h.html#a160eba905ced9b233b67336651c954c7" title="Initialize the environment library after DPDK env is already initialized.">spdk_env_dpdk_post_init()</a> respectively. It is expected that common usage of those functions is to call them just before terminating the process.</p>
<p>Added <a class="el" href="env_8h.html#ab7e36d9cc7a1aa8ae701bec368502273" title="Reports whether the SPDK application is using the IOMMU for DMA.">spdk_iommu_is_enabled()</a> to report if SPDK application is using IOMMU for DMA.</p>
<h2>DPDK</h2>
<p>Dropped support for DPDK 17.07 and earlier, which SPDK won't even compile with right now.</p>
<p>Updated DPDK submodule to DPDK 19.02.</p>
<h2>rpc</h2>
<p>New <code>get_spdk_version</code> RPC method is introduced to get version info of the running SPDK application.</p>
<p>The <code>start_nbd_disk</code> RPC method now take nbd_device as an optional parameter. If nbd_device is specified, use that specified nbd device. If it's not specified, pick available one.</p>
<h2>iSCSI target</h2>
<p>DIF strip and insert is now supported. DIF settings are not exposed to the iSCSI initiator. DIF is attached into data for write I/O and stripped from data for read I/O.</p>
<h2>vhost</h2>
<p>Added experimental support for running with the external, upstream rte_vhost library. This can be enabled by configuring SPDK with an <code>--without-internal-vhost-lib</code> flag. The minimum supported rte_vhost version (DPDK version) is 19.05-rc1.</p>
<p>As a result of fuzz testing, a lot of data races in vhost-scsi LUN hotplug path were identified and fixed. Those data races could have potentially resulted in SPDK crashes, RPC hangs, or memory leaks if Vhost-SCSI LUN hotplug RPCs were executed while connected VMs were in the middle of restarting.</p>
<p>The SCSI target id in <code>add_vhost_scsi_lun</code> RPC is now optional. If <code>-1</code> is passed, the first unoccupied target id will be used.</p>
<h2>AIO</h2>
<p>AIO bdev module can now reap I/O completions directly from userspace, significantly improving the overall performance.</p>
<h2>blobfs</h2>
<p>Synchronous IO operations no longer use spdk_io_channel, but instead use spdk_fs_thread_ctx. The behavior is otherwise identical.</p>
<h2>OCF</h2>
<p>Added support for caching multiple bdevs using a single bdev as a cache.</p>
<h2>notify</h2>
<p>Added the notify library that provides a high performance local event bus between libraries. Example usage was added to bdev module, which reports notifications for added and removed bdevs via RPC.</p>
<h2>sock</h2>
<p>Added new API <a class="el" href="sock_8h.html#aec412e1537891ed4a02c24615df619b0" title="Read message from the given socket to the I/O vector array.">spdk_sock_readv()</a> to the sock library for performing vectored reads.</p>
<h2>event</h2>
<p>The function <a class="el" href="init_8h.html#aa0d0a3b14e1b3dbbfdc5868167099ef1" title="Begin the initialization process for all SPDK subsystems.">spdk_subsystem_init()</a> no longer requires spdk_event as an argument.</p>
<p>Changed API of spdk_subsystem_config_json() to no longer be asynchronous.</p>
<h2>io_uring</h2>
<p>A bdev module that issues I/O to kernel block devices using the new io_uring Linux kernel API was added. This module requires liburing.</p>
<h2>build</h2>
<p>Options to easily compile with profile guided optimization have been added to <code>configure</code>. To use profile guided optimization with SPDK, run <code>./configure --with-pgo-capture</code>, build SPDK, then run a workload of your choosing. Then, simply run <code>./configure --with-pgo-enable</code> and recompile to build using the generated profile data. Profile guided optimization can yield very large performance improvements, especially on GCC 8 and clang 7. This may be combined with link time optimization which has been available under the <code>--enable-lto</code> configure option for several releases.</p>
<h2>compression bdev/reduce library</h2>
<p>Added "reduce" block compression scheme based on using SSDs for storing compressed blocks of storage and persistent memory for metadata. Please see <a href="https://spdk.io/doc/bdev.html">compression</a> for more details.</p>
<h1><a class="anchor" id="changelog-v19-01"></a>
v19.01: NVMe-oF TCP/IP Transport, Open Channel SSD Flash Translation Layer, Caching bdev based on OCF, ISA-L Support, DIF/DIX library</h1>
<h2>ocf bdev</h2>
<p>New virtual bdev module based on <a href="https://open-cas.github.io/">Open CAS Framework</a> has been added. This module allows for the use of one bdev to act as a high performance cache in front of another bdev. Please see <a href="https://spdk.io/doc/bdev.html#bdev_config_cas">documentation</a> for more details. Only write through mode is currently supported and this feature is considered experimental.</p>
<h2>event framework</h2>
<p>For <code>spdk_app_parse_args</code>, add return value to the callback which parses application specific command line parameters to protect SPDK applications from crashing by invalid values from user input.</p>
<p>By default, all SPDK applications will now reserve all hugepages at runtime. The pre-reserved memory size can be still set with <code>-s</code> or <code>--mem-size</code> option, although the default value was reduced down to 0.</p>
<p>A custom hugetlbfs directory can now be specified via <a class="el" href="structspdk__app__opts.html" title="Event framework initialization options.">spdk_app_opts</a>. This can be used to configure hugepages with different sizes, a different size limit, or different access permissions than the system's default hugepage pool. SPDK applications can specify a custom hugetlbfs mount with the <code>--huge-dir</code> option.</p>
<h2>environment</h2>
<p><a class="el" href="env_8h.html#ae73d54bd295c1d46aa9a45df17e6aa40" title="Get the physical address of a buffer.">spdk_vtophys()</a> has been refactored to accept length of the translated region as a new parameter. The function will now update that parameter with the largest possible value for which the memory is contiguous in the physical memory address space.</p>
<p>The following functions were removed:</p>
<ul>
<li>spdk_pci_nvme_device_attach()</li>
<li>spdk_pci_nvme_enumerate()</li>
<li>spdk_pci_ioat_device_attach()</li>
<li>spdk_pci_ioat_enumerate()</li>
<li>spdk_pci_virtio_device_attach()</li>
<li>spdk_pci_virtio_enumerate()</li>
</ul>
<p>They were replaced with generic <a class="el" href="env_8h.html#ac6aa2606617cc3913fd5d6b7d218eba4" title="Attach a PCI device.">spdk_pci_device_attach()</a> and <a class="el" href="env_8h.html#a8e2430eaebf3d756c8608aea6957b614" title="Enumerate all PCI devices supported by the provided driver and try to attach those that weren&#39;t attac...">spdk_pci_enumerate()</a> which require a new spdk_pci_driver object to be provided. It can be one of the following:</p>
<ul>
<li><a class="el" href="env_8h.html#aa4a5c3c4f51c1eaac132f6093fe219f4" title="Get the NVMe PCI driver object.">spdk_pci_nvme_get_driver()</a></li>
<li><a class="el" href="env_8h.html#ad9d208ba1e19b37b76bb993c358b5760" title="Get the I/OAT PCI driver object.">spdk_pci_ioat_get_driver()</a></li>
<li><a class="el" href="env_8h.html#ac7fabe1b4dba0227ab07e5bd91fe8816" title="Get the Virtio PCI driver object.">spdk_pci_virtio_get_driver()</a></li>
</ul>
<p><a class="el" href="env_8h.html#a4ed436524e4df7525045e488206aa648" title="Hook a custom PCI device into the PCI layer.">spdk_pci_hook_device()</a> and <a class="el" href="env_8h.html#ac6cda84fe7f3ca98ee13683207ffeca5" title="Un-hook a custom PCI device from the PCI layer.">spdk_pci_unhook_device()</a> were added. Those allow adding a virtual <a class="el" href="structspdk__pci__device.html">spdk_pci_device</a> into the SPDK PCI subsystem. A virtual device calls provided callbacks for each BAR mapping request or PCI config access. It's attachable with <a class="el" href="env_8h.html#ac6aa2606617cc3913fd5d6b7d218eba4" title="Attach a PCI device.">spdk_pci_device_attach()</a> or <a class="el" href="env_8h.html#a8e2430eaebf3d756c8608aea6957b614" title="Enumerate all PCI devices supported by the provided driver and try to attach those that weren&#39;t attac...">spdk_pci_enumerate()</a> like any other device.</p>
<p>A new <a class="el" href="env_8h.html#a83b4804441c4333e414ebd3d508d91fa" title="Pause CPU execution for a short while.">spdk_pause()</a> function was added to pause CPU execution for an implementation specific amount of time. Quoting from DPDK function this is based on: "This call is intended for tight loops which poll a shared resource or wait for an event. A short pause within the loop may reduce the power consumption."</p>
<p>A new public header file <a class="el" href="env__dpdk_8h.html" title="Encapsulated DPDK specific dependencies.">env_dpdk.h</a> has been introduced, and function spdk_env_dpdk_post_init is added into it. If user is using DPDK, and already called rte_eal_init, then include <a class="el" href="env__dpdk_8h.html" title="Encapsulated DPDK specific dependencies.">include/spdk/env_dpdk.h</a>, and call <a class="el" href="env__dpdk_8h.html#a160eba905ced9b233b67336651c954c7" title="Initialize the environment library after DPDK env is already initialized.">spdk_env_dpdk_post_init()</a> instead of spdk_env_init.</p>
<p>ISA-L has been added as an SPDK submodule. ISA-L is enabled by default on x86 architecture to accelerate algorithms such as CRC for iSCSI and NVMe-oF. Users may still disable ISA-L by explicitly passing &ndash;without-isal to the configure script.</p>
<h2>util</h2>
<p>A new uuid API <code>spdk_uuid_copy</code> was added to make a copy of the source uuid.</p>
<p>An new parameter <code>init_crc</code> representing the initial CRC value was added to <code>spdk_crc16_t10dif</code>. The parameter can be used to calculate a CRC value spanning multiple separate buffers.</p>
<p>New DIF APIs were added to generate and verify DIF by byte granularity for both DIF and DIX formats. Among them, DIF with copy APIs will be usable to emulate DIF operations such as DIF insert and strip.</p>
<p>Added <code>spdk_strtol</code> and <code>spdk_strtoll</code> to provide additional error checking around <code>strtol</code> and <code>strtoll</code>.</p>
<p>Added <code>spdk_sprintf_append_realloc</code> and <code>spdk_vsprintf_append_realloc</code> for appending a string with automatic buffer re-allocation.</p>
<h2>nvme</h2>
<p>Wrapper functions <a class="el" href="nvme_8h.html#ada4ab089f73f3f43e9c5b8e6415e6f50" title="Send security protocol data to controller.">spdk_nvme_ctrlr_security_send()</a> and <a class="el" href="nvme_8h.html#a5175d6805225d84d6e4aa4e0f1546c69" title="Receive security protocol data from controller.">spdk_nvme_ctrlr_security_receive()</a> are introduced to support further security protocol development.</p>
<p>admin_timeout_ms was added to NVMe controller initialization options, users can change the default value when probing a controller.</p>
<p>Add two new fields "header_digest" and "data_digest" in struct <a class="el" href="structspdk__nvme__ctrlr__opts.html" title="NVMe controller initialization options.">spdk_nvme_ctrlr_opts</a>, it will be used to enable the digest support for the NVMe/TCP transport.</p>
<p>Add a new TCP/IP transport(located in lib/nvme/nvme_tcp.c) in nvme driver. With this new transport, it can be used to connect the NVMe-oF target with the same TCP/IP support.</p>
<p>Added API, <a class="el" href="nvme_8h.html#a39c91e2e6ae899f37b5a89c28a2207cf" title="Indicate whether a ctrlr handle is associated with a Discovery controller.">spdk_nvme_ctrlr_is_discovery()</a>, to indicate whether the ctrlr arg refers to a Discovery Controller or not.</p>
<p>Added an API function <code>spdk_nvme_host_id_parse</code> and corresponding object <code><a class="el" href="structspdk__nvme__host__id.html" title="NVMe host identifier.">spdk_nvme_host_id</a></code> for parsing host address and host service ID arguments on a per connection basis.</p>
<p>The RPC <code>construct_nvme_bdev</code> now allows a user to specify a source address and service id for the host to use when connecting to the controller backing the NVMe bdev.</p>
<h2>NVMe-oF Target</h2>
<p>The <code>spdk_nvmf_tgt_opts</code> struct has been deprecated in favor of <code><a class="el" href="structspdk__nvmf__transport__opts.html">spdk_nvmf_transport_opts</a></code>. Users will no longer be able to specify target wide I/O parameters. <code>spdk_nvmf_tgt_listen</code> will also no longer implicitly initialize a transport with the default target options (since there are none). Instead, a user must manually instantiate the transport with <code>spdk_nvmf_transport_create</code> prior to calling <code>spdk_nvmf_tgt_listen</code>.</p>
<p>Related to the previous change, the rpc <code>set_nvmf_target_options</code> has been renamed to <code>set_nvmf_target_max_subsystems</code> to indicate that this is the only target option available for the user to edit.</p>
<p>Added fields <code>num_shared_buffers</code> and <code>buf_cache_size</code> in struct <a class="el" href="structspdk__nvmf__transport__opts.html">spdk_nvmf_transport_opts</a>, and also updated the related rpc function nvmf_create_transport, to make this configurable parameter available to users. The <code>num_shared_buffers</code> is used to configure the shared buffer numbers of the transport used by RDMA or TCP transport. <code>buf_cache_size</code> configures number of shared buffers to cache per poll group.</p>
<h2>nvmf</h2>
<p>Add a new TCP/IP transport (located in lib/nvmf/tcp.c). With this transport, the SPDK NVMe-oF target can have a new transport, and can serve the NVMe-oF protocol via TCP/IP from the host.</p>
<p>Added optional mechanism to modify the RDMA transport's behavior when creating protection domains and registering memory. By default, the RDMA transport will use the ibverbs library to create protection domains and register memory. Using <code>spdk_nvme_rdma_init_hooks</code> will subvert that and use an existing registration.</p>
<h2>bdev</h2>
<p>Added <code>enable_bdev_histogram</code> and <code>get_bdev_histogram</code> RPC commands to allow gathering latency data for specified bdev. Please see <a href="https://spdk.io/doc/bdev.html#rpc_bdev_histogram">documentation</a> for more details.</p>
<p>Added <code>required_alignment</code> field to <code><a class="el" href="structspdk__bdev.html">spdk_bdev</a></code>, that specifies an alignment requirement for data buffers associated with an <a class="el" href="structspdk__bdev__io.html">spdk_bdev_io</a>. Bdev layer will automatically double buffer any <a class="el" href="structspdk__bdev__io.html">spdk_bdev_io</a> that violates this alignment, before the <a class="el" href="structspdk__bdev__io.html">spdk_bdev_io</a> is submitted to the bdev module.</p>
<p>On shutdown, bdev unregister now proceeds in top-down fashion, with claimed bdevs skipped (these will be unregistered later, when virtual bdev built on top of the respective base bdev unclaims it). This allows virtual bdevs to be shut down cleanly as opposed to the previous behavior that didn't differentiate between hotremove and planned shutdown.</p>
<p>The <code>delete_bdev</code> RPC is now deprecated. Users should instead use the specific deletion RPC for the bdev type to be removed (i.e. delete_malloc_bdev).</p>
<p>Added support for separate bandwidth rate limits for read and write to QoS in bdev layer.</p>
<p>Bdev I/O statistics now track unmap operations.</p>
<h2>logical volumes</h2>
<p>Logical volume bdev can now be marked as read only using <code>set_read_only_lvol_bdev</code> RPC. This allows for basing clones on top of lvol_bdev without first creating a snapshot.</p>
<p>Added option to change method for data erasure when deleting lvol or resizing down. Default of unmapping clusters can now be changed to writing zeroes or no operation.</p>
<p>Added option to change method for erasing data region on lvol store creation. Default of unmapping can now be changed to writing zeroes or no operation.</p>
<h2>log</h2>
<p>"trace flags" are now referred to as "log flags" in the SPDK log API. The set_trace_flag, clear_trace_flag and get_trace_flags RPCs are now deprecated, and set_log_flag, clear_log_flag and get_log_flags RPCs have been added.</p>
<h2>trace</h2>
<p>New <code>trace_record</code> application was added. It can be used to poll spdk trace shm file and append any new trace entries into another specified file. This can help retain those entries that would otherwise be overwritten in the shm file. See <a href="https://spdk.io/doc/nvmf_tgt_tracepoints.html#capture_trace_events">Capturing sufficient trace events</a> for more details.</p>
<p>Number of trace entries in circular buffer per lcore can now be assigned by starting SPDK app with argument "--num-trace-entries &lt;NUM&gt;" provided.</p>
<p>New <code>get_tpoint_group_mask</code> RPC was added to get current tpoint_group_mask, and each tpoint group status. New <code>enable_tpoint_group</code> and <code>disable_tpoint_group</code> RPC were added to enable or disable a specific tpoint group.</p>
<h2>ftl</h2>
<p>EXPERIMENTAL: Added basic flash translation layer module allowing for using Open Channel SSDs as block devices. The module is split into the library (located in lib/ftl) and bdev_ftl (lib/bdev/ftl). See the <a href="https://spdk.io/doc/ftl.html">documentation</a> for more details.</p>
<h2>vhost</h2>
<p>A security vulnerability has been identified and fixed in the SPDK vhost target. A malicious vhost client (i.e. virtual machine) could carefully construct a circular descriptor chain which would result in a partial denial of service in the SPDK vhost target. These types of descriptor chains are now properly detected by the vhost target. All SPDK vhost users serving untrusted vhost clients are strongly recommended to upgrade. (Reported by Dima Stepanov and Evgeny Yakovlev.)</p>
<p>Vhost SCSI and Vhost Block devices can now accept multiple connections on the same socket file. Each connection (internally called a vhost session) will have access to the same storage, but will use different virtqueues, different features and possibly different memory.</p>
<h2>vhost scsi</h2>
<p>SCSI target hotremove can now be performed even without the VIRTIO_SCSI_F_HOTPLUG feature negotiated. Regardless of VIRTIO_SCSI_F_HOTPLUG support, the hotremoval will be still reported through SCSI sense codes.</p>
<h2>DPDK</h2>
<p>DPDK submodule was updated to DPDK 18.11. Note that SPDK does not fully leverage the new multi-process device hotplug yet and continues to work the same way it always did.</p>
<p>Dropped support for DPDK 16.07 and earlier, which SPDK won't even compile with right now.</p>
<h2>RPC</h2>
<p>The following RPC commands deprecated in the previous release are now removed:</p>
<ul>
<li>construct_virtio_user_scsi_bdev</li>
<li>construct_virtio_pci_scsi_bdev</li>
<li>construct_virtio_user_blk_bdev</li>
<li>construct_virtio_pci_blk_bdev</li>
<li>remove_virtio_scsi_bdev</li>
<li>construct_nvmf_subsystem</li>
</ul>
<h2>Miscellaneous</h2>
<p>The configure options <code>--with-raid</code> and <code>--without-raid</code> that were deprecated in the previous release are now removed.</p>
<h2>nbd</h2>
<p>Starting nbd using <code>spdk_nbd_start</code> is now performed asynchronously.</p>
<h2>net framework</h2>
<p>Net framework initialization and finish is now done asynchronously.</p>
<h2>rpc</h2>
<p>Added <code>spdk_rpc_is_method_allowed</code> function for checking whether method is permitted in a given state. Added <code>spdk_rpc_get_state</code> to check current state of RPC server. RPC <code>wait_subsystem_init</code> has been added to allow clients to block until all subsystems are initialized.</p>
<h2>json rpc</h2>
<p>JSON RPC client is now running in non-blocking mode. Requests are sent and received during spdk_jsonrpc_client_poll. JSON RPC server can now receive a callback on connection termination or server shutdown using <code>spdk_jsonrpc_conn_add_close_cb</code> and <code>spdk_jsonrpc_conn_del_close_cb</code>.</p>
<h1><a class="anchor" id="changelog-v18-10"></a>
v18.10: Dynamic memory allocation, Crypto Virtual Bdev, jsonrpc-client, SPDKCLI iSCSI and NVMe-oF support</h1>
<h2>nvme</h2>
<p><a class="el" href="nvme_8h.html#a0e7a6bb3ac85f99f936290f679399039" title="Send security protocol data to controller.">spdk_nvme_ctrlr_cmd_security_send()</a> and <a class="el" href="nvme_8h.html#ae7bcc2decc2d4ce01b041601c5cdecea" title="Receive security protocol data from controller.">spdk_nvme_ctrlr_cmd_security_receive()</a> were added to support sending or receiving security protocol data to or from nvme controller.</p>
<p><a class="el" href="nvme_8h.html#a8f3f5c5a738dc7ad7e3b2913bff4324c" title="Get the extended sector size, in bytes, of the given namespace.">spdk_nvme_ns_get_extended_sector_size()</a> was added. This function includes the metadata size per sector (if any). <a class="el" href="nvme_8h.html#a0d24c0b2b0b2a22b0c0af2ca2e157e04" title="Get the sector size, in bytes, of the given namespace.">spdk_nvme_ns_get_sector_size()</a> still returns only the data size per sector, not including metadata.</p>
<p>New <code>send_nvme_cmd</code> RPC was added to allow sending NVMe commands directly to NVMe controller. See the <a href="http://spdk.io/doc/jsonrpc.html#rpc_send_nvme_cmd">send_nvme_cmd</a> documentation for more details.</p>
<h2>Build System</h2>
<p>New <code>configure</code> options, <code>--with-shared</code> and <code>--without-shared</code> [default], provide the capability to build, or not, SPDK shared libraries. This includes the single SPDK shared lib encompassing all of the SPDK static libs as well as individual SPDK shared libs corresponding to each of the SPDK static ones. Although the production of the shared libs conforms with conventional version naming practices, such naming does not at this time confer any SPDK ABI compatibility claims.</p>
<h2>bdev</h2>
<p><a class="el" href="bdev__module_8h.html#ae62dae3c4a41154aca74f37864ae82f9" title="Removes all alias from block device alias list.">spdk_bdev_alias_del_all()</a> was added to delete all alias from block device.</p>
<p>A new virtual bdev module has been added to perform at rest data encryption using the DPDK CryptoDev Framework. The module initially uses a software AESNI CBC cipher with experimental support for the Intel QAT hardware accelerator also currently implemented with support for CBC cipher. Future work may include additional ciphers as well as consideration for authentication.</p>
<p>The RAID virtual bdev module is now always enabled by default. The configure &ndash;with-raid and &ndash;without-raid options are now ignored and deprecated and will be removed in the next release.</p>
<p>Enforcement of bandwidth limits for quality of service (QoS) has been added to the bdev layer. See the new <a href="http://www.spdk.io/doc/jsonrpc.html#rpc_set_bdev_qos_limit">set_bdev_qos_limit</a> documentation for more details. The previous set_bdev_qos_limit_iops RPC method introduced at 18.04 release has been deprecated. The new set_bdev_qos_limit RPC method can support both bandwidth and IOPS limits.</p>
<p>spdk_bdev_config_json() and corresponding <code>get_bdevs_config</code> RPC was removed.</p>
<h2>Environment Abstraction Layer and Event Framework</h2>
<p>The size parameter of spdk_mem_map_translate is now a pointer. This allows the function to report back the actual size of the translation relative to the original request made by the user.</p>
<p>A new structure <a class="el" href="structspdk__mem__map__ops.html" title="A function table to be implemented by each memory map.">spdk_mem_map_ops</a> has been introduced to hold memory map related callbacks. This structure is now passed as the second argument of spdk_mem_map_alloc in lieu of the notify callback.</p>
<h2>DPDK 18.08</h2>
<p>The DPDK submodule has been updated to the DPDK 18.08 release. SPDK will now automatically utilize DPDK's dynamic memory management with DPDK versions &gt;= 18.05.1.</p>
<p>Hugepages can be still reserved with <code>[-s|--mem-size &lt;size&gt;]</code> option at application startup, but once we use them all up, instead of failing user allocations with -ENOMEM, we'll try to dynamically reserve even more. This allows starting SPDK with <code>--mem-size 0</code> and using only as many hugepages as it is really needed.</p>
<p>Due to this change, the memory buffers returned by <code>spdk_*malloc()</code> are no longer guaranteed to be physically contiguous.</p>
<h2>I/OAT</h2>
<p>I/OAT driver can now reinitialize I/OAT channels after encountering DMA errors.</p>
<h2>iscsi target</h2>
<p>Parameter names of <code>set_iscsi_options</code> and <code>get_iscsi_global_params</code> RPC method for CHAP authentication in discovery sessions have been changed to align with <code>construct_target_node</code> RPC method. Old names are still usable but will be removed in future release.</p>
<p><code>set_iscsi_discovery_auth</code> and <code>set_iscsi_target_node_auth</code> RPC methods have been added to set CHAP authentication for discovery sessions and existing target nodes, respectively.</p>
<p>The SPDK iSCSI target supports an AuthFile which can be used to load CHAP shared secrets when the iSCSI target starts. SPDK previously provided a default location for this file (<code>/usr/local/etc/spdk/auth.conf</code>) if none was specified. This default has been removed. Users must now explicitly specify the location of this file to load CHAP shared secrets from a file, or use the related iSCSI RPC methods to add them at runtime.</p>
<h2>iscsi initiator</h2>
<p>The SPDK iSCSI initiator is no longer considered experimental and becomes a first-class citizen among bdev modules. The basic usage has been briefly described in the bdev user guide: <a href="https://spdk.io/doc/bdev.html#bdev_config_iscsi">iSCSI bdev</a></p>
<h2>Miscellaneous</h2>
<p>The SPDK application framework can now parse long name command line parameters. Most single-character parameters have a long name equivalent now. See the <a href="https://spdk.io/doc/app_overview.html">Command Line Parameters</a> documentation for details or use the <code>--help</code> command line parameter to list all available params.</p>
<p>bdevperf <code>-s</code> param (io size) was renamed to <code>-o</code> as <code>-s</code> had been already used by existing apps for memory size.</p>
<p>bdevio can now accept all SPDK command line parameters. The config now has to be provided with <code>-c</code> or <code>--config</code> param.</p>
<p>The following ioat/perf and nvme/perf parameters were renamed as well: <code>-s</code> (io size) to <code>-o</code> <code>-d</code> (mem size) to <code>-s</code></p>
<p>The ReactorMask config file parameter has been deprecated. Users should use the -m or &ndash;cpumask command line option to specify the CPU core mask for the application.</p>
<p>Default config file pathnames have been removed from iscsi_tgt, nvmf_tgt and vhost. Config file pathnames may now only be specified using the -c command line option.</p>
<p>Users may no longer set DPDK_DIR in their environment to specify the location of the DPDK installation used to build SPDK. Using DPDK_DIR has not been the documented nor recommended way to specify the DPDK location for several releases, but removing it ensures no unexpected surprises for users who may have DPDK_DIR defined for other reasons. Users should just use the "configure" script to specify the DPDK location before building SPDK.</p>
<p>Although we know that many developers still use Python 2 we are officially switching to Python3 with requirement that all new code must be valid also for Python 2 up to the EOL which is year 2020.</p>
<p>Invoking interpreter explicitly is forbidden for executable scripts. There is no need to use syntax like "python ./scripts/rpc.py". All executable scripts must contain proper shebang pointing to the right interpreter. Scripts without shebang mustn't be executable.</p>
<p>A Python script has been added to enable conversion of old INI config file to new JSON-RPC config file format. This script can be found at scripts/config_converter.py. Example how this script can be used: </p><div class="fragment"><div class="line">cat old_format.ini | scripts/config_converter.py &gt; new_json_format.json</div>
</div><!-- fragment --><h2>Sock</h2>
<p>Two additional parameters were added to spdk_sock_get_addr() for the server port and client port. These parameters are named "sport" and "cport" respectively.</p>
<h2>Virtio</h2>
<p>The following RPC commands have been deprecated:</p>
<ul>
<li>construct_virtio_user_scsi_bdev</li>
<li>construct_virtio_pci_scsi_bdev</li>
<li>construct_virtio_user_blk_bdev</li>
<li>construct_virtio_pci_blk_bdev</li>
<li>remove_virtio_scsi_bdev</li>
</ul>
<p>The <code>construct_virtio_*</code> ones were replaced with a single <code>construct_virtio_dev</code> command that can create any type of Virtio bdev(s). <code>remove_virtio_scsi_bdev</code> was replaced with <code>remove_virtio_bdev</code> that can delete both Virtio Block and SCSI devices.</p>
<h2>Blobfs</h2>
<p><a class="el" href="blobfs_8h.html#a816f18c23723f7211b0a5a277904b202" title="Get the unique ID for the file.">spdk_file_get_id()</a> returning unique ID for the file was added.</p>
<h2>JSON</h2>
<p>Added jsonrpc-client C library intended for issuing RPC commands from applications.</p>
<p>Added API enabling iteration over JSON object:</p>
<ul>
<li><a class="el" href="json_8h.html#a5fc65c7d1961c23a747b3e2aa2169f4a" title="Return JSON value associated with key key_name.">spdk_json_find()</a></li>
<li><a class="el" href="json_8h.html#a04601f5c6dc82ac1ddedc387a510249d" title="The same as calling spdk_json_find() function with type set to SPDK_JSON_VAL_STRING.">spdk_json_find_string()</a></li>
<li><a class="el" href="json_8h.html#a0512cd8ee58901ec15f5ef372d6cafc6" title="The same as calling spdk_json_key() function with type set to SPDK_JSON_VAL_ARRAY_BEGIN.">spdk_json_find_array()</a></li>
<li><a class="el" href="json_8h.html#ae99e0abc8df8354366640d956b1a7461" title="Return first JSON value in given JSON object.">spdk_json_object_first()</a></li>
<li><a class="el" href="json_8h.html#aabfcbb30424e30c50ab85aae544a73da" title="Return first JSON value in array.">spdk_json_array_first()</a></li>
<li><a class="el" href="json_8h.html#a4ed2b0ed4b598337db1ef401ccc24b2a" title="Advance to the next JSON value in JSON object or array.">spdk_json_next()</a></li>
</ul>
<h2>Blobstore</h2>
<p>Blobstore I/O operations are now based on io_units, instead of blobstore page size. The io_unit size is now the same as the underlying block device's block size. Logical volumes built on a block device with 512B block size can now be used as boot devices in QEMU.</p>
<h2>SPDKCLI</h2>
<p>The SPDKCLI interactive command tool for managing SPDK is no longer considered experimental. Support for the iSCSI and NVMe-oF targets has been added.</p>
<h1><a class="anchor" id="changelog-v18-07"></a>
v18.07: Raid, Infrastructure Improvements, Bug Fixes</h1>
<h2>bdev</h2>
<p>A new public header file <a class="el" href="bdev__module_8h.html" title="Block Device Module Interface.">bdev_module.h</a> has been introduced to facilitate the development of new bdev modules. This header includes an interface for the <a class="el" href="structspdk__bdev__part.html">spdk_bdev_part</a> and spdk_bdev_part_base objects to enable the creation of multiple virtual bdevs on top of a single base bdev and should act as the primary API for module authors.</p>
<p><a class="el" href="bdev_8h.html#ab0c4412ed5d0e1869620965304d36b7f" title="Get the options for the bdev module.">spdk_bdev_get_opts()</a> and spdk_bdev_set_opts() were added to set bdev-wide options.</p>
<p>A mechanism for handling out of memory condition errors (ENOMEM) returned from I/O submission requests at the bdev layer has been added. See <a class="el" href="bdev_8h.html#acc4beee18ded7837fa92bd7c34e7ef2e" title="Add an entry into the calling thread&#39;s queue to be notified when an spdk_bdev_io becomes available.">spdk_bdev_queue_io_wait()</a>.</p>
<p>The <a class="el" href="bdev_8h.html#ab1ba28ba382edd1d792d51a054eb3aa2" title="Return I/O statistics for this channel.">spdk_bdev_get_io_stat()</a> function now returns cumulative totals instead of resetting on each call. This allows multiple callers to query I/O statistics without conflicting with each other. Existing users will need to adjust their code to record the previous I/O statistics to calculate the delta between calls.</p>
<p>I/O queue depth tracking and samples options have been added. See <a class="el" href="bdev_8h.html#a471f32e8948203f7aaf320396a1ae7c9" title="Get the most recently measured queue depth from a bdev.">spdk_bdev_get_qd()</a>, <a class="el" href="bdev_8h.html#adab852ac707702316bf869a3d7dfdc85" title="Get the queue depth polling period.">spdk_bdev_get_qd_sampling_period()</a>, and <a class="el" href="bdev_8h.html#a9d37ad1d4da0bcb51ada76dbe4f4ce15" title="Enable or disable queue depth sampling for this bdev.">spdk_bdev_set_qd_sampling_period()</a>.</p>
<h2>RAID module</h2>
<p>A new bdev module called "raid" has been added as experimental module which aggregates underlying NVMe bdevs and exposes a single raid bdev. Please note that vhost will not work with this module because it does not yet have support for multi-element io vectors.</p>
<h2>Log</h2>
<p>The debug log component flag available on several SPDK applications has been renamed from <code>-t</code> to <code>-L</code> to prevent confusion with tracepoints and to allow the option to be added to tools that already use <code>-t</code> to mean something else.</p>
<h2>Blobstore</h2>
<p>A new function, <a class="el" href="blob_8h.html#aa75072ce1a5a9559fe2db0da30363ad4" title="Dump a blobstore&#39;s metadata to a given FILE in human-readable format.">spdk_bs_dump()</a>, has been added that dumps all of the contents of a blobstore to a file pointer. This includes the metadata and is very useful for debugging.</p>
<p>Two new operations have been added for thin-provisioned blobs. <a class="el" href="blob_8h.html#a3d1f1b56d9782997ef3e338879a2fa28" title="Allocate all clusters in this blob.">spdk_bs_inflate_blob()</a> will allocate clusters for all thinly provisioned regions of the blob and populate them with the correct data by reading from the backing blob(s). <a class="el" href="blob_8h.html#a7dee33b6b9df9b9a3d6b9957c71a779c" title="Remove dependency on parent blob.">spdk_bs_blob_decouple_parent()</a> works similarly, but will only allocate clusters that correspond to data in the blob's immediate parent. Clusters allocated to grandparents or that aren't allocated at all will remain thin-provisioned.</p>
<h2>BlobFS</h2>
<p>Changed the return type of <a class="el" href="blobfs_8h.html#ada4d09ddb42d39ba04b437193dc33d69" title="Truncate the file.">spdk_file_truncate()</a> from void to int to allow the propagation of <code>ENOMEM</code> errors.</p>
<h2>NVMe Driver</h2>
<p>The new API functions <a class="el" href="nvme_8h.html#acf6188764b8c71b2f64a74077d6bfabf" title="Inject an error for the next request with a given opcode.">spdk_nvme_qpair_add_cmd_error_injection()</a> and <a class="el" href="nvme_8h.html#ad720b23786450b5a2b2d7d65c6dd6b7c" title="Clear the specified NVMe command with error status.">spdk_nvme_qpair_remove_cmd_error_injection()</a> have been added for NVMe error emulation. Users can set a specified command to fail with a particular error status.</p>
<p>Changed the name <code>timeout_sec</code> parameter to <code>timeout_us</code> in <a class="el" href="nvme_8h.html#ae2957853179526e6176cf7623b19552b" title="Register for timeout callback on a controller.">spdk_nvme_ctrlr_register_timeout_callback()</a>, and also changed the type from uint32_t to uint64_t. This will give users more fine-grained control over the timeout period.</p>
<p>Basic support for Open Channel SSDs was added. See <a class="el" href="nvme__ocssd_8h.html" title="NVMe driver public API extension for Open-Channel.">nvme_ocssd.h</a></p>
<h2>NVMe Over Fabrics</h2>
<p>The <a class="el" href="nvmf_8h.html#a21638f4d81002e93d410cd0d267f608c" title="Destroy an NVMe-oF target.">spdk_nvmf_tgt_destroy()</a> function is now asynchronous and takes a callback as a parameter.</p>
<p><a class="el" href="nvmf_8h.html#ab5056f8043ae301e8f79cd96172face9" title="Disconnect an NVMe-oF qpair.">spdk_nvmf_qpair_disconnect()</a> was added to allow the user to disconnect qpairs.</p>
<p><a class="el" href="nvmf_8h.html#a414b91bad7200ab931f14a06585ccc74" title="Get the maximum number of namespaces allowed in a subsystem.">spdk_nvmf_subsystem_get_max_namespaces()</a> was added to query the maximum allowed number of namespaces for a given subsystem.</p>
<h2>Build System</h2>
<p>The build system now generates a combined shared library (libspdk.so) that may be used in place of the individual static libraries (libspdk_*.a). The combined library includes all components of SPDK and is intended to make linking against SPDK easier. The static libraries are also still provided for users that prefer to link only the minimal set of components required.</p>
<h2>git pre-commit and pre-push hooks</h2>
<p>The pre-commit hook will run <code>scripts/check_format.sh</code> and verify there are no formatting errors before allowing <code>git commit</code> to run. The pre-push hook runs <code>make CONFIG_WERROR=y</code> with and without <code>CONFIG_DEBUG=y</code> using both the gcc and clang compiler before allowing <code>git push</code> to run. Following each DEBUG build <code>test/unit/unittest.sh</code> is run and verified. Results are recorded in the <code>make.log</code> file.</p>
<p>To enable type: 'git config core.hooksPath .githooks'. To override after configuration use the <code>git --no-verify</code> flag.</p>
<h2>RPC</h2>
<p>The <code>start_nbd_disk</code> RPC method now returns the path to the kernel NBD device node rather than always returning <code>true</code>.</p>
<h2>DPDK 18.05</h2>
<p>The DPDK submodule has been rebased on the DPDK 18.05 release. DPDK 18.05 supports dynamic memory allocation, but due to some issues found after the DPDK 18.05 release, that support is not enabled for SPDK 18.07. Therefore, SPDK 18.07 will continue to use the legacy memory allocation model. The plan is to enable dynamic memory allocation after the DPDK 18.08 release which should fix these issues.</p>
<h2>Environment Abstraction Layer and Event Framework</h2>
<p>The <a class="el" href="env_8h.html#a99549dc9905683f1dea50ff79d0c5651" title="Look up the translation of a virtual address in a memory map.">spdk_mem_map_translate()</a> function now takes a size parameter to indicate the size of the memory region. This can be used by environment implementations to validate the requested translation.</p>
<p>The I/O Channel implementation has been moved to its own library - lib/thread. The public API that was previously in spdk/io_channel.h is now in <a class="el" href="thread_8h.html" title="Thread.">spdk/thread.h</a> The file spdk/io_channel.h remains and includes <a class="el" href="thread_8h.html" title="Thread.">spdk/thread.h</a>.</p>
<p>spdk_reactor_get_tsc_stats was added to return interesting statistics for each reactor.</p>
<h2>IOAT</h2>
<p>IOAT for copy engine is disabled by default. It can be enabled by specifying the Enable option with "Yes" in <code>[Ioat]</code> section of the configuration file. The Disable option is now deprecated and will be removed in a future release.</p>
<h1><a class="anchor" id="changelog-v18-04"></a>
v18.04: Logical Volume Snapshot/Clone, iSCSI Initiator, Bdev QoS, VPP Userspace TCP/IP</h1>
<h2>vhost</h2>
<p>The SPDK vhost-scsi, vhost-blk and vhost-nvme applications have fixes to address the DPDK rte_vhost vulnerability <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-1059">CVE-2018-1059</a>. Please see this <a href="https://access.redhat.com/security/cve/cve-2018-1059">security advisory</a> for additional information on the DPDK vulnerability.</p>
<p>Workarounds have been added to ensure vhost compatibility with QEMU 2.12.</p>
<p>EXPERIMENTAL: Support for vhost-nvme has been added to the SPDK vhost target. See the <a href="http://www.spdk.io/doc/vhost.html">vhost documentation</a> for more details.</p>
<h2>Unified Target Application</h2>
<p>A new unified SPDK target application, <code>spdk_tgt</code>, has been added. This application combines the functionality of several existing SPDK applications, including the iSCSI target, NVMe-oF target, and vhost target. The new application can be managed through the existing configuration file and <a href="http://www.spdk.io/doc/jsonrpc.html">JSON-RPC</a> methods.</p>
<h2>Env</h2>
<p><a class="el" href="env_8h.html#a5695d9dcc6f53a561f41c932a198853b" title="Get multiple elements from a memory pool.">spdk_mempool_get_bulk()</a> has been added to wrap DPDK rte_mempool_get_bulk().</p>
<p>New memory management functions <a class="el" href="env_8h.html#a54dee7b759c26ff2a7e1789ddb59f214" title="Allocate dma/sharable memory based on a given dma_flg.">spdk_malloc()</a>, <a class="el" href="env_8h.html#a3ccd5c242af65c41dbe49ae2d903b5e4" title="Allocate dma/sharable memory based on a given dma_flg.">spdk_zmalloc()</a>, and <a class="el" href="env_8h.html#a452d670d7188f883224574dfabc39f2c" title="Free buffer memory that was previously allocated with spdk_malloc() or spdk_zmalloc().">spdk_free()</a> have been added. These new functions have a <code>flags</code> parameter that allows the user to specify whether the allocated memory needs to be suitable for DMA and whether it should be shared across processes with the same shm_id. The new functions are intended to replace <a class="el" href="env_8h.html#ac9b56bdbcfeeebe6ad61eb574c823268" title="Allocate a pinned memory buffer with the given size and alignment.">spdk_dma_malloc()</a> and related functions, which will eventually be deprecated and removed.</p>
<h2>Bdev</h2>
<p>A new optional bdev module interface function, <code>init_complete</code>, has been added to notify bdev modules when the bdev subsystem initialization is complete. This may be useful for virtual bdevs that require notification that the set of initialization examine() calls is complete.</p>
<p>The bdev layer now allows modules to provide an optional per-bdev UUID, which can be retrieved with the <a class="el" href="bdev_8h.html#add8565cdbf3d57697b67202b869a7beb" title="Get a bdev&#39;s UUID.">spdk_bdev_get_uuid()</a> function.</p>
<p>Enforcement of IOPS limits for quality of service (QoS) has been added to the bdev layer. See the <a href="http://www.spdk.io/doc/jsonrpc.html#rpc_set_bdev_qos_limit_iops">set_bdev_qos_limit_iops</a> documentation for more details.</p>
<h2>RPC</h2>
<p>The <code>[Rpc]</code> configuration file section, which was deprecated in v18.01, has been removed. Users should switch to the <code>-r</code> command-line parameter instead.</p>
<p>The JSON-RPC server implementation now allows up to 32 megabyte responses, growing as needed; previously, the response was limited to 32 kilobytes.</p>
<h2>SPDKCLI</h2>
<p>EXPERIMENTAL: New SPDKCLI interactive command tool for managing SPDK is available. See the <a href="http://www.spdk.io/doc/spdkcli.html">SPDKCLI</a> documentation for more details.</p>
<h2>NVMe Driver</h2>
<p>EXPERIMENTAL: Support for WDS and RDS capable CMBs in NVMe controllers has been added. This support is experimental pending a functional allocator to free and reallocate CMB buffers.</p>
<p><a class="el" href="nvme_8h.html#a6c559063408299a4612fd2e62f97bc63" title="Get the UUID for the given namespace.">spdk_nvme_ns_get_uuid()</a> has been added to allow retrieval of per-namespace UUIDs when available.</p>
<p>New API functions <a class="el" href="nvme_8h.html#a59e69f39c7cb8a9e1c3e00af7804c8bd" title="Get the nsid of the first active namespace.">spdk_nvme_ctrlr_get_first_active_ns()</a> and <a class="el" href="nvme_8h.html#abcd528b0df0a564c218dc2745c3af159" title="Get next active namespace given the previous nsid.">spdk_nvme_ctrlr_get_next_active_ns()</a> have been added to iterate active namespaces, as well as <a class="el" href="nvme_8h.html#abbcdb6e7c22b0ef87ed927bf97952c19" title="Check whether the nsid is an active nv for the given NVMe controller.">spdk_nvme_ctrlr_is_active_ns()</a> to check if a namespace ID is active.</p>
<h2>NVMe-oF Target</h2>
<p>Namespaces may now be assigned unique identifiers via new optional <code>eui64</code> and <code>nguid</code> parameters to the <code>nvmf_subsystem_add_ns</code> RPC method. Additionally, the NVMe-oF target automatically exposes the backing bdev's UUID as the namespace UUID when available.</p>
<p><a class="el" href="nvmf_8h.html#aa10ac07a403de72643a5e9801e9fec0b" title="Remove a namespace from a subsystem.">spdk_nvmf_subsystem_remove_ns()</a> is now asynchronous and requires a callback to indicate completion.</p>
<h2>Blobstore</h2>
<p>A number of functions have been renamed:</p>
<ul>
<li>spdk_bs_io_write_blob() =&gt; <a class="el" href="blob_8h.html#a2835355d4266676fa6db5c987c506a77" title="Write data to a blob.">spdk_blob_io_write()</a></li>
<li>spdk_bs_io_read_blob() =&gt; <a class="el" href="blob_8h.html#a8753efc66a7bc29a63ae74730959b9c1" title="Read data from a blob.">spdk_blob_io_read()</a></li>
<li>spdk_bs_io_writev_blob() =&gt; <a class="el" href="blob_8h.html#afa2fed3283426fb3ddf6abc61a44266b" title="Write the data described by &#39;iov&#39; to &#39;length&#39; io_units beginning at &#39;offset&#39; io_units into the blob.">spdk_blob_io_writev()</a></li>
<li>spdk_bs_io_readv_blob() =&gt; <a class="el" href="blob_8h.html#ade242e483bcb3a50bb987acf2e0dfd4e" title="Read &#39;length&#39; io_units starting at &#39;offset&#39; io_units into the blob into the memory described by &#39;iov&#39;...">spdk_blob_io_readv()</a></li>
<li>spdk_bs_io_unmap_blob() =&gt; <a class="el" href="blob_8h.html#a2dea7bc3f6cc4dcd2b5d039b14b8640a" title="Unmap &#39;length&#39; io_units beginning at &#39;offset&#39; io_units on the blob as unused.">spdk_blob_io_unmap()</a></li>
<li>spdk_bs_io_write_zeroes_blob() =&gt; <a class="el" href="blob_8h.html#a0291498c4cac92556e0e7e7bf286bda6" title="Write zeros into area of a blob.">spdk_blob_io_write_zeroes()</a></li>
</ul>
<p>The old names still exist but are deprecated. They will be removed in the v18.07 release.</p>
<p><a class="el" href="blob_8h.html#a70993dda1206b4c0aaa76deb2b6fd13c" title="Resize a blob to &#39;sz&#39; clusters.">spdk_blob_resize()</a> is now an asynchronous operation to enable resizing a blob while I/O are in progress to that blob on other threads. An explicit <a class="el" href="blob_8h.html#a5acc48debefc30773518871e4f84480f" title="Sync a blob.">spdk_blob_sync_md()</a> is still required to sync the updated metadata to disk.</p>
<h2>Logical Volumes</h2>
<p>A new <code>destroy_lvol_bdev</code> RPC method to delete logical volumes has been added.</p>
<p>Lvols now have their own UUIDs which replace previous LvolStoreUUID_BlobID combination.</p>
<p>New Snapshot and Clone functionalities have been added. User may create Snapshots of existing Lvols and Clones of existing Snapshots. See the <a href="http://www.spdk.io/doc/logical_volumes.html#lvol_snapshots">lvol snapshots</a> documentation for more details.</p>
<p>Resizing logical volumes is now supported via the <code>resize_lvol_bdev</code> RPC method.</p>
<h2>Lib</h2>
<p>A set of changes were made in the SPDK's lib code altering instances of calls to <code>exit()</code> and <code>abort()</code> to return a failure instead wherever reasonably possible.</p>
<p><a class="el" href="event_8h.html#a3901d9ed6c234d92296db9ec9252a0f5" title="Start the framework.">spdk_app_start()</a> no longer exit()'s on an internal failure, but instead returns a non-zero error status.</p>
<p><a class="el" href="event_8h.html#a85c562c0e4c4c8dac2f655bc279bc1a0" title="Helper function for parsing arguments and printing usage messages.">spdk_app_parse_args()</a> no longer exit()'s on help, '-h', or an invalid option, but instead returns SPDK_APP_PARSE_ARGS_HELP and SPDK_APP_PARSE_ARGS_FAIL, respectively, and SPDK_APP_PARSE_ARGS_SUCCESS on success.</p>
<p>spdk_pci_get_device() has been deprecated and will be removed in SPDK v18.07.</p>
<h2>I/O Channels</h2>
<p>The prototype for <a class="el" href="thread_8h.html#a35c421accdc2a0a61bb7be916106293b" title="Callback function for a poller.">spdk_poller_fn()</a> has been modified; it now returns a value indicating whether or not the poller did any work. Existing pollers will need to be updated to return a value.</p>
<h2>iSCSI Target</h2>
<p>The SPDK iSCSI target now supports the fd.io Vector Packet Processing (VPP) framework userspace TCP/IP stack. See the <a href="http://www.spdk.io/doc/iscsi.html#vpp">iSCSI VPP documentation</a> for more details.</p>
<h2>iSCSI initiator</h2>
<p>An iSCSI initiator bdev module has been added to SPDK. This module should be considered experimental pending additional features and tests. More details can be found in lib/bdev/iscsi/README.</p>
<h2>PMDK</h2>
<p>The persistent memory (PMDK) bdev module is now enabled using <code>--with-pmdk</code> instead of <code>--with-nvml</code>. This reflects the renaming of the persistent memory library from NVML to PMDK.</p>
<h2>Virtio Block driver</h2>
<p>A userspace driver for Virtio Block devices has been added. It was built on top of the <a href="http://www.spdk.io/doc/virtio.html">Virtio</a> library and can be managed similarly to the Virtio SCSI driver. See the <a href="http://www.spdk.io/doc/bdev.html#bdev_config_virtio_blk">Virtio Block</a> reference for more information.</p>
<h2>Virtio with 2MB hugepages</h2>
<p>The previous 1GB hugepage limitation has now been lifted. A new <code>-g</code> command-line option enables SPDK Virtio to work with 2MB hugepages. See <a href="http://www.spdk.io/doc/virtio.html#virtio_2mb">2MB hugepages</a> for details.</p>
<h1><a class="anchor" id="changelog-v18-01"></a>
v18.01: Blobstore Thin Provisioning</h1>
<h2>Build System</h2>
<p>The build system now includes a <code>make install</code> rule, including support for the common <code>DESTDIR</code> and <code>prefix</code> variables as used in other build systems. Additionally, the prefix may be set via the configure <code>--prefix</code> option. Example: <code>make install prefix=/usr</code>.</p>
<h2>RPC</h2>
<p>A JSON RPC listener is now enabled by default using a UNIX domain socket at /var/tmp/spdk.sock. A -r option command line option has been added to enable an alternative UNIX domain socket location, or a TCP port in the format ip_addr:tcp_port (i.e. 127.0.0.1:5260). The Rpc configuration file section is now deprecated and will be removed in the v18.04 release.</p>
<h2>I/O Channels</h2>
<p><a class="el" href="thread_8h.html#a6b3e883ddce01ae8d93541304d1e9126" title="Register a poller on the current thread.">spdk_poller_register()</a> and <a class="el" href="thread_8h.html#a9c26cbd781063f5ee627d6aba2c73fe3" title="Unregister a poller on the current thread.">spdk_poller_unregister()</a> were moved from the event framework (<a class="el" href="event_8h.html" title="Event framework public API.">include/spdk/event.h</a>) to the I/O channel library (include/spdk/io_channel.h). This allows code that doesn't depend on the event framework to request registration and unregistration of pollers.</p>
<p><a class="el" href="thread_8h.html#aa7a2ca9bd0497544e852c65fd5263cd1" title="Call &#39;fn&#39; on each channel associated with io_device.">spdk_for_each_channel()</a> now allows asynchronous operations during iteration. Instead of immediately continuing the interaction upon returning from the iteration callback, the user must call <a class="el" href="thread_8h.html#a4e87fc8c0fc870769c068a2752cdc359" title="Helper function to iterate all channels for spdk_for_each_channel().">spdk_for_each_channel_continue()</a> to resume iteration.</p>
<h2>Block Device Abstraction Layer (bdev)</h2>
<p>The poller abstraction was removed from the bdev layer. There is now a general purpose abstraction for pollers available in include/spdk/io_channel.h</p>
<h2>Lib</h2>
<p>A set of changes were made in the SPDK's lib code altering, instances of calls to <code>exit()</code> and <code>abort()</code> to return a failure instead wherever reasonably possible. This has resulted in return type changes of the API for:</p>
<ul>
<li><a class="el" href="env_8h.html#a402ca8ae67be57c2c258a7a2bf22cfec" title="Initialize or reinitialize the environment library.">spdk_env_init()</a> from type <code>void</code> to <code>int</code>.</li>
<li>spdk_mem_map_init() from type <code>void</code> to <code>int</code>.</li>
</ul>
<p>Applications making use of these APIs should be modified to check for a non-zero return value instead of relying on them to fail without return.</p>
<h2>NVMe Driver</h2>
<p>SPDK now supports hotplug for vfio-attached devices. But there is one thing keep in mind: Only physical removal events are supported; removing devices via the sysfs <code>remove</code> file will not work.</p>
<h2>NVMe-oF Target</h2>
<p>Subsystems are no longer tied explicitly to CPU cores. Instead, connections are handed out to the available cores round-robin. The "Core" option in the configuration file has been removed.</p>
<h2>Blobstore</h2>
<p>A number of functions have been renamed:</p>
<ul>
<li>spdk_bs_md_resize_blob() =&gt; <a class="el" href="blob_8h.html#a70993dda1206b4c0aaa76deb2b6fd13c" title="Resize a blob to &#39;sz&#39; clusters.">spdk_blob_resize()</a></li>
<li>spdk_bs_md_sync_blob() =&gt; <a class="el" href="blob_8h.html#a5acc48debefc30773518871e4f84480f" title="Sync a blob.">spdk_blob_sync_md()</a></li>
<li>spdk_bs_md_close_blob() =&gt; <a class="el" href="blob_8h.html#ac6ca1e83e9608eb1dea9fca62881d350" title="Close a blob.">spdk_blob_close()</a></li>
<li>spdk_bs_md_get_xattr_names() =&gt; <a class="el" href="blob_8h.html#ab9b3d20a4be55b2c2ba046a2ccfe7233" title="Iterate through all extended attributes of the blob.">spdk_blob_get_xattr_names()</a></li>
<li>spdk_bs_md_get_xattr_value() =&gt; <a class="el" href="blob_8h.html#afe49b3a95d13aed755726bed94f79344" title="Get the value of the specified extended attribute.">spdk_blob_get_xattr_value()</a></li>
<li>spdk_blob_md_set_xattr() =&gt; <a class="el" href="blob_8h.html#a74beed7022f23df295149fd68ac8935d" title="Set an extended attribute for the given blob.">spdk_blob_set_xattr()</a></li>
<li>spdk_blob_md_remove_xattr() =&gt; <a class="el" href="blob_8h.html#a5c836667ea7f3c5fa5b2e3bf486d8428" title="Remove the extended attribute from the given blob.">spdk_blob_remove_xattr()</a></li>
<li>spdk_bs_md_create_blob() =&gt; <a class="el" href="blob_8h.html#a33263462543c5f2b51f4d507ea26a58d" title="Create a new blob with default option values on the given blobstore.">spdk_bs_create_blob()</a></li>
<li>spdk_bs_md_open_blob() =&gt; <a class="el" href="blob_8h.html#a2c60e6bc3ccd26228dec2c0f3ecfe618" title="Open a blob from the given blobstore.">spdk_bs_open_blob()</a></li>
<li>spdk_bs_md_delete_blob() =&gt; <a class="el" href="blob_8h.html#aed4fb5871f9ca58ff60c0dd8810eb223" title="Delete an existing blob from the given blobstore.">spdk_bs_delete_blob()</a></li>
<li>spdk_bs_md_iter_first() =&gt; <a class="el" href="blob_8h.html#af173fe4e35623b8dc8256e9141700486" title="Get the first blob of the blobstore.">spdk_bs_iter_first()</a></li>
<li>spdk_bs_md_iter_next() =&gt; <a class="el" href="blob_8h.html#a98d90e701cf3377115ff0bb67db1342a" title="Get the next blob by using the current blob.">spdk_bs_iter_next()</a></li>
</ul>
<p>The function signature of <a class="el" href="blob_8h.html#ac6ca1e83e9608eb1dea9fca62881d350" title="Close a blob.">spdk_blob_close()</a> has changed. It now takes a struct spdk_blob * argument rather than struct spdk_blob **.</p>
<p>The function signature of <a class="el" href="blob_8h.html#a98d90e701cf3377115ff0bb67db1342a" title="Get the next blob by using the current blob.">spdk_bs_iter_next()</a> has changed. It now takes a struct spdk_blob * argument rather than struct spdk_blob **.</p>
<p>Thin provisioning support has been added to the blobstore. It can be enabled by setting the <code>thin_provision</code> flag in struct <a class="el" href="structspdk__blob__opts.html">spdk_blob_opts</a> when calling <a class="el" href="blob_8h.html#a3c00efe656ca70fc5e8f2f477b8e48ed" title="Create a new blob with options on the given blobstore.">spdk_bs_create_blob_ext()</a>.</p>
<h2>NBD device</h2>
<p>The NBD application (test/lib/bdev/nbd) has been removed; Same functionality can now be achieved by using the test/app/bdev_svc application and start_nbd_disk RPC method. See the <a href="http://www.spdk.io/doc/bdev.html#bdev_config_gpt">GPT</a> documentation for more details.</p>
<h2>FIO plugin</h2>
<p>SPDK <code>fio_plugin</code> now supports FIO 3.3. The support for previous FIO 2.21 has been dropped, although it still remains to work for now. The new FIO contains huge amount of bugfixes and it's recommended to do an update.</p>
<h2>Virtio library</h2>
<p>Previously a part of the bdev_virtio module, now a separate library. Virtio is now available via <code>spdk_internal/virtio.h</code> file. This is an internal interface to be used when implementing new Virtio backends, namely Virtio-BLK.</p>
<h2>iSCSI</h2>
<p>The MinConnectionIdleInterval parameter has been removed, and connections are no longer migrated to an epoll/kqueue descriptor on the master core when idle.</p>
<h1><a class="anchor" id="changelog-v17-10"></a>
v17.10: Logical Volumes</h1>
<h2>New dependencies</h2>
<p>libuuid was added as new dependency for logical volumes.</p>
<p>libnuma is now required unconditionally now that the DPDK submodule has been updated to DPDK 17.08.</p>
<h2>Block Device Abstraction Layer (bdev)</h2>
<p>An <a href="http://github.com/axboe/fio">fio</a> plugin was added that can route I/O to the bdev layer. See the <a href="https://github.com/spdk/spdk/tree/master/examples/bdev/fio_plugin/">plugin documentation</a> for more information.</p>
<p><a class="el" href="group__bdev__io__submit__functions.html#ga680c9c302998f7b003e2476e35d9ae4b" title="Submit an unmap request to the block device.">spdk_bdev_unmap()</a> was modified to take an offset and a length in bytes as arguments instead of requiring the user to provide an array of SCSI unmap descriptors. This limits unmaps to a single contiguous range.</p>
<p><a class="el" href="group__bdev__io__submit__functions.html#gadc50b78fec7f69190d9139aff29a9043" title="Submit a write zeroes request to the bdev on the given channel.">spdk_bdev_write_zeroes()</a> was introduced. It ensures that all specified blocks will be zeroed out. If a block device doesn't natively support a write zeroes command, the bdev layer emulates it using write commands.</p>
<p>New API functions that accept I/O parameters in units of blocks instead of bytes have been added:</p>
<ul>
<li><a class="el" href="group__bdev__io__submit__functions.html#gaeec9efd151e2fb34ee3d22a1edbbb53f" title="Submit a read request to the bdev on the given channel.">spdk_bdev_read_blocks()</a>, <a class="el" href="group__bdev__io__submit__functions.html#ga55483d5ae010c514b37b976ad803b4b2" title="Submit a read request to the bdev on the given channel.">spdk_bdev_readv_blocks()</a></li>
<li><a class="el" href="group__bdev__io__submit__functions.html#ga12da8917f525a6e11cbf22b2b7652c89" title="Submit a write request to the bdev on the given channel.">spdk_bdev_write_blocks()</a>, <a class="el" href="group__bdev__io__submit__functions.html#gaf5849064d12de9f140a41522d1f7c95b" title="Submit a write request to the bdev on the given channel.">spdk_bdev_writev_blocks()</a></li>
<li><a class="el" href="group__bdev__io__submit__functions.html#ga047f8a9f8d0a3d1d7bfcdf0a9838b261" title="Submit a write zeroes request to the bdev on the given channel.">spdk_bdev_write_zeroes_blocks()</a></li>
<li><a class="el" href="group__bdev__io__submit__functions.html#ga7555fdd41019e29b40e535b72457d30b" title="Submit an unmap request to the block device.">spdk_bdev_unmap_blocks()</a></li>
</ul>
<p>The bdev layer now handles temporary out-of-memory I/O failures internally by queueing the I/O to be retried later.</p>
<h2>Linux AIO bdev</h2>
<p>The AIO bdev now allows the user to override the auto-detected block size.</p>
<h2>NVMe driver</h2>
<p>The NVMe driver now recognizes the NVMe 1.3 Namespace Optimal I/O Boundary field. NVMe 1.3 devices may report an optimal I/O boundary, which the driver will take into account when splitting I/O requests.</p>
<p>The HotplugEnable option in <code>[Nvme]</code> sections of the configuration file is now "No" by default. It was previously "Yes".</p>
<p>The NVMe library now includes a <a class="el" href="nvme_8h.html#a2640aeebb82108e9b507dcccb1e564c2" title="Get the controller with which this namespace is associated.">spdk_nvme_ns_get_ctrlr()</a> function which returns the NVMe Controller associated with a given namespace.</p>
<p>The NVMe library now allows the user to specify a host identifier when attaching to a controller. The host identifier is used as part of the Reservations feature, as well as in the NVMe-oF Connect command. The default host ID is also now a randomly-generated UUID, and the default host NQN uses the host ID to generate a UUID-based NQN.</p>
<p><a class="el" href="nvme_8h.html#ae26375a74c2c935ec32f0c41a7ed93df" title="Connect the NVMe driver to the device located at the given transport ID.">spdk_nvme_connect()</a> was added to allow the user to connect directly to a single NVMe or NVMe-oF controller.</p>
<h2>NVMe-oF Target (nvmf_tgt)</h2>
<p>The NVMe-oF target no longer requires any in-capsule data buffers to run, and the feature is now entirely optional. Previously, at least 4 KiB in-capsule data buffers were required.</p>
<p>NVMe-oF subsystems have a new configuration option, AllowAnyHost, to control whether the host NQN whitelist is enforced when accepting new connections. If no Host options have been specified and AllowAnyHost is disabled, the connection will be denied; this is a behavior change from previous releases, which allowed any host NQN to connect if the Host list was empty. AllowAnyHost is disabled by default.</p>
<p>NVMe-oF namespaces may now be assigned arbitrary namespace IDs, and the number of namespaces per subsystem is no longer limited.</p>
<p>The NVMe-oF target now supports the Write Zeroes command.</p>
<h2>Environment Abstraction Layer</h2>
<p>A new default value, SPDK_MEMPOOL_DEFAULT_CACHE_SIZE, was added to provide additional clarity when constructing spdk_mempools. Previously, -1 could be passed and the library would choose a reasonable default, but this new value makes it explicit that the default is being used.</p>
<h2>Blobstore</h2>
<p>The blobstore super block now contains a bstype field to identify the type of the blobstore. Existing code should be updated to fill out bstype when calling <a class="el" href="blob_8h.html#ad59f1d147b612a7d4ce1eb8439a69cee" title="Initialize a blobstore on the given device.">spdk_bs_init()</a> and <a class="el" href="blob_8h.html#a400da20b69e4f914730fbd15d51eb748" title="Load a blobstore from the given device.">spdk_bs_load()</a>.</p>
<p><a class="el" href="blob_8h.html#a0ba54d7b0d88a136bbfc9f93bc10b87d" title="Destroy the blobstore.">spdk_bs_destroy()</a> was added to allow destroying blobstore on device with an initialized blobstore.</p>
<p>spdk_bs_io_readv_blob() and spdk_bs_io_writev_blob() were added to enable scattered payloads.</p>
<p>A CLI tool for blobstore has been added, allowing basic operations through either command line or shell interface. See the <a href="https://github.com/spdk/spdk/tree/master/examples/blob/cli">blobcli</a> documentation for more details.</p>
<h2>Event Framework</h2>
<p>The ability to set a thread name, previously only used by the reactor code, is now part of the spdk_thread_allocate() API. Users may specify a thread name which will show up in tools like <code>gdb</code>.</p>
<h2>Log</h2>
<p>The spdk_trace_dump() function now takes a new parameter to allow the caller to specify an output file handle (stdout or stderr, for example).</p>
<h2>Logical Volumes</h2>
<p>Logical volumes library built on top of SPDK blobstore has been added. It is possible to create logical volumes on top of other devices using RPC.</p>
<p>See the <a href="http://www.spdk.io/doc/logical_volumes.html">logical volumes</a> documentation for more information.</p>
<h2>Persistent Memory</h2>
<p>A new persistent memory bdev type has been added. The persistent memory block device is built on top of <a href="http://pmem.io/nvml/libpmemblk/">libpmemblk</a>. It is possible to create pmem devices on top of pmem pool files using RPC.</p>
<p>See the <a href="http://www.spdk.io/doc/bdev.html#bdev_config_pmem">Pmem Block Device</a> documentation for more information.</p>
<h2>Virtio SCSI driver</h2>
<p>A userspace driver for Virtio SCSI devices has been added. The driver is capable of creating block devices on top of LUNs exposed by another SPDK vhost-scsi application.</p>
<p>See the <a href="http://www.spdk.io/doc/virtio.html">Virtio SCSI</a> documentation and <a href="http://www.spdk.io/doc/bdev.html#bdev_config_virtio_scsi">Getting Started</a> guide for more information.</p>
<h2>Vhost target</h2>
<p>The vhost target application now supports live migration between QEMU instances.</p>
<h1><a class="anchor" id="changelog-v17-07"></a>
v17.07: Build system improvements, userspace vhost-blk target, and GPT bdev</h1>
<h2>Build System</h2>
<p>A <code>configure</code> script has been added to simplify the build configuration process. The existing CONFIG file and <code>make CONFIG_...</code> options are also still supported. Run <code>./configure --help</code> for information about available configuration options.</p>
<p>A DPDK submodule has been added to make building SPDK easier. If no <code>--with-dpdk</code> option is specified to configure, the SPDK build system will automatically build a known-good configuration of DPDK with the minimal options enabled. See the Building section of README.md for more information.</p>
<p>A <a href="https://www.vagrantup.com/">Vagrant</a> setup has been added to make it easier to develop and use SPDK on systems without suitable NVMe hardware. See the Vagrant section of README.md for more information.</p>
<h2>Userspace vhost-blk target</h2>
<p>The vhost library and example app have been updated to support the vhost-blk protocol in addition to the existing vhost-scsi protocol. See the <a href="http://www.spdk.io/doc/vhost.html">vhost documentation</a> for more details.</p>
<h2>Block device abstraction layer (bdev)</h2>
<p>A GPT virtual block device has been added, which automatically exposes GPT partitions with a special SPDK-specific partition type as bdevs. See the <a href="http://www.spdk.io/doc/bdev.md#bdev_config_gpt">GPT bdev documentation</a> for more information.</p>
<h2>NVMe driver</h2>
<p>The NVMe driver has been updated to support recent Intel SSDs, including the Intel® Optane™ SSD DC P4800X series.</p>
<p>A workaround has been added for devices that failed to recognize register writes during controller reset.</p>
<p>The NVMe driver now allocates request tracking objects on a per-queue basis. The number of requests allowed on an I/O queue may be set during <code><a class="el" href="nvme_8h.html#a225bbc386ec518ae21bd5536f21db45d" title="Enumerate the bus indicated by the transport ID and attach the userspace NVMe driver to each device f...">spdk_nvme_probe()</a></code> by modifying <code>io_queue_requests</code> in the opts structure.</p>
<p>The SPDK NVMe <code>fio_plugin</code> has been updated to support multiple threads (<code>numjobs</code>).</p>
<p><a class="el" href="nvme_8h.html#a13f745d239dab9b8f934fae2ad4984a2" title="Allocate an I/O queue pair (submission and completion queue).">spdk_nvme_ctrlr_alloc_io_qpair()</a> has been modified to allow the user to override controller-level options for each individual I/O queue pair. Existing callers with qprio == 0 can be updated to: </p><div class="fragment"><div class="line">... = spdk_nvme_ctrlr_alloc_io_qpair(ctrlr, NULL, 0);</div>
</div><!-- fragment --><p> Callers that need to specify a non-default qprio should be updated to: </p><div class="fragment"><div class="line">struct spdk_nvme_io_qpair_opts opts;</div>
<div class="line">spdk_nvme_ctrlr_get_default_io_qpair_opts(ctrlr, &amp;opts, sizeof(opts));</div>
<div class="line">opts.qprio = SPDK_NVME_QPRIO_...;</div>
<div class="line">... = spdk_nvme_ctrlr_alloc_io_qpair(ctrlr, &amp;opts, sizeof(opts));</div>
</div><!-- fragment --><h2>Environment Abstraction Layer</h2>
<p>The environment abstraction layer has been updated to include several new functions in order to wrap additional DPDK functionality. See <code><a class="el" href="env_8h.html" title="Encapsulated third-party dependencies.">include/spdk/env.h</a></code> for the current set of functions.</p>
<h2>SPDK Performance Analysis with Intel® VTune™ Amplifier</h2>
<p>Support for SPDK performance analysis has been added to Intel® VTune™ Amplifier 2018.</p>
<p>This analysis provides:</p>
<ul>
<li>I/O performance monitoring (calculating standard I/O metrics like IOPS, throughput, etc.)</li>
<li>Tuning insights on the interplay of I/O and compute devices by estimating how many cores would be reasonable to provide for SPDK to keep up with a current storage workload.</li>
</ul>
<p>See the VTune Amplifier documentation for more information.</p>
<h1><a class="anchor" id="changelog-v17-03"></a>
v17.03: Blobstore and userspace vhost-scsi target</h1>
<h2>Blobstore and BlobFS</h2>
<p>The blobstore is a persistent, power-fail safe block allocator designed to be used as the local storage system backing a higher-level storage service. See the <a href="http://www.spdk.io/doc/blob.html">blobstore documentation</a> for more details.</p>
<p>BlobFS adds basic filesystem functionality like filenames on top of the blobstore. This release also includes a RocksDB Env implementation using BlobFS in place of the kernel filesystem. See the <a href="http://www.spdk.io/doc/blobfs.html">BlobFS documentation</a> for more details.</p>
<h2>Userspace vhost-scsi target</h2>
<p>A userspace implementation of the QEMU vhost-scsi protocol has been added. The vhost target is capable of exporting SPDK bdevs to QEMU-based VMs as virtio devices. See the <a href="http://www.spdk.io/doc/vhost.html">vhost documentation</a> for more details.</p>
<h2>Event framework</h2>
<p>The overhead of the main reactor event loop was reduced by optimizing the number of calls to <a class="el" href="env_8h.html#a7d868d272aa0c000f6135966dfadc596" title="Get a monotonic timestamp counter.">spdk_get_ticks()</a> per iteration.</p>
<h2>NVMe library</h2>
<p>The NVMe library will now automatically split readv/writev requests with scatter-gather lists that do not map to valid PRP lists when the NVMe controller does not natively support SGLs.</p>
<p>The <code>identify</code> and <code>perf</code> NVMe examples were modified to add a consistent format for specifying remote NVMe over Fabrics devices via the <code>-r</code> option. This is implemented using the new <code><a class="el" href="nvme_8h.html#ac37484cc5d14777e4ae1fde031d0edf2" title="Parse the string representation of a transport ID.">spdk_nvme_transport_id_parse()</a></code> function.</p>
<h2>iSCSI Target</h2>
<p>The [Nvme] section of the configuration file was modified to remove the <code>BDF</code> directive and replace it with a <code>TransportID</code> directive. Both local (PCIe) and remote (NVMe-oF) devices can now be specified as the backing block device. A script to generate an entire [Nvme] section based on the local NVMe devices attached was added at <code>scripts/gen_nvme.sh</code>.</p>
<h2>NVMe-oF Target</h2>
<p>The [Nvme] section of the configuration file was modified to remove the <code>BDF</code> directive and replace it with a <code>TransportID</code> directive. Both local (PCIe) and remote (NVMe-oF) devices can now be specified as the backing block device. A script to generate an entire [Nvme] section based on the local NVMe devices attached was added at <code>scripts/gen_nvme.sh</code>.</p>
<h1><a class="anchor" id="changelog-v16-12"></a>
v16.12: NVMe over Fabrics host, hotplug, and multi-process</h1>
<h2>NVMe library</h2>
<p>The NVMe library has been changed to create its own request memory pool rather than requiring the user to initialize the global <code>request_mempool</code> variable. Apps can be updated by simply removing the initialization of <code>request_mempool</code>. Since the NVMe library user no longer needs to know the size of the internal NVMe request structure to create the pool, the <code>spdk_nvme_request_size()</code> function was also removed.</p>
<p>The <code>spdk_nvme_ns_cmd_deallocate()</code> function was renamed and extended to become <code><a class="el" href="nvme_8h.html#ac0c646dd18675c54ffcf834ce699658d" title="Submit a data set management request to the specified NVMe namespace.">spdk_nvme_ns_cmd_dataset_management()</a></code>, which allows access to all of the NVMe Dataset Management command's parameters. Existing callers can be updated to use <code><a class="el" href="nvme_8h.html#ac0c646dd18675c54ffcf834ce699658d" title="Submit a data set management request to the specified NVMe namespace.">spdk_nvme_ns_cmd_dataset_management()</a></code> with <code>SPDK_NVME_DSM_ATTR_DEALLOCATE</code> as the <code>type</code> parameter.</p>
<p>The NVMe library SGL callback prototype has been changed to return virtual addresses rather than physical addresses. Callers of <code><a class="el" href="nvme_8h.html#acb47ce7de6b6e963ec9fb8de261466ae" title="Submit a read I/O to the specified NVMe namespace.">spdk_nvme_ns_cmd_readv()</a></code> and <code><a class="el" href="nvme_8h.html#adfcbb5d31f0b572847cc8ae8b07dfcfb" title="Submit a write I/O to the specified NVMe namespace.">spdk_nvme_ns_cmd_writev()</a></code> must update their <code>next_sge_fn</code> callbacks to match.</p>
<p>The NVMe library now supports NVMe over Fabrics devices in addition to the existing support for local PCIe-attached NVMe devices. For an example of how to enable NVMe over Fabrics support in an application, see <code>examples/nvme/identify</code> and <code>examples/nvme/perf</code>.</p>
<p>Hot insert/remove support for NVMe devices has been added. To enable NVMe hotplug support, an application should call the <code><a class="el" href="nvme_8h.html#a225bbc386ec518ae21bd5536f21db45d" title="Enumerate the bus indicated by the transport ID and attach the userspace NVMe driver to each device f...">spdk_nvme_probe()</a></code> function on a regular basis to probe for new devices (reported via the existing <code>probe_cb</code> callback) and removed devices (reported via a new <code>remove_cb</code> callback). Hotplug is currently only supported on Linux with the <code>uio_pci_generic</code> driver, and newly-added NVMe devices must be bound to <code>uio_pci_generic</code> by an external script or tool.</p>
<p>Multiple processes may now coordinate and use a single NVMe device simultaneously using <a href="http://dpdk.org/doc/guides/prog_guide/multi_proc_support.html">DPDK Multi-process Support</a>.</p>
<h2>NVMe over Fabrics target (<code>nvmf_tgt</code>)</h2>
<p>The <code>nvmf_tgt</code> configuration file format has been updated significantly to enable new features. See the example configuration file <code>etc/spdk/nvmf.conf.in</code> for more details on the new and changed options.</p>
<p>The NVMe over Fabrics target now supports virtual mode subsystems, which allow the user to export devices from the SPDK block device abstraction layer as NVMe over Fabrics subsystems. Direct mode (raw NVMe device access) is also still supported, and a single <code>nvmf_tgt</code> may export both types of subsystems simultaneously.</p>
<h2>Block device abstraction layer (bdev)</h2>
<p>The bdev layer now supports scatter/gather read and write I/O APIs, and the NVMe blockdev driver has been updated to support scatter/gather. Apps can use the new scatter/gather support via the <code><a class="el" href="group__bdev__io__submit__functions.html#ga9ac9efa882e87909acfd4bccaddb1778" title="Submit a read request to the bdev on the given channel.">spdk_bdev_readv()</a></code> and <code><a class="el" href="group__bdev__io__submit__functions.html#ga9a508a1c301a1321faf0680a8f31f59a" title="Submit a write request to the bdev on the given channel.">spdk_bdev_writev()</a></code> functions.</p>
<p>The bdev status returned from each I/O has been extended to pass through NVMe or SCSI status codes directly in cases where the underlying device can provide a more specific status code.</p>
<p>A Ceph RBD (RADOS Block Device) blockdev driver has been added. This allows the <code>iscsi_tgt</code> and <code>nvmf_tgt</code> apps to export Ceph RBD volumes as iSCSI LUNs or NVMe namespaces.</p>
<h2>General changes</h2>
<p><code>libpciaccess</code> has been removed as a dependency and DPDK PCI enumeration is used instead. Prior to DPDK 16.07 enumeration by class code was not supported, so for earlier DPDK versions, only Intel SSD DC P3x00 devices will be discovered by the NVMe library.</p>
<p>The <code>env</code> environment abstraction library has been introduced, and a default DPDK-based implementation is provided as part of SPDK. The goal of the <code>env</code> layer is to enable use of alternate user-mode memory allocation and PCI access libraries. See <code>doc/porting.md</code> for more details.</p>
<p>The build process has been modified to produce all of the library files in the <code>build/lib</code> directory. This is intended to simplify the use of SPDK from external projects, which can now link to SPDK libraries by adding the <code>build/lib</code> directory to the library path via <code>-L</code> and linking the SPDK libraries by name (for example, <code>-lspdk_nvme -lspdk_log -lspdk_util</code>).</p>
<p><code>nvmf_tgt</code> and <code>iscsi_tgt</code> now have a JSON-RPC interface, which allows the user to query and modify the configuration at runtime. The RPC service is disabled by default, since it currently does not provide any authentication or security mechanisms; it should only be enabled on systems with controlled user access behind a firewall. An example RPC client implemented in Python is provided in <code>scripts/rpc.py</code>.</p>
<h1><a class="anchor" id="changelog-v16-08"></a>
v16.08: iSCSI target, NVMe over Fabrics maturity</h1>
<p>This release adds a userspace iSCSI target. The iSCSI target is capable of exporting NVMe devices over a network using the iSCSI protocol. The application is located in app/iscsi_tgt and a documented configuration file can be found at etc/spdk/spdk.conf.in.</p>
<p>This release also significantly improves the existing NVMe over Fabrics target.</p>
<ul>
<li>The configuration file format was changed, which will require updates to any existing nvmf.conf files (see <code>etc/spdk/nvmf.conf.in</code>):<ul>
<li><code>SubsystemGroup</code> was renamed to <code>Subsystem</code>.</li>
<li><code>AuthFile</code> was removed (it was unimplemented).</li>
<li><code>nvmf_tgt</code> was updated to correctly recognize NQN (NVMe Qualified Names) when naming subsystems. The default node name was changed to reflect this; it is now "nqn.2016-06.io.spdk".</li>
<li><code>Port</code> and <code>Host</code> sections were merged into the <code>Subsystem</code> section</li>
<li>Global options to control max queue depth, number of queues, max I/O size, and max in-capsule data size were added.</li>
<li>The Nvme section was removed. Now a list of devices is specified by bus/device/function directly in the Subsystem section.</li>
<li>Subsystems now have a Mode, which can be Direct or Virtual. This is an attempt to future-proof the interface, so the only mode supported by this release is "Direct".</li>
</ul>
</li>
<li>Many bug fixes and cleanups were applied to the <code>nvmf_tgt</code> app and library.</li>
<li>The target now supports discovery.</li>
</ul>
<p>This release also adds one new feature and provides some better examples and tools for the NVMe driver.</p>
<ul>
<li>The Weighted Round Robin arbitration method is now supported. This allows the user to specify different priorities on a per-I/O-queue basis. To enable WRR, set the <code>arb_mechanism</code> field during <code><a class="el" href="nvme_8h.html#a225bbc386ec518ae21bd5536f21db45d" title="Enumerate the bus indicated by the transport ID and attach the userspace NVMe driver to each device f...">spdk_nvme_probe()</a></code>.</li>
<li>A simplified "Hello World" example was added to show the proper way to use the NVMe library API; see <code>examples/nvme/hello_world/hello_world.c</code>.</li>
<li>A test for measuring software overhead was added. See <code>test/lib/nvme/overhead</code>.</li>
</ul>
<h1><a class="anchor" id="changelog-v16-06"></a>
v16.06: NVMf userspace target</h1>
<p>This release adds a userspace NVMf (NVMe over Fabrics) target, conforming to the newly-released NVMf 1.0/NVMe 1.2.1 specification. The NVMf target exports NVMe devices from a host machine over the network via RDMA. Currently, the target is limited to directly exporting physical NVMe devices, and the discovery subsystem is not supported.</p>
<p>This release includes a general API cleanup, including renaming all declarations in public headers to include a <code>spdk</code> prefix to prevent namespace clashes with user code.</p>
<ul>
<li>NVMe<ul>
<li>The <code>nvme_attach()</code> API was reworked into a new probe/attach model, which moves device detection into the NVMe library. The new API also allows parallel initialization of NVMe controllers, providing a major reduction in startup time when using multiple controllers.</li>
<li>I/O queue allocation was changed to be explicit in the API. Each function that generates I/O requests now takes a queue pair (<code>spdk_nvme_qpair *</code>) argument, and I/O queues may be allocated using <code><a class="el" href="nvme_8h.html#a13f745d239dab9b8f934fae2ad4984a2" title="Allocate an I/O queue pair (submission and completion queue).">spdk_nvme_ctrlr_alloc_io_qpair()</a></code>. This allows more flexible assignment of queue pairs than the previous model, which only allowed a single queue per thread and limited the total number of I/O queues to the lowest number supported on any attached controller.</li>
<li>Added support for the Write Zeroes command.</li>
<li><code>examples/nvme/perf</code> can now report I/O command latency from the the controller's viewpoint using the Intel vendor-specific read/write latency log page.</li>
<li>Added namespace reservation command support, which can be used to coordinate sharing of a namespace between multiple hosts.</li>
<li>Added hardware SGL support, which enables use of scattered buffers that don't conform to the PRP list alignment and length requirements on supported NVMe controllers.</li>
<li>Added end-to-end data protection support, including the ability to write and read metadata in extended LBA (metadata appended to each block of data in the buffer) and separate metadata buffer modes. See <code><a class="el" href="nvme_8h.html#adc2aa2be0d657be0c63d5abc02b274ec" title="Submit a write I/O to the specified NVMe namespace.">spdk_nvme_ns_cmd_write_with_md()</a></code> and <code><a class="el" href="nvme_8h.html#aa2913b93326e636eca6dfe7b42e349fe" title="Submits a read I/O to the specified NVMe namespace.">spdk_nvme_ns_cmd_read_with_md()</a></code> for details.</li>
</ul>
</li>
<li>IOAT<ul>
<li>The DMA block fill feature is now exposed via the <code>ioat_submit_fill()</code> function. This is functionally similar to <code>memset()</code>, except the memory is filled with an 8-byte repeating pattern instead of a single byte like memset.</li>
</ul>
</li>
<li>PCI<ul>
<li>Added support for using DPDK for PCI device mapping in addition to the existing libpciaccess option. Using the DPDK PCI support also allows use of the Linux VFIO driver model, which means that SPDK userspace drivers will work with the IOMMU enabled. Additionally, SPDK applications may be run as an unprivileged user with access restricted to a specific set of PCIe devices.</li>
<li>The PCI library API was made more generic to abstract away differences between the underlying PCI access implementations.</li>
</ul>
</li>
</ul>
<h1>v1.2.0: IOAT user-space driver</h1>
<p>This release adds a user-space driver with support for the Intel I/O Acceleration Technology (I/OAT, also known as "Crystal Beach") DMA offload engine.</p>
<ul>
<li>IOAT<ul>
<li>New user-space driver supporting DMA memory copy offload</li>
<li>Example programs <code>ioat/perf</code> and <code>ioat/verify</code></li>
<li>Kernel-mode DMA engine test driver <code>kperf</code> for performance comparison</li>
</ul>
</li>
<li>NVMe<ul>
<li>Per-I/O flags for Force Unit Access (FUA) and Limited Retry</li>
<li>Public API for retrieving log pages</li>
<li>Reservation register/acquire/release/report command support</li>
<li>Scattered payload support - an alternate API to provide I/O buffers via a sequence of callbacks</li>
<li>Declarations and <code>nvme/identify</code> support for Intel SSD DC P3700 series vendor-specific log pages and features</li>
</ul>
</li>
<li>Updated to support DPDK 2.2.0</li>
</ul>
<h1>v1.0.0: NVMe user-space driver</h1>
<p>This is the initial open source release of the Storage Performance Development Kit (SPDK).</p>
<p>Features:</p>
<ul>
<li>NVMe user-space driver</li>
<li>NVMe example programs<ul>
<li><code>examples/nvme/perf</code> tests performance (IOPS) using the NVMe user-space driver</li>
<li><code>examples/nvme/identify</code> displays NVMe controller information in a human-readable format</li>
</ul>
</li>
<li>Linux and FreeBSD support </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
<ul>
        <li class="footer">Generated by
        <a href="http://www.doxygen.org/index.html">doxygen</a> 1.9.1 </li>
</ul>
</div>
</div>
</body>
</html>
