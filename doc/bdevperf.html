<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="generator" content="Doxygen 1.10.0" />
	<title>SPDK: bdevperf</title>
	<script src="https://code.jquery.com/jquery-3.7.1.slim.min.js" integrity="sha256-kmHvs0B+OpCW5GVHUNjv9rOmY0IvSIRcf7zGUDTDQM8=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.8/umd/popper.min.js" integrity="sha512-TPh2Oxlg1zp+kz3nFA0C5vVC6leG/6mm1z9+mA81MI5eaUVqasPLO8Cuk4gMF4gUfP5etR73rgU/8PNMsSesoQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
	<script type="text/javascript" src="../js/doxyboot.js"></script>
	<script type="text/javascript">
		$( document ).ready(function() {
			$("#cn_lang_btn").remove();
		});
	</script>
	<script type="text/javascript" src="./navtree.js"></script>
	<link rel="stylesheet" href='https://fonts.googleapis.com/css?family=Roboto:400,900' type='text/css'>
	<link href="../css/bootstrap.min.css" rel="stylesheet" type="text/css">
	<link href="../css/spdk.css" rel="stylesheet" type="text/css">
</head>
  <body>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark px-2">
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <a class="navbar-brand" href="/" aria-label="SPDK">
    <img src="../img/spdk.svg"  width="36" height="36" alt="Storage Performance Development Kit" />
  </a>
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <div class="navbar-nav me-auto">
      <a class="nav-link header-link"
      href="../releases/">
        download
      </a>
      <a class="nav-link header-link active text-white"
      href="/doc/">
        documentation
      </a>
      <a class="nav-link header-link"
      href="../development/">
        development
      </a>
      <a class="nav-link header-link"
      href="/ci/">
        CI status
      </a>
      <a class="nav-link header-link"
      href="../community/">
        community
      </a>
      <a class="nav-link header-link"
      href="../blog/">
        Blog
      </a>
      <a class="nav-link header-link"
      href="https://github.com/orgs/spdk/projects/5">
        Roadmap
      </a>
      <a class="nav-link header-link"
      href="../news/">
        News
      </a>
    </div>
    <div class="navbar-nav ms-auto me-3">
      <a class="nav-link header-link" href="https://github.com/spdk/spdk">
        <svg xmlns="http://www.w3.org/2000/svg" class="navbar-nav-svg"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
      </a>
      <a id="cn_lang_btn" href="/cn/doc/" class="nav-link header-link">中文</a>
    </div>
  </div>
</nav>
  <div class="container-fluid doc">
      <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('bdevperf.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">bdevperf</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_bdevperf"></a> </p><h1>Introduction</h1>
<p>bdevperf is an SPDK application used for performance testing of block devices (bdevs) exposed by the SPDK bdev layer. It is an alternative to the SPDK bdev fio plugin for benchmarking SPDK bdevs. In some cases, bdevperf can provide lower overhead than the fio plugin, resulting in better performance and efficiency for tests using a limited number of CPU cores.</p>
<p>bdevperf exposes command line interface that allows to specify SPDK framework options as well as testing options. bdevperf also supports a configuration file format similar to FIO. It allows user to create jobs parameterized by filename, cpumask, blocksize, queuesize, etc.</p>
<h1>Config file</h1>
<p>bdevperf's config file format is similar to FIO.</p>
<p>Below is an example config file that uses all available parameters:</p>
<div class="fragment"><div class="line">[global]</div>
<div class="line">filename=Malloc0:Malloc1</div>
<div class="line">bs=1024</div>
<div class="line">rw=randrw</div>
<div class="line">rwmixread=90</div>
<div class="line"> </div>
<div class="line">[A]</div>
<div class="line">cpumask=0xff</div>
<div class="line"> </div>
<div class="line">[B]</div>
<div class="line">cpumask=[0-128]</div>
<div class="line">filename=Malloc1</div>
<div class="line"> </div>
<div class="line">[global]</div>
<div class="line">filename=Malloc0</div>
<div class="line">rw=write</div>
<div class="line"> </div>
<div class="line">[C]</div>
<div class="line">bs=4096</div>
<div class="line">offset=1000000</div>
<div class="line">length=1000000</div>
</div><!-- fragment --><p>Jobs <code>[A]</code> <code>[B]</code> or <code>[C]</code>, inherit default values from <code>[global]</code> section residing above them. So in the example, job <code>[A]</code> inherits <code>filename</code> value and uses both <code>Malloc0</code> and <code>Malloc1</code> bdevs as targets, job <code>[B]</code> overrides its <code>filename</code> value and uses <code>Malloc1</code> and job <code>[C]</code> inherits value <code>Malloc0</code> for its <code>filename</code>.</p>
<p>Interaction with CLI arguments is not the same as in FIO however. If bdevperf receives CLI argument, it overrides values of corresponding parameter for all <code>[global]</code> sections of config file. So if example config is used, specifying <code>-q</code> argument will make jobs <code>[A]</code> and <code>[B]</code> use its value.</p>
<p>Below is a full list of supported parameters with descriptions.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Param   </th><th class="markdownTableHeadNone">Default   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">filename   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">Bdevs to use, separated by ":"    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">cpumask   </td><td class="markdownTableBodyNone">Maximum available   </td><td class="markdownTableBodyNone">CPU mask. Format is defined at <a class="el" href="app_overview.html#cpu_mask">CPU mask</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">bs   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">Block size (io size)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">iodepth   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">Queue depth    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">rwmixread   </td><td class="markdownTableBodyNone"><code>50</code>   </td><td class="markdownTableBodyNone">Percentage of a mixed workload that should be reads    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">offset   </td><td class="markdownTableBodyNone"><code>0</code>   </td><td class="markdownTableBodyNone">Start I/O at the provided offset on the bdev    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">length   </td><td class="markdownTableBodyNone">100% of bdev size   </td><td class="markdownTableBodyNone">End I/O at <code>offset</code>+<code>length</code> on the bdev    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">rw   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">Type of I/O pattern   </td></tr>
</table>
<p>Available rw types:</p>
<ul>
<li>read</li>
<li>randread</li>
<li>write</li>
<li>randwrite</li>
<li>verify</li>
<li>reset</li>
<li>unmap</li>
<li>write_zeroes</li>
<li>flush</li>
<li>rw</li>
<li>randrw</li>
</ul>
<h1>JSON Output</h1>
<p><code>bdevperf</code> supports delivering test results in JSON format via the <code>bdevperf.py perform_tests</code> RPC command. This feature allows users to programmatically parse and analyze test results.</p>
<h2>Enabling JSON Output</h2>
<p>To enable JSON output, use the <code>bdevperf.py perform_tests</code> RPC command. The JSON response includes detailed test results for each job and a summary of the test execution. Below is an example of how to trigger a test and retrieve results in JSON format:</p>
<div class="fragment"><div class="line">sudo ./build/examples/bdevperf -c ./test/bdev/bdevperf/conf.json -m 0xFF -z</div>
<div class="line">sudo PYTHONPATH=python ./examples/bdev/bdevperf/bdevperf.py perform_tests -q 16 -o 4096 -t 5 -w write</div>
</div><!-- fragment --><h2>Example JSON Output</h2>
<p>The JSON response consists of two main sections:</p>
<ol type="1">
<li><b>Results</b>: An array of objects, each representing a test job. Each object contains the following fields:</li>
</ol>
<ul>
<li><code>job</code>: The name of the job (e.g., <code>Malloc0</code>).</li>
<li><code>core_mask</code>: The CPU core mask used for the job.</li>
<li><code>workload</code>: The type of workload (e.g., <code>write</code>).</li>
<li><code>status</code>: The status of the test.<ul>
<li><code>finished</code> - the test completed successfully.</li>
<li><code>failed</code> - the test encountered an error.</li>
<li><code>terminated</code> - the test was interrupted (e.g., via <code>SIGINT</code> or <code>Ctrl-C</code>).</li>
</ul>
</li>
<li><code>queue_depth</code>: The queue depth used for the test.</li>
<li><code>io_size</code>: The I/O size in bytes.</li>
<li><code>runtime</code>: The test runtime in seconds.</li>
<li><code>iops</code>: The I/O operations per second achieved.</li>
<li><code>mibps</code>: The throughput in MiB/s.</li>
<li><code>io_failed</code>: The number of failed I/O operations.</li>
<li><code>io_timeout</code>: The number of timed-out I/O operations.</li>
<li><code>avg_latency_us</code>: The average latency in microseconds.</li>
<li><code>min_latency_us</code>: The minimum latency in microseconds.</li>
<li><code>max_latency_us</code>: The maximum latency in microseconds.</li>
</ul>
<ol type="1">
<li><b>Core Count</b>: The actual number of CPUs used during the test (note that <code>bdevperf</code> was run with <code>0xFF</code> mask, but only 2 cores were used).</li>
</ol>
<h3>Example</h3>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;results&quot;: [</div>
<div class="line">    {</div>
<div class="line">      &quot;job&quot;: &quot;Malloc0&quot;,</div>
<div class="line">      &quot;core_mask&quot;: &quot;0x1&quot;,</div>
<div class="line">      &quot;workload&quot;: &quot;write&quot;,</div>
<div class="line">      &quot;status&quot;: &quot;finished&quot;,</div>
<div class="line">      &quot;queue_depth&quot;: 16,</div>
<div class="line">      &quot;io_size&quot;: 4096,</div>
<div class="line">      &quot;runtime&quot;: 5.000048,</div>
<div class="line">      &quot;iops&quot;: 1200455.675625514,</div>
<div class="line">      &quot;mibps&quot;: 4689.279982912164,</div>
<div class="line">      &quot;io_failed&quot;: 0,</div>
<div class="line">      &quot;io_timeout&quot;: 0,</div>
<div class="line">      &quot;avg_latency_us&quot;: 13.252784244696382,</div>
<div class="line">      &quot;min_latency_us&quot;: 11.130434782608695,</div>
<div class="line">      &quot;max_latency_us&quot;: 222.6086956521739</div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">      &quot;job&quot;: &quot;Malloc1&quot;,</div>
<div class="line">      &quot;core_mask&quot;: &quot;0x2&quot;,</div>
<div class="line">      &quot;workload&quot;: &quot;write&quot;,</div>
<div class="line">      &quot;status&quot;: &quot;finished&quot;,</div>
<div class="line">      &quot;queue_depth&quot;: 16,</div>
<div class="line">      &quot;io_size&quot;: 4096,</div>
<div class="line">      &quot;runtime&quot;: 5.000024,</div>
<div class="line">      &quot;iops&quot;: 1216432.5611237066,</div>
<div class="line">      &quot;mibps&quot;: 4751.689691889479,</div>
<div class="line">      &quot;io_failed&quot;: 0,</div>
<div class="line">      &quot;io_timeout&quot;: 0,</div>
<div class="line">      &quot;avg_latency_us&quot;: 13.082916284986958,</div>
<div class="line">      &quot;min_latency_us&quot;: 5.7043478260869565,</div>
<div class="line">      &quot;max_latency_us&quot;: 90.82434782608695</div>
<div class="line">    }</div>
<div class="line">  ],</div>
<div class="line">  &quot;core_count&quot;: 2</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
<ul>
        <li class="footer">Generated by
        <a href="http://www.doxygen.org/index.html">doxygen</a> 1.10.0 </li>
</ul>
</div>
</div>
</body>
</html>
