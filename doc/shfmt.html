<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="generator" content="Doxygen 1.9.1" />
  <title>SPDK: shfmt</title>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <script type="text/javascript" src="../js/doxyboot.js"></script>
  <script type="text/javascript" src="./navtree.js"></script>
  <link href="../css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="../css/spdk.css" rel="stylesheet" type="text/css">
</head>
<body>
  <nav class="navbar navbar-expand-md navbar-dark bg-dark px-2">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/" aria-label="SPDK">
      <img src="/img/spdk.svg"  width="36" height="36" alt="Storage Performance Development Kit" />
    </a>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <div class="navbar-nav mr-auto">
        <a class="nav-link header-link active" href="../doc/">Documentation</a>
        <a class="nav-link header-link" href="../development/">Development</a>
        <a class="nav-link header-link" href="../community/">Community</a>
        <a class="nav-link header-link" href="../blog/">Blog</a>
      </div>
      <div class="navbar-nav ml-auto mr-3">
        <a class="nav-link header-link" href="https://github.com/spdk/spdk">
          <svg xmlns="http://www.w3.org/2000/svg" class="navbar-nav-svg"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
        </a>
      </div>
    </div>
  </nav>
  <div class="container-fluid doc">
      <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('shfmt.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">shfmt </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_shfmt"></a> </p>
<h1><a class="anchor" id="shfmt_toc"></a>
In this document</h1>
<ul>
<li><a class="el" href="shfmt.html#shfmt_overview">Overview</a></li>
<li><a class="el" href="shfmt.html#shfmt_usage">Usage</a></li>
<li><a class="el" href="shfmt.html#shfmt_installation">Installation</a></li>
<li><a class="el" href="shfmt.html#shfmt_examples">Examples</a></li>
</ul>
<h1><a class="anchor" id="shfmt_overview"></a>
Overview</h1>
<p>The majority of tests (and scripts overall) in the SPDK repo are written in Bash (with a quite significant emphasis on "Bashism"), thus a style formatter, shfmt, was introduced to help keep the .sh code consistent across the entire repo. For more details on the tool itself, please see <a href="https://github.com/mvdan/sh">shfmt</a>.</p>
<p>We also advise to use 4.4 Bash as a minimum version to make sure scripts across the whole repo work as intended.</p>
<h1><a class="anchor" id="shfmt_usage"></a>
Usage</h1>
<p>On the CI pool, the shfmt is run against all the updated .sh files that have been committed but not merged yet. Additionally, shfmt will pick all .sh present in the staging area when run locally from our pre-commit hook (via check_format.sh). In case any style errors are detected, a patch with needed changes is going to be generated and either build (CI) or the commit will be aborted. Said patch can be then easily applied:</p>
<div class="fragment"><div class="line"># Run from the root of the SPDK repo</div>
<div class="line">patch --merge -p0 &lt;shfmt-3.1.0.patch</div>
</div><!-- fragment --><p>The name of the patch is derived from the version of shfmt that is currently in use (3.1.0 is currently supported).</p>
<p>Please, see ./scripts/check_format.sh for all the arguments the shfmt is run with. Additionally, <a class="el" href="shfmt.html#shfmt_examples">Examples</a> has more details on how each of the arguments behave.</p>
<h1><a class="anchor" id="shfmt_installation"></a>
Installation</h1>
<p>The shfmt can be easily installed via pkgdep.sh:</p>
<div class="fragment"><div class="line">./scripts/pkgdep.sh -d</div>
</div><!-- fragment --><p>This will install all the developers tools, including shfmt, on the local system. The precompiled binary will be saved, by default, to /opt/shfmt and then linked under /usr/bin. Both paths can be changed by setting SHFMT_DIR and SHFMT_DIR_OUT in the environment. Example:</p>
<div class="fragment"><div class="line">SHFMT_DIR=/keep_the_binary_here \</div>
<div class="line">SHFMT_DIR_OUT=/and_link_it_here \</div>
<div class="line">  ./scripts/pkgdep.sh -d</div>
</div><!-- fragment --><h1><a class="anchor" id="shfmt_examples"></a>
Examples</h1>
<div class="fragment"><div class="line">#######################################</div>
<div class="line">if foo=$(bar); then</div>
<div class="line">  echo &quot;$foo&quot;</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line">exec &quot;$foo&quot; \</div>
<div class="line">  --bar \</div>
<div class="line">  --foo</div>
<div class="line"> </div>
<div class="line"># indent_style = tab</div>
<div class="line"> </div>
<div class="line">if foo=$(bar); then</div>
<div class="line">        echo &quot;$foo&quot;</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line">exec foobar \</div>
<div class="line">        --bar \</div>
<div class="line">        --foo</div>
<div class="line">######################################</div>
<div class="line">if foo=$(bar); then</div>
<div class="line">        echo &quot;$foo&quot; &amp;&amp; \</div>
<div class="line">        echo &quot;$(bar)&quot;</div>
<div class="line">fi</div>
<div class="line"># binary_next_line = true</div>
<div class="line">if foo=$(bar); then</div>
<div class="line">        echo &quot;$foo&quot; \</div>
<div class="line">                &amp;&amp; echo &quot;$(bar)&quot;</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line"># Note that each break line is also being indented:</div>
<div class="line"> </div>
<div class="line">if [[ -v foo ]] \</div>
<div class="line">&amp;&amp; [[ -v bar ]] \</div>
<div class="line">&amp;&amp; [[ -v foobar ]]; then</div>
<div class="line">        echo &quot;This is foo&quot;</div>
<div class="line">fi</div>
<div class="line"># -&gt;</div>
<div class="line">if [[ -v foo ]] \</div>
<div class="line">        &amp;&amp; [[ -v bar ]] \</div>
<div class="line">        &amp;&amp; [[ -v foobar ]]; then</div>
<div class="line">        echo &quot;This is foo&quot;</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line"># Currently, newlines are being escaped even if syntax-wise</div>
<div class="line"># they are not needed, thus watch for the following:</div>
<div class="line">if [[ -v foo</div>
<div class="line">        &amp;&amp; -v bar</div>
<div class="line">        &amp;&amp; -v foobar ]]; then</div>
<div class="line">        echo &quot;This is foo&quot;</div>
<div class="line">fi</div>
<div class="line">#-&gt;</div>
<div class="line">if [[ -v foo &amp;&amp; -v \</div>
<div class="line">        bar &amp;&amp; -v \</div>
<div class="line">        foobar ]]; then</div>
<div class="line">        echo &quot;This is foo&quot;</div>
<div class="line">fi</div>
<div class="line"># This, unfortunately, also breaks the -bn behavior.</div>
<div class="line"># (see https://github.com/mvdan/sh/issues/565) for details.</div>
<div class="line">######################################</div>
<div class="line">case &quot;$FOO&quot; in</div>
<div class="line">        BAR)</div>
<div class="line">        echo &quot;$FOO&quot; ;;</div>
<div class="line">esac</div>
<div class="line"># switch_case_indent = true</div>
<div class="line">case &quot;$FOO&quot; in</div>
<div class="line">        BAR)</div>
<div class="line">                echo &quot;$FOO&quot;</div>
<div class="line">                ;;</div>
<div class="line">esac</div>
<div class="line">######################################</div>
<div class="line">exec {foo}&gt;bar</div>
<div class="line">:&gt;foo</div>
<div class="line">exec {bar}&lt;foo</div>
<div class="line"># -sr</div>
<div class="line">exec {foo}&gt; bar</div>
<div class="line">: &gt; foo</div>
<div class="line">exec {bar}&lt; foo</div>
<div class="line">######################################</div>
<div class="line"># miscellaneous, enforced by shfmt</div>
<div class="line">(( no_spacing_at_the_beginning &amp; ~and_no_spacing_at_the_end ))</div>
<div class="line">: $(( no_spacing_at_the_beginning &amp; ~and_no_spacing_at_the_end ))</div>
<div class="line"> </div>
<div class="line"># -&gt;</div>
<div class="line">((no_spacing_at_the_beginning &amp; ~and_no_spacing_at_the_end))</div>
<div class="line">: $((no_spacing_at_the_beginning &amp; ~and_no_spacing_at_the_end))</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
<ul>
        <li class="footer">Generated by
        <a href="http://www.doxygen.org/index.html">doxygen</a> 1.9.1 </li>
</ul>
</div>
</div>
</body>
</html>
