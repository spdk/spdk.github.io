<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="generator" content="Doxygen 1.10.0" />
  <title>SPDK: Scheduler</title>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <script type="text/javascript" src="../js/doxyboot.js"></script>
  <script type="text/javascript" src="./navtree.js"></script>
  <link href="../css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="../css/spdk.css" rel="stylesheet" type="text/css">
</head>
<body>
  <nav class="navbar navbar-expand-md navbar-dark bg-dark px-2">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/" aria-label="SPDK">
      <img src="/img/spdk.svg"  width="36" height="36" alt="Storage Performance Development Kit" />
    </a>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <div class="navbar-nav me-auto">
        <a class="nav-link header-link active" href="../doc/">Documentation</a>
        <a class="nav-link header-link" href="../development/">Development</a>
        <a class="nav-link header-link" href="../community/">Community</a>
        <a class="nav-link header-link" href="../blog/">Blog</a>
      </div>
      <div class="navbar-nav ms-auto me-3">
        <a class="nav-link header-link" href="https://github.com/spdk/spdk">
          <svg xmlns="http://www.w3.org/2000/svg" class="navbar-nav-svg"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
        </a>
      </div>
    </div>
  </nav>
  <div class="container-fluid doc">
      <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('scheduler.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Scheduler</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_scheduler"></a> SPDK's event/application framework (<code>lib/event</code>) now supports scheduling of lightweight threads. Schedulers are provided as plugins, called implementations. A default implementation is provided, but users may wish to write their own scheduler to integrate into broader code frameworks or meet their performance needs.</p>
<p>This feature should be considered experimental and is disabled by default. When enabled, the scheduler framework gathers data for each spdk thread and reactor and passes it to a scheduler implementation to perform one of the following actions.</p>
<h1>Actions</h1>
<h2>Move a thread</h2>
<p><code>spdk_thread</code>s can be moved to another reactor. Schedulers can examine the suggested cpu_mask value for each lightweight thread to see if the user has requested specific reactors, or choose a reactor using whatever algorithm they deem fit.</p>
<h2>Switch reactor mode</h2>
<p>Reactors by default run in a mode that constantly polls for new actions for the most efficient processing. Schedulers can switch a reactor into a mode that instead waits for an event on a file descriptor. On Linux, this is implemented using epoll. This results in reduced CPU usage but may be less responsive when events occur. A reactor cannot enter this mode if any <code>spdk_threads</code> are currently scheduled to it. This limitation is expected to be lifted in the future, allowing <code>spdk_threads</code> to enter interrupt mode.</p>
<h2>Set frequency of CPU core</h2>
<p>The frequency of CPU cores can be modified by the scheduler in response to load. Only CPU cores that match the application cpu_mask may be modified. The mechanism for controlling CPU frequency is pluggable and the default provided implementation is called <code>dpdk_governor</code>, based on the <code>rte_power</code> library from DPDK.</p>
<h3>Known limitation</h3>
<p>When SMT (Hyperthreading) is enabled the two logical CPU cores sharing a single physical CPU core must run at the same frequency. If one of two of such logical CPU cores is outside the application cpu_mask, the policy and frequency on that core has to be managed by the administrator.</p>
<h1>Scheduler implementations</h1>
<p>The scheduler in use may be controlled by JSON-RPC. Please use the <a href="jsonrpc.html#rpc_framework_set_scheduler">framework_set_scheduler</a> RPC to switch between schedulers or change their options. Currently only dynamic scheduler supports changing its parameters.</p>
<p><a href="spdk_top.html#spdk_top">spdk_top</a> is a useful tool to observe the behavior of schedulers in different scenarios and workloads.</p>
<h2>static [default]</h2>
<p>The <code>static</code> scheduler is the default scheduler and does no dynamic scheduling. Lightweight threads are distributed round-robin among reactors, respecting their requested cpu_mask, only at application startup, and then they are never moved. This is equivalent to the previous behavior of the SPDK event/application framework.</p>
<p>The <code>static</code> scheduler cannot be re-enabled after a different scheduler has been selected, because currently there is no way to save original SPDK thread distribution configuration.</p>
<h2>dynamic</h2>
<p>The <code>dynamic</code> scheduler is designed for power saving and reduction of CPU utilization, especially in cases where workloads show large variations over time. In SPDK thread and core workloads are measured in CPU ticks. Those values are then compared with all the ticks since the last check, which allows to calculate <code>busy time</code>.</p>
<p><code>busy time = busy ticks / (busy tick + idle tick) * 100 %</code></p>
<p>The thread is considered to be active, if its busy time is over the <code>load limit</code> parameter.</p>
<p>Active threads are distributed equally among reactors, taking cpu_mask into account. All idle threads are moved to the main core. Once an idle thread becomes active, it is redistributed again. Dynamic scheduler monitors core workloads and redistributes SPDK threads on cores in a way that none of them is over <code>core limit</code>. In case a core utilization surpasses this threshold, scheduler should move threads out of it until this condition no longer applies. Cores might also be in overloaded state, which indicates that moving threads out of this core will not decrease its utilization under the <code>core limit</code> and the threads are unable to process all the I/O they are capable of, because they share CPU ticks with other threads. The threshold to decide if a core is overloaded is called <code>core busy</code>. Note that threads residing on an overloaded core will not perform as good as other threads, because the CPU ticks intended for them are limited by other threads on the same core.</p>
<p>When a reactor has no scheduled <code>spdk_thread</code>s it is switched into interrupt mode and stops actively polling. After enough threads become active, the reactor is switched back into poll mode and threads are assigned to it again.</p>
<p>The main core can contain active threads only when their execution time does not exceed the sum of all idle threads. When no active threads are present on the main core, the frequency of that CPU core will decrease as the load decreases. All CPU cores corresponding to the other reactors remain at maximum frequency.</p>
<p>The dynamic scheduler is currently the only one that allows manual setting of its parameters.</p>
<p>Current values of scheduler parameters can be displayed by using <a href="jsonrpc.html#rpc_framework_get_scheduler">framework_get_scheduler</a> RPC. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
<ul>
        <li class="footer">Generated by
        <a href="http://www.doxygen.org/index.html">doxygen</a> 1.10.0 </li>
</ul>
</div>
</div>
</body>
</html>
